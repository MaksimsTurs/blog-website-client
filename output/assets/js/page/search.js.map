{"version":3,"file":"search.js","sources":["../../../../src/page/search/component/sortInput.tsx","../../../../src/page/search/page.tsx"],"sourcesContent":["import TextInput from '@/component/input/textInput/textInput'\r\n\r\nimport type { FilterInputProps } from '../page.type'\r\n\r\nexport default function SortInput({ changeFilterData, filterData, filterDataName }: FilterInputProps) {\r\n  return(\r\n    <TextInput \r\n      name={filterDataName} \r\n      placeholder={`Find by ${filterDataName}...`} \r\n      value={filterData[filterDataName] as string} \r\n      onInput={(event) => changeFilterData(filterDataName, event.currentTarget.value)}/>\r\n    )\r\n}","import scss from './page.module.scss'\r\nimport '@/scss/global.scss'\r\n\r\nimport _PostContainer from '@/component/post-container/postContainer'\r\nimport HomeLoader from '../home/loader';\r\nimport Empty from '@/component/empty/empty';\r\nimport PageError from '@/component/errors/page-error/pageError';\r\nimport Button from '@/component/buttons/button/button'\r\nimport Pagination from '@/component/pagination/pagination'\r\nimport SortInput from './component/sortInput';\r\nimport PaginationLoader from '@/component/pagination/component/paginationLoader';\r\nimport TextTagInput from '@/component/input/text-tag-input/textTagInput';\r\n\r\nimport { ArrowDownWideNarrow, ArrowUpNarrowWide, Eye, Filter, Heart, MessageCircle } from 'lucide-react';\r\nimport { Fragment, memo, useRef, useState } from 'react';\r\n\r\nimport type { FilterOptions, SortedPosts } from './page.type';\r\nimport type { CustomInputsRef } from '@/global.type';\r\n\r\nimport useRequest from '@/custom-hook/use-request/useRequest';\r\nimport useSearchParams from '@/custom-hook/use-search-params/useSearchParams';\r\nimport useOutsideClick from '@/custom-hook/use-outside-click/useOutsideClick';\r\n\r\nimport fetcher from '@/lib/fetcher/fetcher';\r\n\r\nimport { URL_SEARCH_PARAMS, AUTHORIZATION_OBJECT } from '@/conts';\r\n\r\nconst PostContainer = memo(_PostContainer)\r\n\r\nconst is930px: boolean = window.matchMedia('(width <= 930px)').matches\r\n\r\nconst sortOptions = [\r\n  { name: 'Likes', icon: <Heart size={17}/> },\r\n  { name: 'Views', icon: <Eye size={17}/> },\r\n  { name: 'Comments', icon: <MessageCircle size={17}/> }\r\n]\r\n\r\nexport default function Search() {\r\n  const [filterOptions, setFilterOptions] = useState<FilterOptions>({ author: '', content: '', title: '' })\r\n  \r\n  const searchParams = useSearchParams()\r\n\r\n  const selectedTag: string | null = searchParams.get('tag')\r\n  const page: number = parseInt(searchParams.get('page') || '0')\r\n  \r\n  const modalContainerRef = useRef<HTMLDivElement>(null)\r\n  const sortTagRef = useRef<CustomInputsRef<string[]>>()\r\n  \r\n  const isOpen: boolean = !is930px ? true : useOutsideClick(URL_SEARCH_PARAMS['IS-FILTER-MODAL-OPEN'], modalContainerRef)  \r\n\r\n  const { isPending, data, error, request } = useRequest<SortedPosts>({ \r\n    deps: [`sort-${page}`],\r\n    noCache: true,\r\n    request: async () => await fetcher.post<SortedPosts>(`/sort/${page}`, {...filterOptions, tags: sortTagRef.current?.value }, AUTHORIZATION_OBJECT) \r\n  })\r\n\r\n  const changeFilterData = (name: string, value?: any): void => {\r\n    if(value) {\r\n      setFilterOptions(prev => ({...prev, [name]: value }))\r\n      return\r\n    }\r\n\r\n    setFilterOptions(prev => {\r\n      if(prev.sortOption?.[name] === 'ascending')       prev = {...prev, sortOption: { [name]: undefined }}\r\n      else if(prev.sortOption?.[name] === 'descending') prev = {...prev, sortOption: { [name]: 'ascending' }}\r\n      else                                              prev = {...prev, sortOption: { [name]: 'descending' }}\r\n      return prev\r\n    })\r\n  }\r\n\r\n  const resetSort = (): void => {\r\n    setFilterOptions({ author: '', content: '', title: '' })\r\n    searchParams.set({ 'page': 0 })\r\n    if(sortTagRef.current) sortTagRef.current.clear()\r\n  }\r\n\r\n  const openFilterModal = (): void => {\r\n    searchParams.set({ [URL_SEARCH_PARAMS['IS-FILTER-MODAL-OPEN']]: true })\r\n  }\r\n\r\n  const getBySortOptions = (): void => {\r\n    if(page === 0) request()\r\n    else searchParams.set({ 'page': 0 })\r\n  }\r\n\r\n  return(\r\n    <Fragment>\r\n      {error ? <PageError error={error}/> : \r\n      <div style={{ height: '100%' }} className='flex-row-normal-normal-medium'>\r\n        <div style={{ width: '100%', minHeight: '100%' }} className='flex-column-normal-normal-small'>\r\n          {is930px ? <Filter onClick={openFilterModal} className={scss.search_filter_modal_button}/> : null}\r\n          {isPending ? <PaginationLoader/> : data && data.pagesCount > 1 ? <Pagination pagesCount={data.pagesCount}/> : null}\r\n          {isPending ? <HomeLoader/> : \r\n          data && data.posts.length === 0 ? <Empty option={{ flexCenterCenter: true, height: 'FULL' }} label='Nothing found!'/> : \r\n          data && data.posts.map(post => <PostContainer key={post._id} post={post} type=\"preview\"/>)}\r\n          {isPending ? <PaginationLoader/> : data && data.pagesCount > 1 ? <Pagination pagesCount={data.pagesCount}/> : null}\r\n        </div>\r\n        <div ref={modalContainerRef} className={isOpen ? scss.search_filter_container : `${scss.search_filter_container} ${scss.search_filter_container_hidden}`}>\r\n          <div className='main-content-container flex-column-normal-normal-small'>\r\n              <p className={scss.search_sort_type_title}>Sort by</p>\r\n              <div className='flex-column-normal-normal-small'>\r\n                {sortOptions.map(option => (\r\n                  <button\r\n                    key={option.name}\r\n                    onClick={() => changeFilterData(option.name)}\r\n                    className={filterOptions.sortOption?.[option.name] ? `${scss.search_sort_button} ${scss.search_sort_button_active} flex-row-center-center-medium` : `${scss.search_sort_button} flex-row-center-center-medium`}>\r\n                    {option.icon}\r\n                    <p>{option.name}</p>\r\n                    {filterOptions.sortOption?.[option.name] === 'descending' ? <ArrowDownWideNarrow size={14}/> : filterOptions.sortOption?.[option.name] === 'ascending' ?  <ArrowUpNarrowWide size={14}/> : null }\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              <SortInput changeFilterData={changeFilterData} filterData={filterOptions} filterDataName='content'/>\r\n              <SortInput changeFilterData={changeFilterData} filterData={filterOptions} filterDataName='author'/>\r\n              <SortInput changeFilterData={changeFilterData} filterData={filterOptions} filterDataName='title'/>\r\n              <TextTagInput ref={sortTagRef} value={[selectedTag || '', ...sortTagRef.current?.value || []]} placeholder='Find by tags'/>\r\n              <div className={`flex-row-normal-normal-small`}>\r\n                <Button className={scss.search_filter_button} onClick={getBySortOptions}>Sortieren</Button>\r\n                <Button className={scss.search_filter_button} onClick={resetSort}>Wiederherstellen</Button>\r\n              </div>\r\n            </div>\r\n        </div>\r\n      </div>}\r\n    </Fragment>\r\n  )\r\n}"],"names":["SortInput","changeFilterData","filterData","filterDataName","jsx","TextInput","name","placeholder","value","onInput","event","currentTarget","PostContainer","memo","_PostContainer","is930px","window","matchMedia","matches","sortOptions","icon","Heart","size","Eye","MessageCircle","Search","filterOptions","setFilterOptions","useState","author","content","title","searchParams","useSearchParams","selectedTag","get","page","parseInt","modalContainerRef","useRef","sortTagRef","isOpen","useOutsideClick","URL_SEARCH_PARAMS","isPending","data","error","request","useRequest","deps","noCache","async","fetcher","post","tags","current","AUTHORIZATION_OBJECT","prev","sortOption","Fragment","children","PageError","jsxs","style","height","className","width","minHeight","Filter","onClick","set","scss","PaginationLoader","pagesCount","Pagination","HomeLoader","posts","length","Empty","option","flexCenterCenter","label","map","type","_id","ref","ArrowDownWideNarrow","ArrowUpNarrowWide","TextTagInput","Button","clear"],"mappings":"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"}