import{d as e,r as s,j as t,c as a,L as n,D as o,i,P as r,E as l,G as c,h as d,J as m,K as p}from"../react.js";import{u as _}from"./about.js";import{i as u,u as x,U as h,f as j,j as v,X as g,B as f,d as w,c as N,D as y,I as $,l as b,S as C,A as T,_ as I,k as S,L as A,E,M as P,P as O}from"./admin.js";import{u as k,c as L,C as D,I as R}from"./database.js";function M(){const t=e(),a=s.useContext(u),n=x(),o=n.get(h["IS-LOGIN-MODAL-OPEN"]),i=n.get(h["IS-REGISTRATE-MODAL-OPEN"]);return{...a?.userState,create:async function(e){try{if(e.setSession)return a?.updateUserState({user:e.setSession,isAuthPending:!1,isLoading:!1});a?.updateUserState({isAuthPending:!1,isLoading:!0});const s=await j.post(e.apiURL,e.body);a?.updateUserState({isAuthPending:!1,isLoading:!1,error:void 0,user:s}),e?.setToken&&v.set("PR_TOKEN",s.token),e?.redirectURL&&t(e.redirectURL)}catch(s){a.updateUserState((e=>({...e,isAuthPending:!1,isLoading:!1,error:s instanceof Error?{code:503,message:"Service Unavailable!"}:JSON.parse(s)})))}},out:function(){a?.updateUserState({isAuthPending:!1,isLoading:!1}),v.set("PR_TOKEN","undefined")},clearError:function(){s.useEffect((()=>{a?.updateUserState((e=>({...e,error:void 0})))}),[o,i])}}}const U={post_loader_container:"Da",post_loader_text:"Ea",loader:"Fa",post_loader_tag:"Ga",post_loader_avatar:"Ha"};function F(){return t.jsxs("div",{className:`${U.post_loader_container} main-content-container flex-column-normal-normal-medium`,children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:U.post_loader_avatar}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"4rem"},className:U.post_loader_text}),t.jsx("div",{style:{width:"7rem"},className:U.post_loader_text})]})]}),t.jsx("div",{style:{width:"11rem"},className:U.post_loader_text}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"50%"},className:U.post_loader_text}),t.jsx("div",{style:{width:"20%"},className:U.post_loader_text})]}),t.jsxs("div",{className:"flex-row-normal-space-between-none",children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:U.post_loader_tag}),t.jsx("div",{className:U.post_loader_tag}),t.jsx("div",{className:U.post_loader_tag})]}),t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:U.post_loader_tag}),t.jsx("div",{className:U.post_loader_tag}),t.jsx("div",{className:U.post_loader_tag})]})]})]})}function H({containersCount:e}){return _({title:"Home",description:"Hier kannst du alle letzt geschriebene posts ansehen."}),t.jsx("div",{className:"flex-column-normal-normal-small",children:[...Array(e||3)].map(((e,s)=>t.jsx(F,{},s)))})}const z={post_content_container:"r_",post_title:"s_",post_content_date:"t_",post_tags_statistic_container:"u_",post_data:"v_",post_hidden:"w_",post_statistic_data:"x_",post_liked:"y_",like:"z_"},G={post_header:"Tc",post_header_author_not_defined:"Uc",post_action_button:"Vc",post_action_container:"Wc",post_create_date:"Xc"},W={confirm_modal_container:"We",confirm_modal_body:"Xe",confirm_modal_header:"Ye",confirm_modal_button:"Ze",confirm_modal_text_body:"_g",confirm_modal_open:"-g"};function B({text:e,onConfirm:a}){const n=x(),o=s.useRef(null),i=k(h["IS-CONFIRM-MODAL-OPEN"],o);return t.jsx("div",{ref:o,className:`${i?W.confirm_modal_open:""} ${W.confirm_modal_container} flex-row-center-center-none`,children:t.jsxs("div",{className:`${W.confirm_modal_body} main-content-container`,children:[t.jsxs("section",{className:`${W.confirm_modal_header} flex-row-center-space-between-medium`,children:[t.jsx("p",{children:"Confirm"}),t.jsx(g,{onClick:()=>{n.remove([h["IS-CONFIRM-MODAL-OPEN"]])}})]}),t.jsxs("div",{className:W.confirm_modal_text_body,children:[t.jsx("p",{children:e}),t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx(f,{label:"Confirm",className:W.confirm_modal_button,onClick:a})})]})]})})}function V({user:s,createdAt:d,type:m,contentID:p,postID:_,content:u,tags:v,title:g,isHidden:f}){const I=w(),S=x(),A=e(),{pathname:E}=a(),P=I.roleAndEqual(["Admin","Creator"],"_id",s?._id).permited(),O=E.search("/post/")>-1,k=E.search("/")>-1,L=E.search("/search")>-1,D="preview"===m?"post":m,R=parseInt(S.get("page")||"0"),M=O&&"comment"===m?`post-${_}-comments-${S.get("page")||0}`:k?"all-posts":"",{mutate:U,changeError:F}=N(M),H=e=>{if(!I.role(["Creator","Admin"]).permited())return F({code:403,message:"You have no edit and remove permission!"});if("edit"===e){if(I.role(["Creator"]).permited())return b.set(p,{content:u,tags:v,title:g,isHidden:f,isEdit:!0,contentType:D,onPage:R,onPost:_}),A(`/write-post?content-id=${p}`);if(I.role(["Admin"]).permited())return A(`/admin/${D}?id=${p}&${D}-edit-modal=true`)}U((async s=>{if("remove"===e){const e=await j.get(`/admin/remove/${C.firstLetterToUpperCase(D)}/${p}`,T);if(O&&"comment"===m){const t=s.state||{comments:[],pagesCount:0};if(1===t.comments.length&&t.pagesCount>=1){for(let e=t.pagesCount-1;e>=0;e--)e!==R&&s.removeCache(`post-${_}-comments-${e}`);return A(`/post/${_}?page=${+R-1}`),{pagesCount:0,comments:[]}}return{...t,comments:t.comments.filter((s=>s._id!==e._id))}}if(k){return(s.state||[]).filter((s=>s._id!==e._id))}}const t=await j.post(`/admin/${D}/update`,{id:p,isHidden:"hidde"===e,flag:e},T);if(O){const e=s.state||{pagesCount:0,comments:[]};return{...e,comments:e.comments.map((e=>e._id===t._id?{...e,...t}:e))}}return(s.state||[]).map((e=>e._id===t._id?t:e))}))},z=y.getDifference(d).getSortDate({year:"[year] year [month] months ago!",month:"[month] month [day] days ago!",day:"[day] day [hour] hours ago!",hour:"[hour] hour [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsxs(t.Fragment,{children:[t.jsx(B,{text:"Do you will to remove this post?",onConfirm:()=>{H("remove")}}),t.jsxs("div",{className:`${G.post_header} flex-row-center-space-between-none`,children:[s?t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx($,{styles:{svg:{width:"2rem",height:"2rem"},img:{width:"2rem",height:"2rem"}},src:s?.avatar,alt:s?.name||"User avatar"}),t.jsxs("div",{className:G.post_author,children:[t.jsx(n,{to:`/user/${s?._id}`,children:s?.name}),t.jsx("p",{className:G.post_create_date,children:z})]})]}):t.jsxs("div",{className:`${G.post_header_author_not_defined} flex-row-center-normal-medium`,children:[t.jsx(o,{}),t.jsx("p",{children:"Author is possibly deleted!"})]}),P&&!L?t.jsxs("button",{className:G.post_action_button,children:[t.jsx("svg",{viewBox:"0 0 128 512",children:t.jsx("path",{d:"M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"})}),t.jsxs("ul",{className:`${G.post_action_container} flex-column-normal-normal-none`,children:[t.jsxs("li",{onClick:()=>{S.set({[h["IS-CONFIRM-MODAL-OPEN"]]:!0})},className:"flex-row-center-normal-medium",children:[t.jsx(i,{}),t.jsx("p",{children:"Remove"})]}),t.jsxs("li",{onClick:()=>H("edit"),className:"flex-row-center-normal-medium",children:[t.jsx(r,{}),t.jsx("p",{children:"Edit"})]}),t.jsxs("li",{onClick:()=>H(f?"show":"hidde"),className:"flex-row-center-normal-medium",children:[f?t.jsx(l,{}):t.jsx(c,{}),t.jsx("p",{children:f?"Show":"Hidden"})]})]})]}):null]})]})}const q={post_wrapper_container:"qc",post_is_hidden:"rc"};function K({children:e,className:s}){return t.jsxs("section",{className:`${q.post_wrapper_container} ${s} main-content-container`,children:[s?t.jsxs("div",{className:`${q.post_is_hidden} flex-row-center-center-medium`,children:[t.jsx(c,{}),t.jsx("p",{children:"Hidden"})]}):null,t.jsx("div",{style:{padding:"1rem"},children:e})]})}const X={post_tags:"pc"};function J({tags:e}){return t.jsx("div",{className:`${X.post_tags} flex-row-normal-normal-medium`,children:e.map((e=>e.trim()?t.jsx(n,{to:`/search?tag=${e}`,children:e},e):null))})}function Y({post:s,type:o}){const{id:i}=d(),{pathname:r}=a(),c=e(),_=M(),u=x(),g=w(),f=L(),$=r.search("/post")>-1,b="/"===r,C=s.likedBy.includes(_.user?._id||""),T=g.role(["Creator"]).equal("_id",s?.author?._id).permited(),I=g.role(["Admin"]).permited(),S=s.isHidden,A="preview"===o||"post"===o?s._id:i,E="comment"===o?parseInt(u.get("page")||"0"):0,P=S&&I||T&&S?z.post_hidden:"",O="post"===o?`post-${s._id}`:`post-${A}-comments-${E}`,{mutate:k}=N(O);S&&$&&!I&&!T&&"post"===o&&c("/");const R=e=>{u.set({[h["STATISTIC-TO-PREVIEW"]]:e,[h["STATISTIC-PREVIEW-POST-ID"]]:s._id,[h["LIST-PAGE"]]:0})},U=y.getDifference(s.createdAt).getSortDate({year:"[year] years [month] months ago!",month:"[month] months [day] days ago!",day:"[day] days [hour] hours ago!",hour:"[hour] hours [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsx(t.Fragment,{children:b&&!T&&!I&&S?null:t.jsxs(K,{className:P,children:["comment"===o||"preview"===o?t.jsx(V,{tags:s.tags||[],title:s.title||"",content:s.content,isHidden:s.isHidden,postID:A,contentID:s._id,type:o,createdAt:s.createdAt,user:s?.author}):null,"post"===o?t.jsxs("div",{className:z.post_content_container,children:[t.jsx("h4",{style:{fontFamily:f.setting.postFont},className:z.post_title,children:s.title}),t.jsx("p",{className:z.post_content_date,children:U}),t.jsx(D,{content:s.content})]}):null,"preview"===o?t.jsxs("div",{className:z.post_content_container,children:[t.jsx(n,{style:{fontFamily:f.setting.postFont},to:`/post/${s._id}`,children:s.title}),t.jsx(D,{content:`${s.content.slice(0,250)}...`})]}):null,"comment"===o?t.jsx("div",{className:z.post_data,children:t.jsx(D,{content:s.content})}):null,t.jsxs("div",{className:`${z.post_tags_statistic_container} flex-row-center-space-between-medium`,children:["post"!==o&&"preview"!==o||!s.tags?null:t.jsx(J,{tags:s.tags}),t.jsxs("div",{className:"flex-row-center-normal-big",children:["preview"===o?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:`${z.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>R("views"):void 0,children:[t.jsx(l,{}),s.viewedBy?.length]}),t.jsxs("p",{className:`${z.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>R("comments"):void 0,children:[t.jsx(m,{}),s.comments?.length]}),t.jsxs("p",{className:`${z.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>R("likes"):void 0,children:[t.jsx(p,{}),s.likedBy?.length]})]}):null,"comment"!==o&&"post"!==o||!_.user?null:t.jsxs("button",{onClick:async()=>{s.isHidden&&!_.user||k((async e=>{const t=await j.get(`/${o}/${s._id}/like`,{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`});if("post"===o)return t;const a=e.state,n=a.comments||[];return{...a,comments:n.map((e=>e._id===t._id?t:e))}}))},className:`${C?z.post_liked:""} ${z.post_statistic_data} flex-row-center-normal-small`,children:[t.jsx(p,{}),s.likedBy.length]})]})]})]})})}const Z={preview_container:"ea",preview_body:"fa",preview_header:"ga",preview_item:"ha",preview_item_count:"ia"},Q={pagintion_list_button:"Ne",loader:"Oe"};function ee(){return t.jsxs("div",{style:{width:"100%"},className:"flex-row-normal-space-between-medium",children:[t.jsx("div",{className:Q.pagintion_list_button}),t.jsxs("div",{className:"flex-row-normal-normal-small",children:[t.jsx("div",{className:Q.pagintion_list_button}),t.jsx("div",{className:Q.pagintion_list_button}),t.jsx("div",{className:Q.pagintion_list_button})]}),t.jsx("div",{className:Q.pagintion_list_button})]})}const se={preview_loader:"de",loader:"ee"};function te(){return t.jsxs("div",{style:{paddingTop:"1rem"},className:"flex-column-normal-normal-medium",children:[t.jsx("div",{className:se.preview_loader}),t.jsx("div",{className:se.preview_loader}),t.jsx("div",{className:se.preview_loader}),t.jsx("div",{className:se.preview_loader}),t.jsx("div",{className:se.preview_loader}),t.jsx("div",{className:se.preview_loader})]})}const ae={views:t.jsx(l,{}),likes:t.jsx(p,{}),comments:t.jsx(m,{})},ne={views:"No body have viewed!",likes:"No body have liked!",comments:"No body have commented!"};function oe({statisticToPreview:e}){const s=x(),a=s.get(h["STATISTIC-PREVIEW-POST-ID"]),o=parseInt(s.get(h["LIST-PAGE"])||"0"),{data:i,prev:r,isPending:l,error:c}=I({deps:[`preview-${e}-${a}-${o}`],prev:[`preview-${e}-${a}-${0===o?0:o-1}`],request:async()=>j.get(`/post/preview/${e}/${a}/${o}`)}),d=r?.pagesCount||i?.pagesCount||0;return t.jsx("section",{className:Z.preview_container,children:t.jsxs("div",{className:`${Z.preview_body} main-content-container`,children:[t.jsxs("div",{className:`${Z.preview_header} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[ae[e],t.jsx("h4",{className:Z.preview_type,children:C.firstLetterToUpperCase(e||"")})]}),t.jsx(g,{onClick:()=>{s.remove([h["STATISTIC-TO-PREVIEW"],h["STATISTIC-PREVIEW-POST-ID"],h["LIST-PAGE"]])}})]}),l?t.jsx(ee,{}):d>1?t.jsx(S,{pagesCount:d}):null,l?t.jsx(te,{}):t.jsx("div",{style:{paddingTop:d>1?"0.5rem":"0rem"},className:Z.preview_item_count_list,children:c?t.jsx(A,{error:c.message}):0!==i?.items?.length&&i?i.items.map((e=>t.jsxs(n,{to:`/user/${e._id}`,className:`${Z.preview_item} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx($,{src:e.avatar,alt:e.name}),t.jsx("p",{children:e.name})]}),t.jsx("p",{className:Z.preview_item_count,children:R.formatNum(e.count)})]},200*Math.random()))):t.jsx(E,{option:{size:"SMALL"},label:ne[e]})})]})})}const ie=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const[e,a]=s.useState(10),n=x().get(h["STATISTIC-TO-PREVIEW"]),{mutate:o,...i}=N("all-posts"),{isFetching:r,isMutating:l,data:c,error:d}=I({deps:["all-posts"],request:async()=>await j.get(`/home/${e}`,T)});return t.jsxs(s.Fragment,{children:[l&&t.jsx(P,{}),t.jsxs("div",{style:{height:"100%"},className:"flex-row-normal-normal-medium",children:[t.jsx("div",{style:{flexGrow:1},className:"flex-column-normal-normal-small",children:r?t.jsx(H,{}):d?t.jsx(O,{error:d}):c&&0===c.length?t.jsx(E,{option:{flexCenterCenter:!0},label:"Nothing found!"}):c&&t.jsxs(s.Fragment,{children:[c.map((e=>t.jsx(Y,{post:e,type:"preview"},e._id))),i.error&&t.jsx(A,{error:i.error.message}),c.length%10==0?t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx(f,{onClick:async()=>{const s=e+10;a((e=>e+10)),await o((async()=>await j.get(`/home/${s}`))),r||l||setTimeout((()=>window.scrollTo({behavior:"smooth",top:document.body.scrollHeight})),100)},label:"Load More"})}):null]})}),n&&t.jsx(oe,{statisticToPreview:n})]})]})}},Symbol.toStringTag,{value:"Module"}));export{H as L,F as P,Y as a,ie as p,M as u};
