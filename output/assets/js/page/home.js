import{e,r as s,j as t,o as a,a as n,L as r,p as o,k as i,P as l,E as c,q as d,i as m,s as p,t as u,X as _}from"../react.js";import{A as x,u as h,f as j,c as v,a as g,_ as f,D as N,l as w,b as $,C as y,P as b,E as C,M as k}from"./admin.js";function E(){const t=e(),a=s.useContext(x),n=h(),r=n.get("login-modal"),o=n.get("registration-modal");return{...a?.userState,create:async function(e){try{if(e.setSession)return a?.updateUserState({user:e.setSession,isAuthPending:!1,isLoading:!1});a?.updateUserState({isAuthPending:!1,isLoading:!0});const s=await j.post(e.apiURL,e.body);a?.updateUserState({isAuthPending:!1,isLoading:!1,error:void 0,user:s}),e?.setToken&&v.set("PR_TOKEN",s.token),e?.redirectURL&&t(e.redirectURL)}catch(s){a.updateUserState((e=>({...e,isAuthPending:!1,isLoading:!1,error:s instanceof Error?{code:503,message:"Service Unavailable!"}:JSON.parse(s)})))}},out:function(){a?.updateUserState({isAuthPending:!1,isLoading:!1}),v.set("PR_TOKEN","undefined")},clearError:function(){s.useEffect((()=>{a?.updateUserState((e=>({...e,error:void 0})))}),[r,o])}}}const A={default_image:"d_",default_image_loader:"e_",loader:"f_"};function R({className:e,style:s}){return t.jsx("div",{style:s,className:`${A.default_image_loader} ${e}`})}function P({alt:e,classNames:n,src:r,styles:o}){const[i,l]=s.useState(!1),c=s.useRef("default"),d=s.useRef(null),m=(c.current?.search(/\http(s)/)||-1)>-1;return s.useEffect((()=>{d.current&&(d.current.addEventListener("loadstart",(()=>{l(!1)})),d.current.addEventListener("load",(e=>{const s=e.target;c.current=r,l(s.complete)}),{once:!0}),d.current.addEventListener("error",(()=>{c.current=void 0,l(!1)}),{once:!0}))}),[d.current]),t.jsxs(s.Fragment,{children:[m||i?!i&&m&&t.jsx(R,{className:n?.loader,style:o?.loader}):t.jsx(a,{className:`${n?.img} ${A.default_image}`,size:40}),t.jsx("img",{ref:d,src:r,alt:e,className:n?.img,style:{...o?.img,display:(m?c.current:i)?"block":"none"}})]})}const H={post_loader_container:"I_",post_loader_text:"J_",loader:"K_",post_loader_tag:"L_",post_loader_avatar:"M_"};function S(){return t.jsxs("div",{className:`${H.post_loader_container} main-content-container flex-column-normal-normal-medium`,children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:H.post_loader_avatar}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"4rem"},className:H.post_loader_text}),t.jsx("div",{style:{width:"7rem"},className:H.post_loader_text})]})]}),t.jsx("div",{style:{width:"11rem"},className:H.post_loader_text}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"50%"},className:H.post_loader_text}),t.jsx("div",{style:{width:"20%"},className:H.post_loader_text})]}),t.jsxs("div",{className:"flex-row-normal-space-between-none",children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:H.post_loader_tag}),t.jsx("div",{className:H.post_loader_tag}),t.jsx("div",{className:H.post_loader_tag})]}),t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:H.post_loader_tag}),t.jsx("div",{className:H.post_loader_tag}),t.jsx("div",{className:H.post_loader_tag})]})]})]})}function O(e){s.useEffect((()=>{e.title&&(document.title=e.title)}),[e]),s.useEffect((()=>{delete e.title;const s=Object.entries(e);for(let[e,t]of s){const s=document.createElement("meta");s.name=e,s.content=t,document.head.appendChild(s)}}),[])}function T({containersCount:e}){return O({title:"Home",description:"Hier kannst du alle letzt geschriebene posts ansehen."}),t.jsx("div",{className:"flex-column-normal-normal-small",children:[...Array(e||3)].map(((e,s)=>t.jsx(S,{},s)))})}const L={error_container:"a",error_body:"b",error_error:"c"};function I({code:e,message:s,underText:a}){return t.jsx("div",{className:`${L.error_container} flex-row-center-center-none`,children:t.jsxs("div",{className:L.error_body,children:[t.jsxs("div",{className:`${L.error_error} flex-column-normal-normal-none`,children:[t.jsxs("p",{children:["Error - ",e,"!"]}),t.jsx("p",{children:s})]}),a?t.jsx("p",{children:a}):null]})})}const U={post_content_container:"N_",post_short_view:"O_",post_content_date:"P_",post_data:"Q_",post_hidden:"R_",post_statistic_data:"S_",post_liked:"T_",like:"U_"},z={post_header:"Ya",post_header_author_not_defined:"Za",post_action_button:"_c",post_action_container:"-c",post_create_date:"ac"};function B({user:s,createdAt:a,type:m,contentID:p,postID:u,content:_,tags:x,title:y,isHidden:b}){const C=g(),{mutate:k,changeError:E}=f({deps:[]}),A=h(),R=e(),{pathname:H}=n(),S=C.isHaveRoleOrIsIDEqual(["Admin","Creator"],s?._id)?.result(),O=H.search("/post/")>-1,T=H.search("/")>-1,L=H.search("/search")>-1,I="preview"===m?"post":m,U=parseInt(A.get("page")||"0"),B=e=>{const s=O&&"comment"===m?[`post-${u}-comments-${A.get("page")||0}`]:T?["all-posts"]:[];if(!C.isHaveRole(["Creator","Admin"]).result())return E(s,{code:403,message:"You have no edit and remove permission!"});if("edit"===e){if(C.isHaveRole(["Creator"]).result())return w.set(p,{content:_,tags:x,title:y,contentType:I,onPage:U,onPost:u}),R(`/write-post?is-edit=true&content-id=${p}`);if(C.isHaveRole(["Admin"]).result())return R(`/admin/${I}?id=${p}&${I}-edit-modal=true`)}k({key:s,request:async s=>{if("remove"===e){const e=await j.get(`/admin/remove/${$(I)}/${p}`,{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`});if(O&&"comment"===m){const t=s.state||{comments:[],pagesCount:0};if(1===t.comments.length&&t.pagesCount>=1){for(let e=t.pagesCount-1;e>=0;e--)e!==U&&s.removeCache(`post-${u}-comments-${e}`);return R(`/post/${u}?page=${+U-1}`),{pagesCount:0,comments:[]}}return{...t,comments:t.comments.filter((s=>s._id!==e._id))}}if(T){return(s.state||[]).filter((s=>s._id!==e._id))}}const t=await j.post(`/admin/${I}/update`,{id:p,isHidden:"hidde"===e},{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`});if(O){const e=s.state||{pagesCount:0,comments:[]};return{...e,comments:e.comments.map((e=>e._id===t._id?{...e,...t}:e))}}return(s.state||[]).map((e=>e._id===t._id?t:e))}})};return t.jsxs("div",{className:`${z.post_header} flex-row-center-space-between-none`,children:[s?t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx(P,{src:s?.avatar,alt:s?.name||"User avatar"}),t.jsxs("div",{className:z.post_author,children:[t.jsx(r,{to:`/user/${s?._id}`,children:s?.name}),t.jsx("p",{className:z.post_create_date,children:N.getDifference(a)})]})]}):t.jsxs("div",{className:`${z.post_header_author_not_defined} flex-row-center-normal-medium`,children:[t.jsx(o,{}),t.jsx("p",{children:"Author is possibly deleted!"})]}),S&&!L?t.jsxs("button",{className:z.post_action_button,children:[t.jsx("svg",{viewBox:"0 0 128 512",children:t.jsx("path",{d:"M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"})}),t.jsxs("ul",{className:`${z.post_action_container} flex-column-normal-normal-none`,children:[t.jsxs("li",{onClick:()=>B("remove"),className:"flex-row-center-normal-medium",children:[t.jsx(i,{}),t.jsx("p",{children:"Remove"})]}),t.jsxs("li",{onClick:()=>B("edit"),className:"flex-row-center-normal-medium",children:[t.jsx(l,{}),t.jsx("p",{children:"Edit"})]}),t.jsxs("li",{onClick:()=>B(b?"show":"hidde"),className:"flex-row-center-normal-medium",children:[b?t.jsx(c,{}):t.jsx(d,{}),t.jsx("p",{children:b?"Show":"Hidden"})]})]})]}):null]})}const D={post_wrapper_container:"Qa",post_is_hidden:"Ra"};function q({children:e,className:s}){return t.jsxs("section",{className:`${D.post_wrapper_container} ${s} main-content-container`,children:[s?t.jsxs("div",{className:`${D.post_is_hidden} flex-row-center-center-medium`,children:[t.jsx(d,{}),t.jsx("p",{children:"Hidden"})]}):null,t.jsx("div",{style:{padding:"1rem"},children:e})]})}const M={post_tags:"Ea"};function K({tags:e}){return t.jsx("div",{className:`${M.post_tags} flex-row-normal-normal-medium`,children:e.map((e=>e.trim()?t.jsx(r,{to:`/search?tag=${e}`,children:e},e):null))})}function F({post:s,type:a}){const{id:o}=m(),{pathname:i}=n(),l=E(),d=h(),_=g(),x=e(),{mutate:w}=f({deps:[]}),$=i.search("/post")>-1,b="/"===i,C=s.likedBy.includes(l.user?._id||""),k=_.isHaveRoleAndIsIDEqual(["Creator"],s?.author?._id).result(),A=_.isHaveRole(["Admin"]).result(),R=s.isHidden,P="preview"===a||"post"===a?s._id:o,H="comment"===a?parseInt(d.get("page")||"0"):0,S=R&&A||k&&R?U.post_hidden:"";R&&$&&!A&&!k&&"post"===a&&x("/");const O=e=>{d.set({type:e,"post-id":s._id,"list-page":0})};return t.jsx(t.Fragment,{children:b&&!k&&!A&&R?null:t.jsxs(q,{className:S,children:["comment"===a||"preview"===a?t.jsx(B,{tags:s.tags||[],title:s.title||"",content:s.content,isHidden:s.isHidden,postID:P,contentID:s._id,type:a,createdAt:s.createdAt,user:s?.author}):null,"post"===a?t.jsxs("div",{className:U.post_content_container,children:[t.jsx("h4",{children:s.title}),t.jsx("p",{className:U.post_content_date,children:N.getDifference(s.createdAt)}),t.jsx(y,{className:U.post_short_view,content:s.content})]}):null,"preview"===a?t.jsxs("div",{className:U.post_content_container,children:[t.jsx(r,{to:`/post/${s._id}`,children:s.title}),t.jsx(y,{className:U.post_short_view,content:s.content})]}):null,"comment"===a?t.jsx("div",{className:U.post_data,children:t.jsx(y,{content:s.content})}):null,t.jsxs("div",{className:"flex-row-center-space-between-none",children:["post"!==a&&"preview"!==a||!s.tags?null:t.jsx(K,{tags:s.tags}),t.jsxs("div",{className:"flex-row-center-normal-big",children:["preview"===a?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:`${U.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>O("views"):void 0,children:[t.jsx(c,{}),s.viewedBy?.length]}),t.jsxs("p",{className:`${U.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>O("comments"):void 0,children:[t.jsx(p,{}),s.comments?.length]}),t.jsxs("p",{className:`${U.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>O("likes"):void 0,children:[t.jsx(u,{}),s.likedBy?.length]})]}):null,"comment"!==a&&"post"!==a||!l.user?null:t.jsxs("button",{onClick:async()=>{if(s.isHidden&&!l.user)return;const e="post"===a?[`post-${s._id}`]:[`post-${P}-comments-${H}`];w({key:e,request:async e=>{const t=await j.get(`/${a}/${s._id}/like`,{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`});if("post"===a)return t;const n=e.state,r=n.comments||[];return{...n,comments:r.map((e=>e._id===t._id?t:e))}}})},className:`${C?U.post_liked:""} ${U.post_statistic_data} flex-row-center-normal-small`,children:[t.jsx(u,{}),s.likedBy.length]})]})]})]})})}const G={button:"ua",button_label:"va"};function J({label:e,className:s,onClick:a,type:n,isDisable:r}){return t.jsx("button",{type:n||"button",style:{width:13*e.length+"px"},disabled:r,className:`${G.button} ${s}`,onClick:a,children:t.jsx("section",{className:G.button_label,children:e})})}const Q={preview_container:"ga",preview_header:"ha",preview_item_count:"ia"},Y={pagintion_list_button:"pc",loader:"qc"};function Z(){return t.jsxs("div",{className:"flex-row-normal-space-between-medium",children:[t.jsx("div",{className:Y.pagintion_list_button}),t.jsxs("div",{className:"flex-row-normal-normal-small",children:[t.jsx("div",{className:Y.pagintion_list_button}),t.jsx("div",{className:Y.pagintion_list_button}),t.jsx("div",{className:Y.pagintion_list_button})]}),t.jsx("div",{className:Y.pagintion_list_button})]})}const V={preview_loader:"ic",loader:"jc"};function W(){return t.jsxs("div",{style:{paddingTop:"1rem"},className:"flex-column-normal-normal-medium",children:[t.jsx("div",{className:V.preview_loader}),t.jsx("div",{className:V.preview_loader}),t.jsx("div",{className:V.preview_loader}),t.jsx("div",{className:V.preview_loader}),t.jsx("div",{className:V.preview_loader}),t.jsx("div",{className:V.preview_loader})]})}function X({type:e}){const s=h(),a=s.get("post-id"),n=parseInt(s.get("list-page")||"0"),o={views:t.jsx(c,{}),likes:t.jsx(u,{}),comments:t.jsx(p,{})},{data:i,prev:l,isPending:d}=f({deps:[`preview-${e}-${a}-${n}`],prev:[`preview-${e}-${a}-${n-1<0?0:n-1}`],request:async()=>j.get(`/post/preview/${e}/${a}/${n}`)}),m=l?.pagesCount||i?.pagesCount||0;return t.jsxs("section",{className:`${Q.preview_container} main-content-container`,children:[t.jsxs("div",{className:`${Q.preview_header} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[o[e],t.jsx("h4",{className:Q.preview_type,children:$(e||"")})]}),t.jsx(_,{onClick:()=>{s.remove(["type","post-id","list-page"])}})]}),d?t.jsx(Z,{}):m>1?t.jsx(b,{pagesCount:m}):null,d?t.jsx(W,{}):t.jsx("div",{style:{paddingTop:m>1?"0.5rem":"0rem"},className:Q.preview_item_count_list,children:0===i?.items?.length?t.jsx(C,{label:"Nothing found!"}):i?.items?.map((e=>t.jsxs(r,{to:`/user/${e._id}`,className:"flex-row-center-space-between-none",children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(P,{src:e.avatar,alt:e.name}),t.jsx("p",{children:e.name})]}),t.jsx("p",{className:Q.preview_item_count,children:e.count})]},200*Math.random())))})]})}const ee=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const e=h(),{isFetching:a,isMutating:n,data:r,error:o,mutate:i}=f({deps:["all-posts"],request:async()=>await j.get(`/home/${l}`,{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`})}),l=parseInt(e.get("posts-count")||String(10)),c=e.get("type");return t.jsxs(s.Fragment,{children:[n?t.jsx(k,{}):null,t.jsxs("div",{style:{height:"100%",marginRight:c?"17rem":"0rem"},className:"flex-row-normal-normal-medium",children:[t.jsx("div",{style:{flexGrow:1},className:"flex-column-normal-normal-small",children:a?t.jsx(T,{}):o?t.jsx(I,{underText:"Go back or reload the page!",code:o.code,message:o.message}):r&&0===r.length?t.jsx(C,{option:{flexCenterCenter:!0},label:"No post would founded!"}):r&&t.jsxs(s.Fragment,{children:[r.map((e=>t.jsx(F,{post:e,type:"preview"},e._id))),r.length%10==0?t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx(J,{onClick:async()=>{const s=l+10;e.set({"posts-count":s}),await i({key:["all-posts"],request:async()=>await j.get(`/home/${s}`)}),a||n||setTimeout((()=>window.scrollTo({behavior:"smooth",top:document.body.scrollHeight})),100)},label:"Load More"})}):null]})}),c?t.jsx(X,{type:c}):null]})]})}},Symbol.toStringTag,{value:"Module"}));export{J as B,I as E,P as I,T as L,S as P,F as a,E as b,ee as p,O as u};
