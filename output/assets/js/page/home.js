import{c as e,r as s,j as t,b as a,L as n,x as o,h as r,P as i,E as l,y as d,g as c,z as m,D as p,X as u}from"../react.js";import{u as _}from"./about.js";import{j as x,u as h,f as j,i as v,e as g,_ as w,D as f,l as N,C as y,d as $,U as T,k as C,L as b,E as S,A,M as I,P,B as E}from"./admin.js";import{I as k,C as L,c as O}from"./database.js";function H(){const t=e(),a=s.useContext(x),n=h(),o=n.get("login-modal"),r=n.get("registration-modal");return{...a?.userState,create:async function(e){try{if(e.setSession)return a?.updateUserState({user:e.setSession,isAuthPending:!1,isLoading:!1});a?.updateUserState({isAuthPending:!1,isLoading:!0});const s=await j.post(e.apiURL,e.body);a?.updateUserState({isAuthPending:!1,isLoading:!1,error:void 0,user:s}),e?.setToken&&v.set("PR_TOKEN",s.token),e?.redirectURL&&t(e.redirectURL)}catch(s){a.updateUserState((e=>({...e,isAuthPending:!1,isLoading:!1,error:s instanceof Error?{code:503,message:"Service Unavailable!"}:JSON.parse(s)})))}},out:function(){a?.updateUserState({isAuthPending:!1,isLoading:!1}),v.set("PR_TOKEN","undefined")},clearError:function(){s.useEffect((()=>{a?.updateUserState((e=>({...e,error:void 0})))}),[o,r])}}}const U={post_loader_container:"s_",post_loader_text:"t_",loader:"u_",post_loader_tag:"v_",post_loader_avatar:"w_"};function D(){return t.jsxs("div",{className:`${U.post_loader_container} main-content-container flex-column-normal-normal-medium`,children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:U.post_loader_avatar}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"4rem"},className:U.post_loader_text}),t.jsx("div",{style:{width:"7rem"},className:U.post_loader_text})]})]}),t.jsx("div",{style:{width:"11rem"},className:U.post_loader_text}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"50%"},className:U.post_loader_text}),t.jsx("div",{style:{width:"20%"},className:U.post_loader_text})]}),t.jsxs("div",{className:"flex-row-normal-space-between-none",children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:U.post_loader_tag}),t.jsx("div",{className:U.post_loader_tag}),t.jsx("div",{className:U.post_loader_tag})]}),t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:U.post_loader_tag}),t.jsx("div",{className:U.post_loader_tag}),t.jsx("div",{className:U.post_loader_tag})]})]})]})}function R({containersCount:e}){return _({title:"Home",description:"Hier kannst du alle letzt geschriebene posts ansehen."}),t.jsx("div",{className:"flex-column-normal-normal-small",children:[...Array(e||3)].map(((e,s)=>t.jsx(D,{},s)))})}const z={post_content_container:"Ya",post_title:"Za",post_short_view:"_c",post_content_date:"-c",post_tags_statistic_container:"ac",post_data:"bc",post_hidden:"cc",post_statistic_data:"dc",post_liked:"ec",like:"fc"},B={post_header:"we",post_header_author_not_defined:"xe",post_action_button:"ye",post_action_container:"ze",post_create_date:"Ae"};function K({user:s,createdAt:c,type:m,contentID:p,postID:u,content:_,tags:x,title:$,isHidden:T}){const C=g(),b=h(),S=e(),{mutate:A,changeError:I}=w({deps:[]}),{pathname:P}=a(),E=C.roleAndEqual(["Admin","Creator"],"_id",s?._id).permited(),L=P.search("/post/")>-1,O=P.search("/")>-1,H=P.search("/search")>-1,U="preview"===m?"post":m,D=parseInt(b.get("page")||"0"),R=e=>{const s=L&&"comment"===m?[`post-${u}-comments-${b.get("page")||0}`]:O?["all-posts"]:[];if(!C.role(["Creator","Admin"]).permited())return I({code:403,message:"You have no edit and remove permission!"});if("edit"===e){if(C.role(["Creator"]).permited())return N.set(p,{content:_,tags:x,title:$,isHidden:T,isEdit:!0,contentType:U,onPage:D,onPost:u}),S(`/write-post?content-id=${p}`);if(C.role(["Admin"]).permited())return S(`/admin/${U}?id=${p}&${U}-edit-modal=true`)}A({key:s,request:async s=>{if("remove"===e){const e=await j.get(`/admin/remove/${y.firstLetterToUpperCase(U)}/${p}`,{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`});if(L&&"comment"===m){const t=s.state||{comments:[],pagesCount:0};if(1===t.comments.length&&t.pagesCount>=1){for(let e=t.pagesCount-1;e>=0;e--)e!==D&&s.removeCache(`post-${u}-comments-${e}`);return S(`/post/${u}?page=${+D-1}`),{pagesCount:0,comments:[]}}return{...t,comments:t.comments.filter((s=>s._id!==e._id))}}if(O){return(s.state||[]).filter((s=>s._id!==e._id))}}const t=await j.post(`/admin/${U}/update`,{id:p,isHidden:"hidde"===e},{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`});if(L){const e=s.state||{pagesCount:0,comments:[]};return{...e,comments:e.comments.map((e=>e._id===t._id?{...e,...t}:e))}}return(s.state||[]).map((e=>e._id===t._id?t:e))}})},z=f.getDifference(c).getSortDate({year:"[year] year [month] months ago!",month:"[month] month [day] days ago!",day:"[day] day [hour] hours ago!",hour:"[hour] hour [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsxs("div",{className:`${B.post_header} flex-row-center-space-between-none`,children:[s?t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(k,{styles:{svg:{width:"2rem",height:"2rem"},img:{width:"2rem",height:"2rem"}},src:s?.avatar,alt:s?.name||"User avatar"}),t.jsxs("div",{className:B.post_author,children:[t.jsx(n,{to:`/user/${s?._id}`,children:s?.name}),t.jsx("p",{className:B.post_create_date,children:z})]})]}):t.jsxs("div",{className:`${B.post_header_author_not_defined} flex-row-center-normal-medium`,children:[t.jsx(o,{}),t.jsx("p",{children:"Author is possibly deleted!"})]}),E&&!H?t.jsxs("button",{className:B.post_action_button,children:[t.jsx("svg",{viewBox:"0 0 128 512",children:t.jsx("path",{d:"M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"})}),t.jsxs("ul",{className:`${B.post_action_container} flex-column-normal-normal-none`,children:[t.jsxs("li",{onClick:()=>R("remove"),className:"flex-row-center-normal-medium",children:[t.jsx(r,{}),t.jsx("p",{children:"Remove"})]}),t.jsxs("li",{onClick:()=>R("edit"),className:"flex-row-center-normal-medium",children:[t.jsx(i,{}),t.jsx("p",{children:"Edit"})]}),t.jsxs("li",{onClick:()=>R(T?"show":"hidde"),className:"flex-row-center-normal-medium",children:[T?t.jsx(l,{}):t.jsx(d,{}),t.jsx("p",{children:T?"Show":"Hidden"})]})]})]}):null]})}const M={post_wrapper_container:"de",post_is_hidden:"ee"};function q({children:e,className:s}){return t.jsxs("section",{className:`${M.post_wrapper_container} ${s} main-content-container`,children:[s?t.jsxs("div",{className:`${M.post_is_hidden} flex-row-center-center-medium`,children:[t.jsx(d,{}),t.jsx("p",{children:"Hidden"})]}):null,t.jsx("div",{style:{padding:"1rem"},children:e})]})}const F={post_tags:"fe"};function G({tags:e}){return t.jsx("div",{className:`${F.post_tags} flex-row-normal-normal-medium`,children:e.map((e=>e.trim()?t.jsx(n,{to:`/search?tag=${e}`,children:e},e):null))})}function V({post:s,type:o}){const{id:r}=c(),{pathname:i}=a(),d=e(),u=H(),_=h(),x=g(),w=i.search("/post")>-1,N="/"===i,y=s.likedBy.includes(u.user?._id||""),C=x.role(["Creator"]).equal("_id",s?.author?._id).permited(),b=x.role(["Admin"]).permited(),S=s.isHidden,A="preview"===o||"post"===o?s._id:r,I="comment"===o?parseInt(_.get("page")||"0"):0,P=S&&b||C&&S?z.post_hidden:"",E="post"===o?`post-${s._id}`:`post-${A}-comments-${I}`,{mutate:k}=$(E);S&&w&&!b&&!C&&"post"===o&&d("/");const O=e=>{_.set({[T["STATISTIC-TO-CHECK"]]:e,[T["STATISTIC-PREVIEW-POST-ID"]]:s._id,[T["LIST-PAGE"]]:0})},U=f.getDifference(s.createdAt).getSortDate({year:"[year] years [month] months ago!",month:"[month] months [day] days ago!",day:"[day] days [hour] hours ago!",hour:"[hour] hours [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsx(t.Fragment,{children:N&&!C&&!b&&S?null:t.jsxs(q,{className:P,children:["comment"===o||"preview"===o?t.jsx(K,{tags:s.tags||[],title:s.title||"",content:s.content,isHidden:s.isHidden,postID:A,contentID:s._id,type:o,createdAt:s.createdAt,user:s?.author}):null,"post"===o?t.jsxs("div",{className:z.post_content_container,children:[t.jsx("h4",{className:z.post_title,children:s.title}),t.jsx("p",{className:z.post_content_date,children:U}),t.jsx(L,{content:s.content})]}):null,"preview"===o?t.jsxs("div",{className:z.post_content_container,children:[t.jsx(n,{to:`/post/${s._id}`,children:s.title}),t.jsx(L,{className:z.post_short_view,content:s.content.slice(0,200)})]}):null,"comment"===o?t.jsx("div",{className:z.post_data,children:t.jsx(L,{content:s.content})}):null,t.jsxs("div",{className:`${z.post_tags_statistic_container} flex-row-center-space-between-medium`,children:["post"!==o&&"preview"!==o||!s.tags?null:t.jsx(G,{tags:s.tags}),t.jsxs("div",{className:"flex-row-center-normal-big",children:["preview"===o?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:`${z.post_statistic_data} flex-row-center-normal-small`,onClick:N?()=>O("views"):void 0,children:[t.jsx(l,{}),s.viewedBy?.length]}),t.jsxs("p",{className:`${z.post_statistic_data} flex-row-center-normal-small`,onClick:N?()=>O("comments"):void 0,children:[t.jsx(m,{}),s.comments?.length]}),t.jsxs("p",{className:`${z.post_statistic_data} flex-row-center-normal-small`,onClick:N?()=>O("likes"):void 0,children:[t.jsx(p,{}),s.likedBy?.length]})]}):null,"comment"!==o&&"post"!==o||!u.user?null:t.jsxs("button",{onClick:async()=>{s.isHidden&&!u.user||k((async e=>{const t=await j.get(`/${o}/${s._id}/like`,{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`});if("post"===o)return t;const a=e.state,n=a.comments||[];return{...a,comments:n.map((e=>e._id===t._id?t:e))}}))},className:`${y?z.post_liked:""} ${z.post_statistic_data} flex-row-center-normal-small`,children:[t.jsx(p,{}),s.likedBy.length]})]})]})]})})}const W={preview_container:"Ta",preview_body:"Ua",preview_header:"Va",preview_item:"Wa",preview_item_count:"Xa"},J={pagintion_list_button:"Je",loader:"Ke"};function Y(){return t.jsxs("div",{style:{width:"100%"},className:"flex-row-normal-space-between-medium",children:[t.jsx("div",{className:J.pagintion_list_button}),t.jsxs("div",{className:"flex-row-normal-normal-small",children:[t.jsx("div",{className:J.pagintion_list_button}),t.jsx("div",{className:J.pagintion_list_button}),t.jsx("div",{className:J.pagintion_list_button})]}),t.jsx("div",{className:J.pagintion_list_button})]})}const X={preview_loader:"Be",loader:"Ce"};function Z(){return t.jsxs("div",{style:{paddingTop:"1rem"},className:"flex-column-normal-normal-medium",children:[t.jsx("div",{className:X.preview_loader}),t.jsx("div",{className:X.preview_loader}),t.jsx("div",{className:X.preview_loader}),t.jsx("div",{className:X.preview_loader}),t.jsx("div",{className:X.preview_loader}),t.jsx("div",{className:X.preview_loader})]})}const Q={views:t.jsx(l,{}),likes:t.jsx(p,{}),comments:t.jsx(m,{})},ee={views:"No body have viewed!",likes:"No body have liked!",comments:"No body have commented!"};function se({statisticToPreview:e}){const s=h(),a=s.get(T["STATISTIC-PREVIEW-POST-ID"]),o=parseInt(s.get(T["LIST-PAGE"])||"0"),{data:r,prev:i,isPending:l,error:d}=w({deps:[`preview-${e}-${a}-${o}`],prev:[`preview-${e}-${a}-${0===o?0:o-1}`],request:async()=>j.get(`/post/preview/${e}/${a}/${o}`)}),c=i?.pagesCount||r?.pagesCount||0;return t.jsx("section",{className:W.preview_container,children:t.jsxs("div",{className:`${W.preview_body} main-content-container`,children:[t.jsxs("div",{className:`${W.preview_header} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[Q[e],t.jsx("h4",{className:W.preview_type,children:y.firstLetterToUpperCase(e||"")})]}),t.jsx(u,{onClick:()=>{s.remove([T["STATISTIC-TO-CHECK"],T["STATISTIC-PREVIEW-POST-ID"],T["LIST-PAGE"]])}})]}),l?t.jsx(Y,{}):c>1?t.jsx(C,{pagesCount:c}):null,l?t.jsx(Z,{}):t.jsx("div",{style:{paddingTop:c>1?"0.5rem":"0rem"},className:W.preview_item_count_list,children:d?t.jsx(b,{error:d.message}):0!==r?.items?.length&&r?r.items.map((e=>t.jsxs(n,{to:`/user/${e._id}`,className:`${W.preview_item} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(k,{src:e.avatar,alt:e.name}),t.jsx("p",{children:e.name})]}),t.jsx("p",{className:W.preview_item_count,children:O.formatNum(e.count)})]},200*Math.random()))):t.jsx(S,{option:{size:"SMALL"},label:ee[e]})})]})})}const te=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const[e,a]=s.useState(10),n=h().get(T["STATISTIC-TO-CHECK"]),{mutate:o,...r}=$("all-posts"),{isFetching:i,isMutating:l,data:d,error:c}=w({deps:["all-posts"],request:async()=>await j.get(`/home/${e}`,A)});return t.jsxs(s.Fragment,{children:[l&&t.jsx(I,{}),t.jsxs("div",{style:{height:"100%"},className:"flex-row-normal-normal-medium",children:[t.jsx("div",{style:{flexGrow:1},className:"flex-column-normal-normal-small",children:i?t.jsx(R,{}):c?t.jsx(P,{error:c}):d&&0===d.length?t.jsx(S,{option:{flexCenterCenter:!0},label:"No post would founded!"}):d&&t.jsxs(s.Fragment,{children:[d.map((e=>t.jsx(V,{post:e,type:"preview"},e._id))),r.error&&t.jsx(b,{error:r.error.message}),d.length%10==0?t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx(E,{onClick:async()=>{const s=e+10;a((e=>e+10)),await o((async()=>await j.get(`/home/${s}`))),i||l||setTimeout((()=>window.scrollTo({behavior:"smooth",top:document.body.scrollHeight})),100)},label:"Load More"})}):null]})}),n&&t.jsx(se,{statisticToPreview:n})]})]})}},Symbol.toStringTag,{value:"Module"}));export{R as L,D as P,V as a,te as p,H as u};
