import{c as e,r as s,j as t,l as a,a as n,L as o,m as r,h as i,P as l,E as c,n as d,g as m,o as p,H as u,X as _}from"../react.js";import{A as x,u as h,f as j,c as g,a as v,_ as f,D as N,l as w,b as y,C as $,P as b,E as C,M as k}from"./admin.js";function E(){const t=e(),a=s.useContext(x),n=h(),o=n.get("login-modal"),r=n.get("registration-modal");return{...a?.userState,create:async function(e){try{if(e.setSession)return a?.updateUserState({user:e.setSession,isAuthPending:!1,isLoading:!1});a?.updateUserState({isAuthPending:!1,isLoading:!0});const s=await j.post(e.apiURL,e.body);a?.updateUserState({isAuthPending:!1,isLoading:!1,error:void 0,user:s}),e?.setToken&&g.set("PR_TOKEN",s.token),e?.redirectURL&&t(e.redirectURL)}catch(s){a.updateUserState((e=>({...e,isAuthPending:!1,isLoading:!1,error:s instanceof Error?{code:503,message:"Service Unavailable!"}:JSON.parse(s)})))}},out:function(){a?.updateUserState({isAuthPending:!1,isLoading:!1}),g.set("PR_TOKEN","undefined")},clearError:function(){s.useEffect((()=>{a?.updateUserState((e=>({...e,error:void 0})))}),[o,r])}}}const A={default_image:"V_",default_image_loader:"W_",loader:"X_"};function P({className:e,style:s}){return t.jsx("div",{style:s,className:`${A.default_image_loader} ${e}`})}function S({alt:e,classNames:n,src:o,styles:r}){const[i,l]=s.useState(!1),c=s.useRef("default"),d=s.useRef(null),m=(c.current?.search(/\http(s)/)||-1)>-1;return s.useEffect((()=>{d.current&&(d.current.addEventListener("loadstart",(()=>{l(!1)})),d.current.addEventListener("load",(e=>{const s=e.target;c.current=o,l(s.complete)}),{once:!0}),d.current.addEventListener("error",(()=>{c.current=void 0,l(!1)}),{once:!0}))}),[d.current]),t.jsxs(s.Fragment,{children:[m||i?!i&&m&&t.jsx(P,{className:n?.loader,style:r?.loader}):t.jsx(a,{className:`${n?.img} ${A.default_image}`,size:40}),t.jsx("img",{ref:d,src:o,alt:e,className:n?.img,style:{...r?.img,display:m&&c.current||i?"block":"none"}})]})}const T={post_loader_container:"_a",post_loader_text:"-a",loader:"aa",post_loader_tag:"ba",post_loader_avatar:"ca"};function L(){return t.jsxs("div",{className:`${T.post_loader_container} main-content-container flex-column-normal-normal-medium`,children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:T.post_loader_avatar}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"4rem"},className:T.post_loader_text}),t.jsx("div",{style:{width:"7rem"},className:T.post_loader_text})]})]}),t.jsx("div",{style:{width:"11rem"},className:T.post_loader_text}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"50%"},className:T.post_loader_text}),t.jsx("div",{style:{width:"20%"},className:T.post_loader_text})]}),t.jsxs("div",{className:"flex-row-normal-space-between-none",children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:T.post_loader_tag}),t.jsx("div",{className:T.post_loader_tag}),t.jsx("div",{className:T.post_loader_tag})]}),t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:T.post_loader_tag}),t.jsx("div",{className:T.post_loader_tag}),t.jsx("div",{className:T.post_loader_tag})]})]})]})}function O(e){s.useEffect((()=>{e.title&&(document.title=e.title)}),[e]),s.useEffect((()=>{delete e.title;const s=Object.entries(e);for(let[e,t]of s){const s=document.createElement("meta");s.name=e,s.content=t,document.head.appendChild(s)}}),[])}function H({containersCount:e}){return O({title:"Home",description:"Hier kannst du alle letzt geschriebene posts ansehen."}),t.jsx("div",{className:"flex-column-normal-normal-small",children:[...Array(e||3)].map(((e,s)=>t.jsx(L,{},s)))})}const R={error_container:"k",error_body:"l",error_error:"m"};function z({code:e,message:s,underText:a}){return t.jsx("div",{className:`${R.error_container} flex-row-center-center-none`,children:t.jsxs("div",{className:R.error_body,children:[t.jsxs("div",{className:`${R.error_error} flex-column-normal-normal-none`,children:[t.jsxs("p",{children:["Error - ",e,"!"]}),t.jsx("p",{children:s})]}),a?t.jsx("p",{children:a}):null]})})}const U={post_content_container:"__",post_short_view:"-_",post_content_date:"a_",post_data:"b_",post_hidden:"c_",post_statistic_data:"d_",post_liked:"e_",like:"f_"},B={post_header:"nc",post_header_author_not_defined:"oc",post_action_button:"pc",post_action_container:"qc",post_create_date:"rc"};function D({user:s,createdAt:a,type:m,contentID:p,postID:u,content:_,tags:x,title:$,isHidden:b}){const C=v(),k=h(),E=e(),{mutate:A,changeError:P}=f({deps:[]}),{pathname:T}=n(),L=C.roleAndEqual(["Admin","Creator"],"_id",s?._id).permited(),O=T.search("/post/")>-1,H=T.search("/")>-1,R=T.search("/search")>-1,z="preview"===m?"post":m,U=parseInt(k.get("page")||"0"),D=e=>{const s=O&&"comment"===m?[`post-${u}-comments-${k.get("page")||0}`]:H?["all-posts"]:[];if(!C.role(["Creator","Admin"]).permited())return P(s,{code:403,message:"You have no edit and remove permission!"});if("edit"===e){if(C.role(["Creator"]).permited())return w.set(p,{content:_,tags:x,title:$,isHidden:b,contentType:z,onPage:U,onPost:u}),E(`/write-post?is-edit=true&content-id=${p}`);if(C.role(["Admin"]).permited())return E(`/admin/${z}?id=${p}&${z}-edit-modal=true`)}A({key:s,request:async s=>{if("remove"===e){const e=await j.get(`/admin/remove/${y(z)}/${p}`,{Authorization:`Bearer ${g.getOne("PR_TOKEN")}`});if(O&&"comment"===m){const t=s.state||{comments:[],pagesCount:0};if(1===t.comments.length&&t.pagesCount>=1){for(let e=t.pagesCount-1;e>=0;e--)e!==U&&s.removeCache(`post-${u}-comments-${e}`);return E(`/post/${u}?page=${+U-1}`),{pagesCount:0,comments:[]}}return{...t,comments:t.comments.filter((s=>s._id!==e._id))}}if(H){return(s.state||[]).filter((s=>s._id!==e._id))}}const t=await j.post(`/admin/${z}/update`,{id:p,isHidden:"hidde"===e},{Authorization:`Bearer ${g.getOne("PR_TOKEN")}`});if(O){const e=s.state||{pagesCount:0,comments:[]};return{...e,comments:e.comments.map((e=>e._id===t._id?{...e,...t}:e))}}return(s.state||[]).map((e=>e._id===t._id?t:e))}})},I=N.getDifference(a).getSortDate({year:"[year] year [month] months ago!",month:"[month] month [day] days ago!",day:"[day] day [hour] hours ago!",hour:"[hour] hour [minute] minutes ago!",minute:"days [minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsxs("div",{className:`${B.post_header} flex-row-center-space-between-none`,children:[s?t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx(S,{src:s?.avatar,alt:s?.name||"User avatar"}),t.jsxs("div",{className:B.post_author,children:[t.jsx(o,{to:`/user/${s?._id}`,children:s?.name}),t.jsx("p",{className:B.post_create_date,children:I})]})]}):t.jsxs("div",{className:`${B.post_header_author_not_defined} flex-row-center-normal-medium`,children:[t.jsx(r,{}),t.jsx("p",{children:"Author is possibly deleted!"})]}),L&&!R?t.jsxs("button",{className:B.post_action_button,children:[t.jsx("svg",{viewBox:"0 0 128 512",children:t.jsx("path",{d:"M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"})}),t.jsxs("ul",{className:`${B.post_action_container} flex-column-normal-normal-none`,children:[t.jsxs("li",{onClick:()=>D("remove"),className:"flex-row-center-normal-medium",children:[t.jsx(i,{}),t.jsx("p",{children:"Remove"})]}),t.jsxs("li",{onClick:()=>D("edit"),className:"flex-row-center-normal-medium",children:[t.jsx(l,{}),t.jsx("p",{children:"Edit"})]}),t.jsxs("li",{onClick:()=>D(b?"show":"hidde"),className:"flex-row-center-normal-medium",children:[b?t.jsx(c,{}):t.jsx(d,{}),t.jsx("p",{children:b?"Show":"Hidden"})]})]})]}):null]})}const I={post_wrapper_container:"fc",post_is_hidden:"gc"};function q({children:e,className:s}){return t.jsxs("section",{className:`${I.post_wrapper_container} ${s} main-content-container`,children:[s?t.jsxs("div",{className:`${I.post_is_hidden} flex-row-center-center-medium`,children:[t.jsx(d,{}),t.jsx("p",{children:"Hidden"})]}):null,t.jsx("div",{style:{padding:"1rem"},children:e})]})}const M={post_tags:"hc"};function F({tags:e}){return t.jsx("div",{className:`${M.post_tags} flex-row-normal-normal-medium`,children:e.map((e=>e.trim()?t.jsx(o,{to:`/search?tag=${e}`,children:e},e):null))})}function K({post:s,type:a}){const{id:r}=m(),{pathname:i}=n(),l=E(),d=h(),_=v(),x=e(),{mutate:w}=f({deps:[]}),y=i.search("/post")>-1,b="/"===i,C=s.likedBy.includes(l.user?._id||""),k=_.role(["Creator"]).equal("_id",s?.author?._id).permited(),A=_.role(["Admin"]).permited(),P=s.isHidden,S="preview"===a||"post"===a?s._id:r,T="comment"===a?parseInt(d.get("page")||"0"):0,L=P&&A||k&&P?U.post_hidden:"";P&&y&&!A&&!k&&"post"===a&&x("/");const O=e=>{d.set({type:e,"post-id":s._id,"list-page":0})},H=N.getDifference(s.createdAt).getSortDate({year:"[year] year [month] months ago!",month:"[month] month [day] days ago!",day:"[day] day [hour] hours ago!",hour:"[hour] hour [minute] minutes ago!",minute:"days [minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsx(t.Fragment,{children:b&&!k&&!A&&P?null:t.jsxs(q,{className:L,children:["comment"===a||"preview"===a?t.jsx(D,{tags:s.tags||[],title:s.title||"",content:s.content,isHidden:s.isHidden,postID:S,contentID:s._id,type:a,createdAt:s.createdAt,user:s?.author}):null,"post"===a?t.jsxs("div",{className:U.post_content_container,children:[t.jsx("h4",{children:s.title}),t.jsx("p",{className:U.post_content_date,children:H}),t.jsx($,{content:s.content})]}):null,"preview"===a?t.jsxs("div",{className:U.post_content_container,children:[t.jsx(o,{to:`/post/${s._id}`,children:s.title}),t.jsx($,{className:U.post_short_view,content:s.content.slice(0,450)})]}):null,"comment"===a?t.jsx("div",{className:U.post_data,children:t.jsx($,{content:s.content})}):null,t.jsxs("div",{className:"flex-row-center-space-between-none",children:["post"!==a&&"preview"!==a||!s.tags?null:t.jsx(F,{tags:s.tags}),t.jsxs("div",{className:"flex-row-center-normal-big",children:["preview"===a?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:`${U.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>O("views"):void 0,children:[t.jsx(c,{}),s.viewedBy?.length]}),t.jsxs("p",{className:`${U.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>O("comments"):void 0,children:[t.jsx(p,{}),s.comments?.length]}),t.jsxs("p",{className:`${U.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>O("likes"):void 0,children:[t.jsx(u,{}),s.likedBy?.length]})]}):null,"comment"!==a&&"post"!==a||!l.user?null:t.jsxs("button",{onClick:async()=>{if(s.isHidden&&!l.user)return;const e="post"===a?[`post-${s._id}`]:[`post-${S}-comments-${T}`];w({key:e,request:async e=>{const t=await j.get(`/${a}/${s._id}/like`,{Authorization:`Bearer ${g.getOne("PR_TOKEN")}`});if("post"===a)return t;const n=e.state,o=n.comments||[];return{...n,comments:o.map((e=>e._id===t._id?t:e))}}})},className:`${C?U.post_liked:""} ${U.post_statistic_data} flex-row-center-normal-small`,children:[t.jsx(u,{}),s.likedBy.length]})]})]})]})})}const G={button:"Y_",button_label:"Z_"};function Y({label:e,className:s,onClick:a,type:n,isDisable:o}){return t.jsx("button",{type:n||"button",style:{width:13*e.length+"px"},disabled:o,className:`${G.button} ${s}`,onClick:a,children:t.jsx("section",{className:G.button_label,children:e})})}const J={preview_container:"wa",preview_body:"xa",preview_header:"ya",preview_item_count:"za"},V={pagintion_list_button:"sc",loader:"tc"};function W(){return t.jsxs("div",{className:"flex-row-normal-space-between-medium",children:[t.jsx("div",{className:V.pagintion_list_button}),t.jsxs("div",{className:"flex-row-normal-normal-small",children:[t.jsx("div",{className:V.pagintion_list_button}),t.jsx("div",{className:V.pagintion_list_button}),t.jsx("div",{className:V.pagintion_list_button})]}),t.jsx("div",{className:V.pagintion_list_button})]})}const X={preview_loader:"uc",loader:"vc"};function Z(){return t.jsxs("div",{style:{paddingTop:"1rem"},className:"flex-column-normal-normal-medium",children:[t.jsx("div",{className:X.preview_loader}),t.jsx("div",{className:X.preview_loader}),t.jsx("div",{className:X.preview_loader}),t.jsx("div",{className:X.preview_loader}),t.jsx("div",{className:X.preview_loader}),t.jsx("div",{className:X.preview_loader})]})}function Q({type:e}){const s=h(),a=s.get("post-id"),n=parseInt(s.get("list-page")||"0"),r={views:t.jsx(c,{}),likes:t.jsx(u,{}),comments:t.jsx(p,{})},{data:i,prev:l,isPending:d}=f({deps:[`preview-${e}-${a}-${n}`],prev:[`preview-${e}-${a}-${n-1<0?0:n-1}`],request:async()=>j.get(`/post/preview/${e}/${a}/${n}`)}),m=l?.pagesCount||i?.pagesCount||0;return t.jsx("section",{className:J.preview_container,children:t.jsxs("div",{className:`${J.preview_body} main-content-container`,children:[t.jsxs("div",{className:`${J.preview_header} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[r[e],t.jsx("h4",{className:J.preview_type,children:y(e||"")})]}),t.jsx(_,{onClick:()=>{s.remove(["type","post-id","list-page"])}})]}),d?t.jsx(W,{}):m>1?t.jsx(b,{pagesCount:m}):null,d?t.jsx(Z,{}):t.jsx("div",{style:{paddingTop:m>1?"0.5rem":"0rem"},className:J.preview_item_count_list,children:0===i?.items?.length?t.jsx(C,{label:"Nothing found!"}):i?.items?.map((e=>t.jsxs(o,{to:`/user/${e._id}`,className:"flex-row-center-space-between-none",children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(S,{src:e.avatar,alt:e.name}),t.jsx("p",{children:e.name})]}),t.jsx("p",{className:J.preview_item_count,children:e.count})]},200*Math.random())))})]})})}const ee=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const e=h(),a=parseInt(e.get("posts-count")||String(10)),n=e.get("type"),o=window.matchMedia("(width <= 830px)").matches,{isFetching:r,isMutating:i,data:l,error:c,mutate:d}=f({deps:["all-posts"],request:async()=>await j.get(`/home/${a}`,{Authorization:`Bearer ${g.getOne("PR_TOKEN")}`})});return t.jsxs(s.Fragment,{children:[i?t.jsx(k,{}):null,t.jsxs("div",{style:{height:"100%",marginRight:o?"0rem":n?"17rem":"0rem"},className:"flex-row-normal-normal-medium",children:[t.jsx("div",{style:{flexGrow:1},className:"flex-column-normal-normal-small",children:r?t.jsx(H,{}):c?t.jsx(z,{underText:"Go back or reload the page!",code:c.code,message:c.message}):l&&0===l.length?t.jsx(C,{option:{flexCenterCenter:!0},label:"No post would founded!"}):l&&t.jsxs(s.Fragment,{children:[l.map((e=>t.jsx(K,{post:e,type:"preview"},e._id))),l.length%10==0?t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx(Y,{onClick:async()=>{const s=a+10;e.set({"posts-count":s}),await d({key:["all-posts"],request:async()=>await j.get(`/home/${s}`)}),r||i||setTimeout((()=>window.scrollTo({behavior:"smooth",top:document.body.scrollHeight})),100)},label:"Load More"})}):null]})}),n&&t.jsx(Q,{type:n})]})]})}},Symbol.toStringTag,{value:"Module"}));export{Y as B,z as E,S as I,H as L,L as P,K as a,E as b,ee as p,O as u};
