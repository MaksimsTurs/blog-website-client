import{r as e,j as s,e as t,o as a,a as n,L as r,p as o,k as i,P as l,E as c,q as d,i as m,s as u,t as p,X as _}from"../react.js";import{f as x,c as h,u as v,_ as g,D as j,a as f,C as N,P as w,E as $,M as y}from"./admin.js";const b={get:(e,s)=>JSON.parse(localStorage.getItem(e)||s),set:(e,s)=>{localStorage.setItem(e,JSON.stringify(s))},remove:e=>{localStorage.removeItem(e)}},C=e.createContext(void 0);function S({children:t}){const[a,n]=e.useState({isAuthPending:!1,isLoading:!1});return e.useEffect((()=>{!async function(){try{if(!a.user){n({isAuthPending:!0,isLoading:!1});const e=await x.get("/authenticate",{Authorization:`Bearer ${h.getOne("PR_TOKEN")}`}),s=Object.hasOwn(e,"token");n({isAuthPending:!1,isLoading:!1,error:void 0,user:s?e:void 0})}}catch(e){n({isAuthPending:!1,isLoading:!1,error:void 0,user:void 0})}}()}),[]),s.jsx(C.Provider,{value:{updateUserState:n,userState:a},children:t})}function k(){const s=t(),a=e.useContext(C),n=v(),r=n.get("login-modal"),o=n.get("registration-modal");return{...a?.userState,create:async function(e){try{if(e.setSession)return a?.updateUserState({user:e.setSession,isAuthPending:!1,isLoading:!1});a?.updateUserState({isAuthPending:!1,isLoading:!0});const t=await x.post(e.apiURL,e.body);a?.updateUserState({isAuthPending:!1,isLoading:!1,error:void 0,user:t}),e?.setToken&&h.set("PR_TOKEN",t.token),e?.redirectURL&&s(e.redirectURL)}catch(t){a.updateUserState((e=>({...e,isAuthPending:!1,isLoading:!1,error:t instanceof Error?{code:503,message:"Service Unavailable!"}:JSON.parse(t)})))}},out:function(){a?.updateUserState({isAuthPending:!1,isLoading:!1})},clearError:function(){e.useEffect((()=>{a?.updateUserState((e=>({...e,error:void 0})))}),[r,o])}}}const A={default_image:"U",default_image_loader:"V",loader:"W"};function E({className:e,style:t}){return s.jsx("div",{style:t,className:`${A.default_image_loader} ${e}`})}function P({alt:t,classNames:n,src:r,styles:o}){const[i,l]=e.useState(!1),c=e.useRef("default"),d=e.useRef(null),m=(c.current?.search(/\http(s)/)||-1)>-1;return e.useEffect((()=>{d.current&&(d.current.addEventListener("loadstart",(()=>{l(!1)})),d.current.addEventListener("load",(e=>{const s=e.target;c.current=r,l(s.complete)}),{once:!0}),d.current.addEventListener("error",(()=>{c.current=void 0,l(!1)}),{once:!0}))}),[d.current]),s.jsxs(e.Fragment,{children:[m||i?!i&&m&&s.jsx(E,{className:n?.loader,style:o?.loader}):s.jsx(a,{className:`${n?.img} ${A.default_image}`,size:40}),s.jsx("img",{ref:d,src:r,alt:t,className:n?.img,style:{...o?.img,display:(m?c.current:i)?"block":"none"}})]})}function I(){const s=e.useContext(C);let t=[];return{isHaveRole:function(e){return e.includes(s?.userState.user?.role||"User")||t.push(1),this},isIDEqual:function(e){return s?.userState.user?._id===e||t.push(1),this},isHaveRoleAndIsIDEqual:function(e,a){return s?.userState.user?._id===a&&e.includes(s?.userState.user?.role||"User")||t.push(1),this},isHaveRoleOrIsIDEqual:function(e,a){return s?.userState.user?._id===a||e.includes(s?.userState.user?.role||"User")||t.push(1),this},result:function(){const e=t.length<=0;return t=[],e}}}const R={post_loader_container:"s_",post_loader_text:"t_",loader:"u_",post_loader_tag:"v_",post_loader_avatar:"w_"};function O(){return s.jsxs("div",{className:`${R.post_loader_container} main-content-container flex-column-normal-normal-medium`,children:[s.jsxs("div",{className:"flex-row-normal-normal-medium",children:[s.jsx("div",{className:R.post_loader_avatar}),s.jsxs("div",{className:"flex-column-normal-normal-medium",children:[s.jsx("div",{style:{width:"4rem"},className:R.post_loader_text}),s.jsx("div",{style:{width:"7rem"},className:R.post_loader_text})]})]}),s.jsx("div",{style:{width:"11rem"},className:R.post_loader_text}),s.jsxs("div",{className:"flex-column-normal-normal-medium",children:[s.jsx("div",{style:{width:"50%"},className:R.post_loader_text}),s.jsx("div",{style:{width:"20%"},className:R.post_loader_text})]}),s.jsxs("div",{className:"flex-row-normal-space-between-none",children:[s.jsxs("div",{className:"flex-row-normal-normal-medium",children:[s.jsx("div",{className:R.post_loader_tag}),s.jsx("div",{className:R.post_loader_tag}),s.jsx("div",{className:R.post_loader_tag})]}),s.jsxs("div",{className:"flex-row-normal-normal-medium",children:[s.jsx("div",{className:R.post_loader_tag}),s.jsx("div",{className:R.post_loader_tag}),s.jsx("div",{className:R.post_loader_tag})]})]})]})}function H({containersCount:e}){return s.jsx("div",{className:"flex-column-normal-normal-small",children:[...Array(e||3)].map(((e,t)=>s.jsx(O,{},t)))})}const L={error_container:"a",error_body:"b",error_error:"c"};function U({code:e,message:t,underText:a}){return s.jsx("div",{className:`${L.error_container} flex-row-center-center-none`,children:s.jsxs("div",{className:L.error_body,children:[s.jsxs("div",{className:`${L.error_error} flex-column-normal-normal-none`,children:[s.jsxs("p",{children:["Error - ",e,"!"]}),s.jsx("p",{children:t})]}),a?s.jsx("p",{children:a}):null]})})}const T={post_content_container:"V_",post_short_view:"W_",post_content_date:"X_",post_data:"Y_",post_hidden:"Z_",post_statistic_data:"_a",post_liked:"-a",like:"aa"},D={post_header:"kc",post_header_author_not_defined:"lc",post_action_button:"mc",post_action_container:"nc",post_create_date:"oc"};function q({user:e,createdAt:a,type:m,contentID:u,postID:p,content:_,tags:N,title:w,isHidden:$}){const y=I(),{mutate:C,changeError:S}=g({deps:[]}),k=v(),A=t(),{pathname:E}=n(),R=y.isHaveRoleOrIsIDEqual(["Admin","Creator"],e?._id)?.result(),O=E.search("/post/")>-1,H=E.search("/")>-1,L=E.search("/search")>-1,U="preview"===m?"post":m,T=parseInt(k.get("page")||"0"),q=e=>{const s=O&&"comment"===m?[`post-${p}-comments-${k.get("page")||0}`]:H?["all-posts"]:[];if(!y.isHaveRole(["Creator","Admin"]).result())return S(s,{code:403,message:"You have no edit and remove permission!"});if("edit"===e){if(y.isHaveRole(["Creator"]).result())return b.set(u,{content:_,tags:N,title:w,contentType:U,onPage:T,onPost:p}),A(`/write-post?is-edit=true&content-id=${u}`);if(y.isHaveRole(["Admin"]).result())return A(`/admin/${U}?id=${u}&${U}-edit-modal=true`)}C({key:s,request:async s=>{if("remove"===e){const e=await x.get(`/admin/remove/${f(U)}/${u}`,{Authorization:`Bearer ${h.getOne("PR_TOKEN")}`});if(O&&"comment"===m){const t=s.state||{comments:[],pagesCount:0};if(1===t.comments.length&&t.pagesCount>=1){for(let e=t.pagesCount-1;e>=0;e--)e!==T&&s.removeCache(`post-${p}-comments-${e}`);return A(`/post/${p}?page=${+T-1}`),{pagesCount:0,comments:[]}}return{...t,comments:t.comments.filter((s=>s._id!==e._id))}}if(H){return(s.state||[]).filter((s=>s._id!==e._id))}}const t=await x.post(`/admin/${U}/update`,{id:u,isHidden:"hidde"===e},{Authorization:`Bearer ${h.getOne("PR_TOKEN")}`});if(O){const e=s.state||{pagesCount:0,comments:[]};return{...e,comments:e.comments.map((e=>e._id===t._id?{...e,...t}:e))}}return(s.state||[]).map((e=>e._id===t._id?t:e))}})};return s.jsxs("div",{className:`${D.post_header} flex-row-center-space-between-none`,children:[e?s.jsxs("div",{className:"flex-row-normal-normal-medium",children:[s.jsx(P,{src:e?.avatar,alt:e?.name||"User avatar"}),s.jsxs("div",{className:D.post_author,children:[s.jsx(r,{to:`/user/${e?._id}`,children:e?.name}),s.jsx("p",{className:D.post_create_date,children:j.getDifference(a)})]})]}):s.jsxs("div",{className:`${D.post_header_author_not_defined} flex-row-center-normal-medium`,children:[s.jsx(o,{}),s.jsx("p",{children:"Author is possibly deleted!"})]}),R&&!L?s.jsxs("button",{className:D.post_action_button,children:[s.jsx("svg",{viewBox:"0 0 128 512",children:s.jsx("path",{d:"M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"})}),s.jsxs("ul",{className:`${D.post_action_container} flex-column-normal-normal-none`,children:[s.jsxs("li",{onClick:()=>q("remove"),className:"flex-row-center-normal-medium",children:[s.jsx(i,{}),s.jsx("p",{children:"Remove"})]}),s.jsxs("li",{onClick:()=>q("edit"),className:"flex-row-center-normal-medium",children:[s.jsx(l,{}),s.jsx("p",{children:"Edit"})]}),s.jsxs("li",{onClick:()=>q($?"show":"hidde"),className:"flex-row-center-normal-medium",children:[$?s.jsx(c,{}):s.jsx(d,{}),s.jsx("p",{children:$?"Show":"Hidden"})]})]})]}):null]})}const B={post_wrapper_container:"Pa",post_is_hidden:"Qa"};function z({children:e,className:t}){return s.jsxs("section",{className:`${B.post_wrapper_container} ${t} main-content-container`,children:[t?s.jsxs("div",{className:`${B.post_is_hidden} flex-row-center-center-medium`,children:[s.jsx(d,{}),s.jsx("p",{children:"Hidden"})]}):null,s.jsx("div",{style:{padding:"1rem"},children:e})]})}const M={post_tags:"Wa"};function F({tags:e}){return s.jsx("div",{className:`${M.post_tags} flex-row-normal-normal-medium`,children:e.map((e=>e.trim()?s.jsx(r,{to:`/search?tag=${e}`,children:e},e):null))})}function K({post:e,type:a}){const{id:o}=m(),{pathname:i}=n(),l=k(),d=v(),_=I(),f=t(),{mutate:w}=g({deps:[]}),$=i.search("/post")>-1,y="/"===i,b=e.likedBy.includes(l.user?._id||""),C=_.isHaveRoleAndIsIDEqual(["Creator"],e?.author?._id).result(),S=_.isHaveRole(["Admin"]).result(),A=e.isHidden,E="preview"===a||"post"===a?e._id:o,P="comment"===a?parseInt(d.get("page")||"0"):0,R=A&&S||C&&A?T.post_hidden:"";A&&$&&!S&&!C&&"post"===a&&f("/");const O=s=>{d.set({type:s,"post-id":e._id,"list-page":0})};return s.jsx(s.Fragment,{children:y&&!C&&!S&&A?null:s.jsxs(z,{className:R,children:["comment"===a||"preview"===a?s.jsx(q,{tags:e.tags||[],title:e.title||"",content:e.content,isHidden:e.isHidden,postID:E,contentID:e._id,type:a,createdAt:e.createdAt,user:e?.author}):null,"post"===a?s.jsxs("div",{className:T.post_content_container,children:[s.jsx("h4",{children:e.title}),s.jsx("p",{className:T.post_content_date,children:j.getDifference(e.createdAt)}),s.jsx(N,{className:T.post_short_view,content:e.content})]}):null,"preview"===a?s.jsxs("div",{className:T.post_content_container,children:[s.jsx(r,{to:`/post/${e._id}`,children:e.title}),s.jsx(N,{className:T.post_short_view,content:e.content})]}):null,"comment"===a?s.jsx("div",{className:T.post_data,children:s.jsx(N,{content:e.content})}):null,s.jsxs("div",{className:"flex-row-center-space-between-none",children:["post"!==a&&"preview"!==a||!e.tags?null:s.jsx(F,{tags:e.tags}),s.jsxs("div",{className:"flex-row-center-normal-big",children:["preview"===a?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:`${T.post_statistic_data} flex-row-center-normal-small`,onClick:y?()=>O("views"):void 0,children:[s.jsx(c,{}),e.viewedBy?.length]}),s.jsxs("p",{className:`${T.post_statistic_data} flex-row-center-normal-small`,onClick:y?()=>O("comments"):void 0,children:[s.jsx(u,{}),e.comments?.length]}),s.jsxs("p",{className:`${T.post_statistic_data} flex-row-center-normal-small`,onClick:y?()=>O("likes"):void 0,children:[s.jsx(p,{}),e.likedBy?.length]})]}):null,"comment"!==a&&"post"!==a||!l.user?null:s.jsxs("button",{onClick:async()=>{if(e.isHidden&&!l.user)return;const s="post"===a?[`post-${e._id}`]:[`post-${E}-comments-${P}`];w({key:s,request:async s=>{const t=await x.get(`/${a}/${e._id}/like`,{Authorization:`Bearer ${h.getOne("PR_TOKEN")}`});if("post"===a)return t;const n=s.state,r=n.comments||[];return{...n,comments:r.map((e=>e._id===t._id?t:e))}}})},className:`${b?T.post_liked:""} ${T.post_statistic_data} flex-row-center-normal-small`,children:[s.jsx(p,{}),e.likedBy.length]})]})]})]})})}const J={button:"pa",button_label:"qa"};function W({label:e,className:t,onClick:a,type:n,isDisable:r}){return s.jsx("button",{type:n||"button",style:{width:13*e.length+"px"},disabled:r,className:`${J.button} ${t}`,onClick:a,children:s.jsx("section",{className:J.button_label,children:e})})}const G={preview_container:"ma",preview_header:"na",preview_item_count:"oa"},V={pagintion_list_button:"Hc",loader:"Ic"};function Y(){return s.jsxs("div",{className:"flex-row-normal-space-between-medium",children:[s.jsx("div",{className:V.pagintion_list_button}),s.jsxs("div",{className:"flex-row-normal-normal-small",children:[s.jsx("div",{className:V.pagintion_list_button}),s.jsx("div",{className:V.pagintion_list_button}),s.jsx("div",{className:V.pagintion_list_button})]}),s.jsx("div",{className:V.pagintion_list_button})]})}const Q={preview_loader:"uc",loader:"vc"};function X(){return s.jsxs("div",{style:{paddingTop:"1rem"},className:"flex-column-normal-normal-medium",children:[s.jsx("div",{className:Q.preview_loader}),s.jsx("div",{className:Q.preview_loader}),s.jsx("div",{className:Q.preview_loader}),s.jsx("div",{className:Q.preview_loader}),s.jsx("div",{className:Q.preview_loader}),s.jsx("div",{className:Q.preview_loader})]})}function Z({type:e}){const t=v(),a=t.get("post-id"),n=parseInt(t.get("list-page")||"0"),{data:o,prev:i,isPending:l}=g({deps:[`preview-${e}-${a}-${n}`],prev:[`preview-${e}-${a}-${n-1<0?0:n-1}`],request:async()=>x.get(`/post/preview/${e}/${a}/${n}`)}),c=i?.pagesCount||o?.pagesCount||0;return s.jsxs("section",{className:`${G.preview_container} main-content-container`,children:[s.jsxs("div",{className:`${G.preview_header} flex-row-center-space-between-none`,children:[s.jsx("h4",{className:G.preview_type,children:f(e||"")}),s.jsx(_,{onClick:()=>{t.remove(["type","post-id","list-page"])}})]}),l?s.jsx(Y,{}):c>1?s.jsx(w,{pagesCount:c}):null,l?s.jsx(X,{}):s.jsx("div",{style:{paddingTop:c>1?"0.5rem":"0rem"},className:G.preview_item_count_list,children:0===o?.items?.length?s.jsx($,{label:"Nothing found!"}):o?.items?.map((e=>s.jsxs(r,{to:`/user/${e._id}`,className:"flex-row-center-space-between-none",children:[s.jsxs("div",{className:"flex-row-center-normal-medium",children:[s.jsx(P,{src:e.avatar,alt:e.name}),s.jsx("p",{children:e.name})]}),s.jsx("p",{className:G.preview_item_count,children:e.count})]},200*Math.random())))})]})}const ee=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const t=v(),{isFetching:a,isMutating:n,data:r,error:o,mutate:i}=g({deps:["all-posts"],request:async()=>await x.get(`/home/${l}`,{Authorization:`Bearer ${h.getOne("PR_TOKEN")}`})}),l=parseInt(t.get("posts-count")||String(10)),c=t.get("type");return s.jsxs(e.Fragment,{children:[n?s.jsx(y,{}):null,s.jsxs("div",{style:{height:"100%",marginRight:c?"17rem":"0rem"},className:"flex-row-normal-normal-medium",children:[s.jsx("div",{style:{flexGrow:1},className:"flex-column-normal-normal-small",children:a?s.jsx(H,{}):o?s.jsx(U,{underText:"Go back or reload the page!",code:o.code,message:o.message}):r&&0===r.length?s.jsx($,{option:{flexCenterCenter:!0},label:"No post would founded!"}):r&&s.jsxs(e.Fragment,{children:[r.map((e=>s.jsx(K,{post:e,type:"preview"},e._id))),r.length%10==0?s.jsx("div",{className:"flex-row-center-center-none",children:s.jsx(W,{onClick:async()=>{t.set({"posts-count":l+10}),await i({key:["all-posts"],request:async()=>await x.get(`/home/${l+10}`)}),a||n||setTimeout((()=>window.scrollTo({behavior:"smooth",top:document.body.scrollHeight})),100)},label:"Load More"})}):null]})}),c?s.jsx(Z,{type:c}):null]})]})}},Symbol.toStringTag,{value:"Module"}));export{S as A,W as B,U as E,P as I,H as L,O as P,K as a,I as b,b as l,ee as p,k as u};
