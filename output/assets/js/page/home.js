import{r as e,j as s,e as t,o as a,a as n,L as r,p as o,k as i,P as l,E as c,q as d,i as m,s as u,t as p,X as _}from"../react.js";import{f as x,c as h,u as j,_ as g,D as v,a as f,C as N,P as w,E as $,M as y}from"./admin.js";const b={get:(e,s)=>JSON.parse(localStorage.getItem(e)||s),set:(e,s)=>{localStorage.setItem(e,JSON.stringify(s))},remove:e=>{localStorage.removeItem(e)}},C=e.createContext(void 0);function S({children:t}){const[a,n]=e.useState({isAuthPending:!1,isLoading:!1});return e.useEffect((()=>{!async function(){try{if(!a.user){n({isAuthPending:!0,isLoading:!1});const e=await x.get("/authenticate",{Authorization:`Bearer ${h.getOne("PR_TOKEN")}`}),s=Object.hasOwn(e,"token");n({isAuthPending:!1,isLoading:!1,error:void 0,user:s?e:void 0})}}catch(e){n({isAuthPending:!1,isLoading:!1,error:void 0,user:void 0})}}()}),[]),s.jsx(C.Provider,{value:{updateUserState:n,userState:a},children:t})}function k(){const s=t(),a=e.useContext(C),n=j(),r=n.get("login-modal"),o=n.get("registration-modal");return{...a?.userState,create:async function(e){try{if(e.setSession)return a?.updateUserState({user:e.setSession,isAuthPending:!1,isLoading:!1});a?.updateUserState({isAuthPending:!1,isLoading:!0});const t=await x.post(e.apiURL,e.body);a?.updateUserState({isAuthPending:!1,isLoading:!1,error:void 0,user:t}),e?.setToken&&h.set("PR_TOKEN",t.token),e?.redirectURL&&s(e.redirectURL)}catch(t){a.updateUserState((e=>({...e,isAuthPending:!1,isLoading:!1,error:t instanceof Error?{code:503,message:"Service Unavailable!"}:JSON.parse(t)})))}},out:function(){a?.updateUserState({isAuthPending:!1,isLoading:!1})},clearError:function(){e.useEffect((()=>{a?.updateUserState((e=>({...e,error:void 0})))}),[r,o])}}}const A={default_image:"Ha",default_image_loader:"Ia",loader:"Ja"};function E({className:e,style:t}){return s.jsx("div",{style:t,className:`${A.default_image_loader} ${e}`})}function I({alt:t,classNames:n,src:r,styles:o}){const[i,l]=e.useState(!1),c=e.useRef("default"),d=e.useRef(null),m=(c.current?.search(/\http(s)/)||-1)>-1;return e.useEffect((()=>{d.current&&(d.current.addEventListener("loadstart",(()=>{l(!1)})),d.current.addEventListener("load",(e=>{const s=e.target;c.current=r,l(s.complete)}),{once:!0}),d.current.addEventListener("error",(()=>{c.current=void 0,l(!1)}),{once:!0}))}),[d.current]),s.jsxs(e.Fragment,{children:[m||i?!i&&m&&s.jsx(E,{className:n?.loader,style:o?.loader}):s.jsx(a,{className:`${n?.img} ${A.default_image}`,size:40}),s.jsx("img",{ref:d,src:r,alt:t,className:n?.img,style:{...o?.img,display:(m?c.current:i)?"block":"none"}})]})}function P(){const s=e.useContext(C);let t=[];return{isHaveRole:function(e){return e.includes(s?.userState.user?.role||"User")||t.push(1),this},isIDEqual:function(e){return s?.userState.user?._id===e||t.push(1),this},isHaveRoleAndIsIDEqual:function(e,a){return s?.userState.user?._id===a&&e.includes(s?.userState.user?.role||"User")||t.push(1),this},isHaveRoleOrIsIDEqual:function(e,a){return s?.userState.user?._id===a||e.includes(s?.userState.user?.role||"User")||t.push(1),this},result:function(){const e=t.length<=0;return t=[],e}}}const R={post_loader_container:"H_",post_loader_text:"I_",loader:"J_",post_loader_tag:"K_",post_loader_avatar:"L_"};function H(){return s.jsxs("div",{className:`${R.post_loader_container} main-content-container flex-column-normal-normal-medium`,children:[s.jsxs("div",{className:"flex-row-normal-normal-medium",children:[s.jsx("div",{className:R.post_loader_avatar}),s.jsxs("div",{className:"flex-column-normal-normal-medium",children:[s.jsx("div",{style:{width:"4rem"},className:R.post_loader_text}),s.jsx("div",{style:{width:"7rem"},className:R.post_loader_text})]})]}),s.jsx("div",{style:{width:"11rem"},className:R.post_loader_text}),s.jsxs("div",{className:"flex-column-normal-normal-medium",children:[s.jsx("div",{style:{width:"50%"},className:R.post_loader_text}),s.jsx("div",{style:{width:"20%"},className:R.post_loader_text})]}),s.jsxs("div",{className:"flex-row-normal-space-between-none",children:[s.jsxs("div",{className:"flex-row-normal-normal-medium",children:[s.jsx("div",{className:R.post_loader_tag}),s.jsx("div",{className:R.post_loader_tag}),s.jsx("div",{className:R.post_loader_tag})]}),s.jsxs("div",{className:"flex-row-normal-normal-medium",children:[s.jsx("div",{className:R.post_loader_tag}),s.jsx("div",{className:R.post_loader_tag}),s.jsx("div",{className:R.post_loader_tag})]})]})]})}function O(s){e.useEffect((()=>{s.title&&(document.title=s.title)}),[s]),e.useEffect((()=>{delete s.title;const e=Object.entries(s);for(let[s,t]of e){const e=document.createElement("meta");e.name=s,e.content=t,document.head.appendChild(e)}}),[])}function L({containersCount:e}){return O({title:"Home",description:"Hier kannst du alle letzt geschriebene posts ansehen."}),s.jsx("div",{className:"flex-column-normal-normal-small",children:[...Array(e||3)].map(((e,t)=>s.jsx(H,{},t)))})}const T={error_container:"w",error_body:"x",error_error:"y"};function U({code:e,message:t,underText:a}){return s.jsx("div",{className:`${T.error_container} flex-row-center-center-none`,children:s.jsxs("div",{className:T.error_body,children:[s.jsxs("div",{className:`${T.error_error} flex-column-normal-normal-none`,children:[s.jsxs("p",{children:["Error - ",e,"!"]}),s.jsx("p",{children:t})]}),a?s.jsx("p",{children:a}):null]})})}const D={post_content_container:"R_",post_short_view:"S_",post_content_date:"T_",post_data:"U_",post_hidden:"V_",post_statistic_data:"W_",post_liked:"X_",like:"Y_"},z={post_header:"Za",post_header_author_not_defined:"_c",post_action_button:"-c",post_action_container:"ac",post_create_date:"bc"};function q({user:e,createdAt:a,type:m,contentID:u,postID:p,content:_,tags:N,title:w,isHidden:$}){const y=P(),{mutate:C,changeError:S}=g({deps:[]}),k=j(),A=t(),{pathname:E}=n(),R=y.isHaveRoleOrIsIDEqual(["Admin","Creator"],e?._id)?.result(),H=E.search("/post/")>-1,O=E.search("/")>-1,L=E.search("/search")>-1,T="preview"===m?"post":m,U=parseInt(k.get("page")||"0"),D=e=>{const s=H&&"comment"===m?[`post-${p}-comments-${k.get("page")||0}`]:O?["all-posts"]:[];if(!y.isHaveRole(["Creator","Admin"]).result())return S(s,{code:403,message:"You have no edit and remove permission!"});if("edit"===e){if(y.isHaveRole(["Creator"]).result())return b.set(u,{content:_,tags:N,title:w,contentType:T,onPage:U,onPost:p}),A(`/write-post?is-edit=true&content-id=${u}`);if(y.isHaveRole(["Admin"]).result())return A(`/admin/${T}?id=${u}&${T}-edit-modal=true`)}C({key:s,request:async s=>{if("remove"===e){const e=await x.get(`/admin/remove/${f(T)}/${u}`,{Authorization:`Bearer ${h.getOne("PR_TOKEN")}`});if(H&&"comment"===m){const t=s.state||{comments:[],pagesCount:0};if(1===t.comments.length&&t.pagesCount>=1){for(let e=t.pagesCount-1;e>=0;e--)e!==U&&s.removeCache(`post-${p}-comments-${e}`);return A(`/post/${p}?page=${+U-1}`),{pagesCount:0,comments:[]}}return{...t,comments:t.comments.filter((s=>s._id!==e._id))}}if(O){return(s.state||[]).filter((s=>s._id!==e._id))}}const t=await x.post(`/admin/${T}/update`,{id:u,isHidden:"hidde"===e},{Authorization:`Bearer ${h.getOne("PR_TOKEN")}`});if(H){const e=s.state||{pagesCount:0,comments:[]};return{...e,comments:e.comments.map((e=>e._id===t._id?{...e,...t}:e))}}return(s.state||[]).map((e=>e._id===t._id?t:e))}})};return s.jsxs("div",{className:`${z.post_header} flex-row-center-space-between-none`,children:[e?s.jsxs("div",{className:"flex-row-normal-normal-medium",children:[s.jsx(I,{src:e?.avatar,alt:e?.name||"User avatar"}),s.jsxs("div",{className:z.post_author,children:[s.jsx(r,{to:`/user/${e?._id}`,children:e?.name}),s.jsx("p",{className:z.post_create_date,children:v.getDifference(a)})]})]}):s.jsxs("div",{className:`${z.post_header_author_not_defined} flex-row-center-normal-medium`,children:[s.jsx(o,{}),s.jsx("p",{children:"Author is possibly deleted!"})]}),R&&!L?s.jsxs("button",{className:z.post_action_button,children:[s.jsx("svg",{viewBox:"0 0 128 512",children:s.jsx("path",{d:"M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"})}),s.jsxs("ul",{className:`${z.post_action_container} flex-column-normal-normal-none`,children:[s.jsxs("li",{onClick:()=>D("remove"),className:"flex-row-center-normal-medium",children:[s.jsx(i,{}),s.jsx("p",{children:"Remove"})]}),s.jsxs("li",{onClick:()=>D("edit"),className:"flex-row-center-normal-medium",children:[s.jsx(l,{}),s.jsx("p",{children:"Edit"})]}),s.jsxs("li",{onClick:()=>D($?"show":"hidde"),className:"flex-row-center-normal-medium",children:[$?s.jsx(c,{}):s.jsx(d,{}),s.jsx("p",{children:$?"Show":"Hidden"})]})]})]}):null]})}const B={post_wrapper_container:"Ma",post_is_hidden:"Na"};function M({children:e,className:t}){return s.jsxs("section",{className:`${B.post_wrapper_container} ${t} main-content-container`,children:[t?s.jsxs("div",{className:`${B.post_is_hidden} flex-row-center-center-medium`,children:[s.jsx(d,{}),s.jsx("p",{children:"Hidden"})]}):null,s.jsx("div",{style:{padding:"1rem"},children:e})]})}const K={post_tags:"Ya"};function F({tags:e}){return s.jsx("div",{className:`${K.post_tags} flex-row-normal-normal-medium`,children:e.map((e=>e.trim()?s.jsx(r,{to:`/search?tag=${e}`,children:e},e):null))})}function J({post:e,type:a}){const{id:o}=m(),{pathname:i}=n(),l=k(),d=j(),_=P(),f=t(),{mutate:w}=g({deps:[]}),$=i.search("/post")>-1,y="/"===i,b=e.likedBy.includes(l.user?._id||""),C=_.isHaveRoleAndIsIDEqual(["Creator"],e?.author?._id).result(),S=_.isHaveRole(["Admin"]).result(),A=e.isHidden,E="preview"===a||"post"===a?e._id:o,I="comment"===a?parseInt(d.get("page")||"0"):0,R=A&&S||C&&A?D.post_hidden:"";A&&$&&!S&&!C&&"post"===a&&f("/");const H=s=>{d.set({type:s,"post-id":e._id,"list-page":0})};return s.jsx(s.Fragment,{children:y&&!C&&!S&&A?null:s.jsxs(M,{className:R,children:["comment"===a||"preview"===a?s.jsx(q,{tags:e.tags||[],title:e.title||"",content:e.content,isHidden:e.isHidden,postID:E,contentID:e._id,type:a,createdAt:e.createdAt,user:e?.author}):null,"post"===a?s.jsxs("div",{className:D.post_content_container,children:[s.jsx("h4",{children:e.title}),s.jsx("p",{className:D.post_content_date,children:v.getDifference(e.createdAt)}),s.jsx(N,{className:D.post_short_view,content:e.content})]}):null,"preview"===a?s.jsxs("div",{className:D.post_content_container,children:[s.jsx(r,{to:`/post/${e._id}`,children:e.title}),s.jsx(N,{className:D.post_short_view,content:e.content})]}):null,"comment"===a?s.jsx("div",{className:D.post_data,children:s.jsx(N,{content:e.content})}):null,s.jsxs("div",{className:"flex-row-center-space-between-none",children:["post"!==a&&"preview"!==a||!e.tags?null:s.jsx(F,{tags:e.tags}),s.jsxs("div",{className:"flex-row-center-normal-big",children:["preview"===a?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:`${D.post_statistic_data} flex-row-center-normal-small`,onClick:y?()=>H("views"):void 0,children:[s.jsx(c,{}),e.viewedBy?.length]}),s.jsxs("p",{className:`${D.post_statistic_data} flex-row-center-normal-small`,onClick:y?()=>H("comments"):void 0,children:[s.jsx(u,{}),e.comments?.length]}),s.jsxs("p",{className:`${D.post_statistic_data} flex-row-center-normal-small`,onClick:y?()=>H("likes"):void 0,children:[s.jsx(p,{}),e.likedBy?.length]})]}):null,"comment"!==a&&"post"!==a||!l.user?null:s.jsxs("button",{onClick:async()=>{if(e.isHidden&&!l.user)return;const s="post"===a?[`post-${e._id}`]:[`post-${E}-comments-${I}`];w({key:s,request:async s=>{const t=await x.get(`/${a}/${e._id}/like`,{Authorization:`Bearer ${h.getOne("PR_TOKEN")}`});if("post"===a)return t;const n=s.state,r=n.comments||[];return{...n,comments:r.map((e=>e._id===t._id?t:e))}}})},className:`${b?D.post_liked:""} ${D.post_statistic_data} flex-row-center-normal-small`,children:[s.jsx(p,{}),e.likedBy.length]})]})]})]})})}const Y={button:"h_",button_label:"i_"};function G({label:e,className:t,onClick:a,type:n,isDisable:r}){return s.jsx("button",{type:n||"button",style:{width:13*e.length+"px"},disabled:r,className:`${Y.button} ${t}`,onClick:a,children:s.jsx("section",{className:Y.button_label,children:e})})}const V={preview_container:"xa",preview_header:"ya",preview_item_count:"za"},W={pagintion_list_button:"rc",loader:"sc"};function X(){return s.jsxs("div",{className:"flex-row-normal-space-between-medium",children:[s.jsx("div",{className:W.pagintion_list_button}),s.jsxs("div",{className:"flex-row-normal-normal-small",children:[s.jsx("div",{className:W.pagintion_list_button}),s.jsx("div",{className:W.pagintion_list_button}),s.jsx("div",{className:W.pagintion_list_button})]}),s.jsx("div",{className:W.pagintion_list_button})]})}const Z={preview_loader:"mc",loader:"nc"};function Q(){return s.jsxs("div",{style:{paddingTop:"1rem"},className:"flex-column-normal-normal-medium",children:[s.jsx("div",{className:Z.preview_loader}),s.jsx("div",{className:Z.preview_loader}),s.jsx("div",{className:Z.preview_loader}),s.jsx("div",{className:Z.preview_loader}),s.jsx("div",{className:Z.preview_loader}),s.jsx("div",{className:Z.preview_loader})]})}function ee({type:e}){const t=j(),a=t.get("post-id"),n=parseInt(t.get("list-page")||"0"),o={views:s.jsx(c,{}),likes:s.jsx(p,{}),comments:s.jsx(u,{})},{data:i,prev:l,isPending:d}=g({deps:[`preview-${e}-${a}-${n}`],prev:[`preview-${e}-${a}-${n-1<0?0:n-1}`],request:async()=>x.get(`/post/preview/${e}/${a}/${n}`)}),m=l?.pagesCount||i?.pagesCount||0;return s.jsxs("section",{className:`${V.preview_container} main-content-container`,children:[s.jsxs("div",{className:`${V.preview_header} flex-row-center-space-between-none`,children:[s.jsxs("div",{className:"flex-row-center-normal-medium",children:[o[e],s.jsx("h4",{className:V.preview_type,children:f(e||"")})]}),s.jsx(_,{onClick:()=>{t.remove(["type","post-id","list-page"])}})]}),d?s.jsx(X,{}):m>1?s.jsx(w,{pagesCount:m}):null,d?s.jsx(Q,{}):s.jsx("div",{style:{paddingTop:m>1?"0.5rem":"0rem"},className:V.preview_item_count_list,children:0===i?.items?.length?s.jsx($,{label:"Nothing found!"}):i?.items?.map((e=>s.jsxs(r,{to:`/user/${e._id}`,className:"flex-row-center-space-between-none",children:[s.jsxs("div",{className:"flex-row-center-normal-medium",children:[s.jsx(I,{src:e.avatar,alt:e.name}),s.jsx("p",{children:e.name})]}),s.jsx("p",{className:V.preview_item_count,children:e.count})]},200*Math.random())))})]})}const se=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const t=j(),{isFetching:a,isMutating:n,data:r,error:o,mutate:i}=g({deps:["all-posts"],request:async()=>await x.get(`/home/${l}`,{Authorization:`Bearer ${h.getOne("PR_TOKEN")}`})}),l=parseInt(t.get("posts-count")||String(10)),c=t.get("type");return s.jsxs(e.Fragment,{children:[n?s.jsx(y,{}):null,s.jsxs("div",{style:{height:"100%",marginRight:c?"17rem":"0rem"},className:"flex-row-normal-normal-medium",children:[s.jsx("div",{style:{flexGrow:1},className:"flex-column-normal-normal-small",children:a?s.jsx(L,{}):o?s.jsx(U,{underText:"Go back or reload the page!",code:o.code,message:o.message}):r&&0===r.length?s.jsx($,{option:{flexCenterCenter:!0},label:"No post would founded!"}):r&&s.jsxs(e.Fragment,{children:[r.map((e=>s.jsx(J,{post:e,type:"preview"},e._id))),r.length%10==0?s.jsx("div",{className:"flex-row-center-center-none",children:s.jsx(G,{onClick:async()=>{const e=l+10;t.set({"posts-count":e}),await i({key:["all-posts"],request:async()=>await x.get(`/home/${e}`)}),a||n||setTimeout((()=>window.scrollTo({behavior:"smooth",top:document.body.scrollHeight})),100)},label:"Load More"})}):null]})}),c?s.jsx(ee,{type:c}):null]})]})}},Symbol.toStringTag,{value:"Module"}));export{S as A,G as B,U as E,I,L,H as P,J as a,k as b,P as c,b as l,se as p,O as u};
