import{c as e,r as s,j as t,b as a,L as n,D as o,h as r,P as i,E as l,G as d,g as c,J as m,K as p}from"../react.js";import{u as _}from"./about.js";import{j as u,u as x,U as h,f as j,h as v,X as g,B as f,d as N,c as w,D as y,l as $,S as b,_ as C,k as T,L as I,E as S,A,M as E,P}from"./admin.js";import{u as O,I as k,c as L,C as R,d as D}from"./database.js";function M(){const t=e(),a=s.useContext(u),n=x(),o=n.get(h["IS-LOGIN-MODAL-OPEN"]),r=n.get(h["IS-REGISTRATE-MODAL-OPEN"]);return{...a?.userState,create:async function(e){try{if(e.setSession)return a?.updateUserState({user:e.setSession,isAuthPending:!1,isLoading:!1});a?.updateUserState({isAuthPending:!1,isLoading:!0});const s=await j.post(e.apiURL,e.body);a?.updateUserState({isAuthPending:!1,isLoading:!1,error:void 0,user:s}),e?.setToken&&v.set("PR_TOKEN",s.token),e?.redirectURL&&t(e.redirectURL)}catch(s){a.updateUserState((e=>({...e,isAuthPending:!1,isLoading:!1,error:s instanceof Error?{code:503,message:"Service Unavailable!"}:JSON.parse(s)})))}},out:function(){a?.updateUserState({isAuthPending:!1,isLoading:!1}),v.set("PR_TOKEN","undefined")},clearError:function(){s.useEffect((()=>{a?.updateUserState((e=>({...e,error:void 0})))}),[o,r])}}}const F={post_loader_container:"z_",post_loader_text:"A_",loader:"B_",post_loader_tag:"C_",post_loader_avatar:"D_"};function U(){return t.jsxs("div",{className:`${F.post_loader_container} main-content-container flex-column-normal-normal-medium`,children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:F.post_loader_avatar}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"4rem"},className:F.post_loader_text}),t.jsx("div",{style:{width:"7rem"},className:F.post_loader_text})]})]}),t.jsx("div",{style:{width:"11rem"},className:F.post_loader_text}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"50%"},className:F.post_loader_text}),t.jsx("div",{style:{width:"20%"},className:F.post_loader_text})]}),t.jsxs("div",{className:"flex-row-normal-space-between-none",children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:F.post_loader_tag}),t.jsx("div",{className:F.post_loader_tag}),t.jsx("div",{className:F.post_loader_tag})]}),t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:F.post_loader_tag}),t.jsx("div",{className:F.post_loader_tag}),t.jsx("div",{className:F.post_loader_tag})]})]})]})}function H({containersCount:e}){return _({title:"Home",description:"Hier kannst du alle letzt geschriebene posts ansehen."}),t.jsx("div",{className:"flex-column-normal-normal-small",children:[...Array(e||3)].map(((e,s)=>t.jsx(U,{},s)))})}const z={post_content_container:"j_",post_title:"k_",post_content_date:"l_",post_tags_statistic_container:"m_",post_data:"n_",post_hidden:"o_",post_statistic_data:"p_",post_liked:"q_",like:"r_"},B={post_header:"re",post_header_author_not_defined:"se",post_action_button:"te",post_action_container:"ue",post_create_date:"ve"},G={confirm_modal_container:"We",confirm_modal_body:"Xe",confirm_modal_header:"Ye",confirm_modal_button:"Ze",confirm_modal_text_body:"_g",confirm_modal_open:"-g"};function W({text:e,onConfirm:a}){const n=x(),o=s.useRef(null),r=O(h["IS-CONFIRM-MODAL-OPEN"],o);return t.jsx("div",{ref:o,className:`${r?G.confirm_modal_open:""} ${G.confirm_modal_container} flex-row-center-center-none`,children:t.jsxs("div",{className:`${G.confirm_modal_body} main-content-container`,children:[t.jsxs("section",{className:`${G.confirm_modal_header} flex-row-center-space-between-medium`,children:[t.jsx("p",{children:"Confirm"}),t.jsx(g,{onClick:()=>{n.remove([h["IS-CONFIRM-MODAL-OPEN"]])}})]}),t.jsxs("div",{className:G.confirm_modal_text_body,children:[t.jsx("p",{children:e}),t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx(f,{label:"Confirm",className:G.confirm_modal_button,onClick:a})})]})]})})}function K({user:s,createdAt:c,type:m,contentID:p,postID:_,content:u,tags:g,title:f,isHidden:C}){const T=N(),I=x(),S=e(),{pathname:A}=a(),E=T.roleAndEqual(["Admin","Creator"],"_id",s?._id).permited(),P=A.search("/post/")>-1,O=A.search("/")>-1,L=A.search("/search")>-1,R="preview"===m?"post":m,D=parseInt(I.get("page")||"0"),M=P&&"comment"===m?`post-${_}-comments-${I.get("page")||0}`:O?"all-posts":"",{mutate:F,changeError:U}=w(M),H=e=>{if(!T.role(["Creator","Admin"]).permited())return U({code:403,message:"You have no edit and remove permission!"});if("edit"===e){if(T.role(["Creator"]).permited())return $.set(p,{content:u,tags:g,title:f,isHidden:C,isEdit:!0,contentType:R,onPage:D,onPost:_}),S(`/write-post?content-id=${p}`);if(T.role(["Admin"]).permited())return S(`/admin/${R}?id=${p}&${R}-edit-modal=true`)}F((async s=>{if("remove"===e){const e=await j.get(`/admin/remove/${b.firstLetterToUpperCase(R)}/${p}`,{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`});if(P&&"comment"===m){const t=s.state||{comments:[],pagesCount:0};if(1===t.comments.length&&t.pagesCount>=1){for(let e=t.pagesCount-1;e>=0;e--)e!==D&&s.removeCache(`post-${_}-comments-${e}`);return S(`/post/${_}?page=${+D-1}`),{pagesCount:0,comments:[]}}return{...t,comments:t.comments.filter((s=>s._id!==e._id))}}if(O){return(s.state||[]).filter((s=>s._id!==e._id))}}const t=await j.post(`/admin/${R}/update`,{id:p,isHidden:"hidde"===e},{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`});if(P){const e=s.state||{pagesCount:0,comments:[]};return{...e,comments:e.comments.map((e=>e._id===t._id?{...e,...t}:e))}}return(s.state||[]).map((e=>e._id===t._id?t:e))}))},z=y.getDifference(c).getSortDate({year:"[year] year [month] months ago!",month:"[month] month [day] days ago!",day:"[day] day [hour] hours ago!",hour:"[hour] hour [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsxs(t.Fragment,{children:[t.jsx(W,{text:"Do you will to remove this post?",onConfirm:()=>{H("remove")}}),t.jsxs("div",{className:`${B.post_header} flex-row-center-space-between-none`,children:[s?t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(k,{styles:{svg:{width:"2rem",height:"2rem"},img:{width:"2rem",height:"2rem"}},src:s?.avatar,alt:s?.name||"User avatar"}),t.jsxs("div",{className:B.post_author,children:[t.jsx(n,{to:`/user/${s?._id}`,children:s?.name}),t.jsx("p",{className:B.post_create_date,children:z})]})]}):t.jsxs("div",{className:`${B.post_header_author_not_defined} flex-row-center-normal-medium`,children:[t.jsx(o,{}),t.jsx("p",{children:"Author is possibly deleted!"})]}),E&&!L?t.jsxs("button",{className:B.post_action_button,children:[t.jsx("svg",{viewBox:"0 0 128 512",children:t.jsx("path",{d:"M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"})}),t.jsxs("ul",{className:`${B.post_action_container} flex-column-normal-normal-none`,children:[t.jsxs("li",{onClick:()=>{I.set({[h["IS-CONFIRM-MODAL-OPEN"]]:!0})},className:"flex-row-center-normal-medium",children:[t.jsx(r,{}),t.jsx("p",{children:"Remove"})]}),t.jsxs("li",{onClick:()=>H("edit"),className:"flex-row-center-normal-medium",children:[t.jsx(i,{}),t.jsx("p",{children:"Edit"})]}),t.jsxs("li",{onClick:()=>H(C?"show":"hidde"),className:"flex-row-center-normal-medium",children:[C?t.jsx(l,{}):t.jsx(d,{}),t.jsx("p",{children:C?"Show":"Hidden"})]})]})]}):null]})]})}const V={post_wrapper_container:"-e",post_is_hidden:"ae"};function q({children:e,className:s}){return t.jsxs("section",{className:`${V.post_wrapper_container} ${s} main-content-container`,children:[s?t.jsxs("div",{className:`${V.post_is_hidden} flex-row-center-center-medium`,children:[t.jsx(d,{}),t.jsx("p",{children:"Hidden"})]}):null,t.jsx("div",{style:{padding:"1rem"},children:e})]})}const J={post_tags:"he"};function X({tags:e}){return t.jsx("div",{className:`${J.post_tags} flex-row-normal-normal-medium`,children:e.map((e=>e.trim()?t.jsx(n,{to:`/search?tag=${e}`,children:e},e):null))})}function Y({post:s,type:o}){const{id:r}=c(),{pathname:i}=a(),d=e(),_=M(),u=x(),g=N(),f=L(),$=i.search("/post")>-1,b="/"===i,C=s.likedBy.includes(_.user?._id||""),T=g.role(["Creator"]).equal("_id",s?.author?._id).permited(),I=g.role(["Admin"]).permited(),S=s.isHidden,A="preview"===o||"post"===o?s._id:r,E="comment"===o?parseInt(u.get("page")||"0"):0,P=S&&I||T&&S?z.post_hidden:"",O="post"===o?`post-${s._id}`:`post-${A}-comments-${E}`,{mutate:k}=w(O);S&&$&&!I&&!T&&"post"===o&&d("/");const D=e=>{u.set({[h["STATISTIC-TO-PREVIEW"]]:e,[h["STATISTIC-PREVIEW-POST-ID"]]:s._id,[h["LIST-PAGE"]]:0})},F=y.getDifference(s.createdAt).getSortDate({year:"[year] years [month] months ago!",month:"[month] months [day] days ago!",day:"[day] days [hour] hours ago!",hour:"[hour] hours [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsx(t.Fragment,{children:b&&!T&&!I&&S?null:t.jsxs(q,{className:P,children:["comment"===o||"preview"===o?t.jsx(K,{tags:s.tags||[],title:s.title||"",content:s.content,isHidden:s.isHidden,postID:A,contentID:s._id,type:o,createdAt:s.createdAt,user:s?.author}):null,"post"===o?t.jsxs("div",{className:z.post_content_container,children:[t.jsx("h4",{style:{fontFamily:f.setting.postFont},className:z.post_title,children:s.title}),t.jsx("p",{className:z.post_content_date,children:F}),t.jsx(R,{content:s.content})]}):null,"preview"===o?t.jsxs("div",{className:z.post_content_container,children:[t.jsx(n,{style:{fontFamily:f.setting.postFont},to:`/post/${s._id}`,children:s.title}),t.jsx(R,{content:`${s.content.slice(0,250)}...`})]}):null,"comment"===o?t.jsx("div",{className:z.post_data,children:t.jsx(R,{content:s.content})}):null,t.jsxs("div",{className:`${z.post_tags_statistic_container} flex-row-center-space-between-medium`,children:["post"!==o&&"preview"!==o||!s.tags?null:t.jsx(X,{tags:s.tags}),t.jsxs("div",{className:"flex-row-center-normal-big",children:["preview"===o?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:`${z.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>D("views"):void 0,children:[t.jsx(l,{}),s.viewedBy?.length]}),t.jsxs("p",{className:`${z.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>D("comments"):void 0,children:[t.jsx(m,{}),s.comments?.length]}),t.jsxs("p",{className:`${z.post_statistic_data} flex-row-center-normal-small`,onClick:b?()=>D("likes"):void 0,children:[t.jsx(p,{}),s.likedBy?.length]})]}):null,"comment"!==o&&"post"!==o||!_.user?null:t.jsxs("button",{onClick:async()=>{s.isHidden&&!_.user||k((async e=>{const t=await j.get(`/${o}/${s._id}/like`,{Authorization:`Bearer ${v.getOne("PR_TOKEN")}`});if("post"===o)return t;const a=e.state,n=a.comments||[];return{...a,comments:n.map((e=>e._id===t._id?t:e))}}))},className:`${C?z.post_liked:""} ${z.post_statistic_data} flex-row-center-normal-small`,children:[t.jsx(p,{}),s.likedBy.length]})]})]})]})})}const Z={preview_container:"E_",preview_body:"F_",preview_header:"G_",preview_item:"H_",preview_item_count:"I_"},Q={pagintion_list_button:"ke",loader:"le"};function ee(){return t.jsxs("div",{style:{width:"100%"},className:"flex-row-normal-space-between-medium",children:[t.jsx("div",{className:Q.pagintion_list_button}),t.jsxs("div",{className:"flex-row-normal-normal-small",children:[t.jsx("div",{className:Q.pagintion_list_button}),t.jsx("div",{className:Q.pagintion_list_button}),t.jsx("div",{className:Q.pagintion_list_button})]}),t.jsx("div",{className:Q.pagintion_list_button})]})}const se={preview_loader:"ee",loader:"fe"};function te(){return t.jsxs("div",{style:{paddingTop:"1rem"},className:"flex-column-normal-normal-medium",children:[t.jsx("div",{className:se.preview_loader}),t.jsx("div",{className:se.preview_loader}),t.jsx("div",{className:se.preview_loader}),t.jsx("div",{className:se.preview_loader}),t.jsx("div",{className:se.preview_loader}),t.jsx("div",{className:se.preview_loader})]})}const ae={views:t.jsx(l,{}),likes:t.jsx(p,{}),comments:t.jsx(m,{})},ne={views:"No body have viewed!",likes:"No body have liked!",comments:"No body have commented!"};function oe({statisticToPreview:e}){const s=x(),a=s.get(h["STATISTIC-PREVIEW-POST-ID"]),o=parseInt(s.get(h["LIST-PAGE"])||"0"),{data:r,prev:i,isPending:l,error:d}=C({deps:[`preview-${e}-${a}-${o}`],prev:[`preview-${e}-${a}-${0===o?0:o-1}`],request:async()=>j.get(`/post/preview/${e}/${a}/${o}`)}),c=i?.pagesCount||r?.pagesCount||0;return t.jsx("section",{className:Z.preview_container,children:t.jsxs("div",{className:`${Z.preview_body} main-content-container`,children:[t.jsxs("div",{className:`${Z.preview_header} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[ae[e],t.jsx("h4",{className:Z.preview_type,children:b.firstLetterToUpperCase(e||"")})]}),t.jsx(g,{onClick:()=>{s.remove([h["STATISTIC-TO-PREVIEW"],h["STATISTIC-PREVIEW-POST-ID"],h["LIST-PAGE"]])}})]}),l?t.jsx(ee,{}):c>1?t.jsx(T,{pagesCount:c}):null,l?t.jsx(te,{}):t.jsx("div",{style:{paddingTop:c>1?"0.5rem":"0rem"},className:Z.preview_item_count_list,children:d?t.jsx(I,{error:d.message}):0!==r?.items?.length&&r?r.items.map((e=>t.jsxs(n,{to:`/user/${e._id}`,className:`${Z.preview_item} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(k,{src:e.avatar,alt:e.name}),t.jsx("p",{children:e.name})]}),t.jsx("p",{className:Z.preview_item_count,children:D.formatNum(e.count)})]},200*Math.random()))):t.jsx(S,{option:{size:"SMALL"},label:ne[e]})})]})})}const re=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const[e,a]=s.useState(10),n=x().get(h["STATISTIC-TO-PREVIEW"]),{mutate:o,...r}=w("all-posts"),{isFetching:i,isMutating:l,data:d,error:c}=C({deps:["all-posts"],request:async()=>await j.get(`/home/${e}`,A)});return t.jsxs(s.Fragment,{children:[l&&t.jsx(E,{}),t.jsxs("div",{style:{height:"100%"},className:"flex-row-normal-normal-medium",children:[t.jsx("div",{style:{flexGrow:1},className:"flex-column-normal-normal-small",children:i?t.jsx(H,{}):c?t.jsx(P,{error:c}):d&&0===d.length?t.jsx(S,{option:{flexCenterCenter:!0},label:"Nothing found!"}):d&&t.jsxs(s.Fragment,{children:[d.map((e=>t.jsx(Y,{post:e,type:"preview"},e._id))),r.error&&t.jsx(I,{error:r.error.message}),d.length%10==0?t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx(f,{onClick:async()=>{const s=e+10;a((e=>e+10)),await o((async()=>await j.get(`/home/${s}`))),i||l||setTimeout((()=>window.scrollTo({behavior:"smooth",top:document.body.scrollHeight})),100)},label:"Load More"})}):null]})}),n&&t.jsx(oe,{statisticToPreview:n})]})]})}},Symbol.toStringTag,{value:"Module"}));export{H as L,U as P,Y as a,re as p,M as u};
