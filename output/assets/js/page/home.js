import{k as e,r as s,j as t,i as n,L as a,D as r,q as i,P as o,E as c,G as l,J as m,w as d,o as x,K as u,O as h,Q as p,v as j}from"../react.js";import"./about.js";import{m as v,u as g,U as N,h as f,n as w,j as _,X as y,B as $,d as C,b as T,D as S,I,o as P,S as A,A as E,g as b,p as L,N as O,L as k,P as D,E as F,_ as R,q as M,M as U}from"./admin.js";function q(){const t=e(),n=s.useContext(v),a=g(),r=a.get(N["IS-LOGIN-MODAL-OPEN"]),i=a.get(N["IS-REGISTRATE-MODAL-OPEN"]);return{...n?.userState,create:async function(e){try{if(e.setSession)return n?.updateUserState({user:e.setSession,isAuthPending:!1,isLoading:!1});n?.updateUserState({isAuthPending:!1,isLoading:!0});const s=await f.post(e.apiURL,e.body);n?.updateUserState({isAuthPending:!1,isLoading:!1,error:void 0,user:s}),e?.setToken&&w.set("PR_TOKEN",s.token),e?.redirectURL&&t(e.redirectURL)}catch(s){n.updateUserState((e=>({...e,isAuthPending:!1,isLoading:!1,error:s instanceof Error?{code:503,message:"Service Unavailable!"}:JSON.parse(s)})))}},out:function(){n?.updateUserState({isAuthPending:!1,isLoading:!1}),w.set("PR_TOKEN","undefined")},clearError:function(){s.useEffect((()=>{n?.updateUserState((e=>({...e,error:void 0})))}),[r,i])}}}const H="y_",z="z_",B="B_",G="C_";function V(){return t.jsxs("div",{className:`${H} main-content-container flex-column-normal-normal-medium`,children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:G}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"4rem"},className:z}),t.jsx("div",{style:{width:"7rem"},className:z})]})]}),t.jsx("div",{style:{width:"11rem"},className:z}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"50%"},className:z}),t.jsx("div",{style:{width:"20%"},className:z})]}),t.jsxs("div",{className:"flex-row-normal-space-between-none",children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:B}),t.jsx("div",{className:B}),t.jsx("div",{className:B})]}),t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:B}),t.jsx("div",{className:B}),t.jsx("div",{className:B})]})]})]})}function W({containersCount:e}){return t.jsx("div",{className:"flex-column-normal-normal-small",children:[...Array(e||3)].map(((e,s)=>t.jsx(V,{},s)))})}const K="n",Q="p",J="G_",X="H_",Y="I_",Z="J_",ee="K_",se="L_",te="M_",ne="N_",ae="P_",re="Q_",ie={post_header:"xe",post_header_author_not_defined:"ye",post_action_button:"ze",post_action_container:"Ae",post_create_date:"Be"},oe="ug",ce="vg",le="wg",me="xg",de="yg",xe="zg";function ue({text:e,onConfirm:n}){const a=g(),r=s.useRef(null),i=_(N["IS-CONFIRM-MODAL-OPEN"],r);return t.jsx("div",{ref:r,className:`${i?xe:""} ${oe} flex-row-center-center-none`,children:t.jsxs("div",{className:`${ce} main-content-container`,children:[t.jsxs("section",{className:`${le} flex-row-center-space-between-medium`,children:[t.jsx("p",{children:"Confirm"}),t.jsx(y,{onClick:()=>{a.remove([N["IS-CONFIRM-MODAL-OPEN"]])}})]}),t.jsxs("div",{className:de,children:[t.jsx("p",{children:e}),t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx($,{label:"Confirm",className:me,onClick:n})})]})]})})}function he({user:s,createdAt:m,type:d,contentID:x,postID:u,content:h,tags:p,title:j,isHidden:v}){const w=C(),_=g(),y=e(),{pathname:$}=n(),b=w.roleAndEqual(["Admin","Creator"],"_id",s?._id).permited(),L=$.search("/post/")>-1,O=$.search("/")>-1,k=$.search("/search")>-1,D="preview"===d?"post":d,F=parseInt(_.get("page")||"0"),R=L&&"comment"===d?`post-${u}-comments-${_.get("page")||0}`:O?"all-posts":"",{mutate:M,changeError:U}=T(R),q=e=>{if(!w.role(["Creator","Admin"]).permited())return U({code:403,message:"You have no edit and remove permission!"});if("edit"===e){if(w.role(["Creator"]).permited())return P.set(x,{content:h,tags:p,title:j,isHidden:v,isEdit:!0,contentType:D,onPage:F,onPost:u}),y(`/write-post?content-id=${x}`);if(w.role(["Admin"]).permited())return y(`/admin/${D}?id=${x}&${D}-edit-modal=true`)}M((async s=>{if("remove"===e){const e=await f.get(`/admin/remove/${A.firstLetterToUpperCase(D)}/${x}`,E);if(L&&"comment"===d){const t=s.state||{comments:[],pagesCount:0};if(1===t.comments.length&&t.pagesCount>=1){for(let e=t.pagesCount-1;e>=0;e--)e!==F&&s.removeCache(`post-${u}-comments-${e}`);return y(`/post/${u}?page=${+F-1}`),{pagesCount:0,comments:[]}}return{...t,comments:t.comments.filter((s=>s._id!==e._id))}}if(O){return(s.state||[]).filter((s=>s._id!==e._id))}}const t=await f.post(`/admin/${D}/update`,{id:x,isHidden:"hidde"===e,flag:e},E);if(L){const e=s.state||{pagesCount:0,comments:[]};return{...e,comments:e.comments.map((e=>e._id===t._id?{...e,...t}:e))}}return(s.state||[]).map((e=>e._id===t._id?t:e))}))},H=S.getDifference(m).getSortDate({year:"[year] year [month] months ago!",month:"[month] month [day] days ago!",day:"[day] day [hour] hours ago!",hour:"[hour] hour [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsxs(t.Fragment,{children:[t.jsx(ue,{text:"Do you will to remove this post?",onConfirm:()=>{q("remove")}}),t.jsxs("div",{className:`${ie.post_header} flex-row-center-space-between-none`,children:[s?t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(I,{styles:{svg:{width:"2rem",height:"2rem"},img:{width:"2rem",height:"2rem"}},src:s?.avatar,alt:s?.name||"User avatar"}),t.jsxs("div",{className:ie.post_author,children:[t.jsx(a,{to:`/user/${s?._id}`,children:s?.name}),t.jsx("p",{className:ie.post_create_date,children:H})]})]}):t.jsxs("div",{className:`${ie.post_header_author_not_defined} flex-row-center-normal-medium`,children:[t.jsx(r,{}),t.jsx("p",{children:"Author is possibly deleted!"})]}),b&&!k?t.jsxs("button",{className:ie.post_action_button,children:[t.jsx("svg",{viewBox:"0 0 128 512",children:t.jsx("path",{d:"M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"})}),t.jsxs("ul",{className:`${ie.post_action_container} flex-column-normal-normal-none`,children:[t.jsxs("li",{onClick:()=>{_.set({[N["IS-CONFIRM-MODAL-OPEN"]]:!0})},className:"flex-row-center-normal-medium",children:[t.jsx(i,{}),t.jsx("p",{children:"Remove"})]}),t.jsxs("li",{onClick:()=>q("edit"),className:"flex-row-center-normal-medium",children:[t.jsx(o,{}),t.jsx("p",{children:"Edit"})]}),t.jsxs("li",{onClick:()=>q(v?"show":"hidde"),className:"flex-row-center-normal-medium",children:[v?t.jsx(c,{}):t.jsx(l,{}),t.jsx("p",{children:v?"Show":"Hidden"})]})]})]}):null]})]})}const pe="oe",je="pe";function ve({children:e,className:s}){return t.jsxs("section",{className:`${pe} ${s} main-content-container`,children:[s?t.jsxs("div",{className:`${je} flex-row-center-center-medium`,children:[t.jsx(l,{}),t.jsx("p",{children:"Hidden"})]}):null,t.jsx("div",{style:{padding:"1rem"},children:e})]})}const ge="Ke";function Ne({tags:e}){return t.jsx("div",{className:`${ge} flex-row-normal-normal-medium`,children:e.map((e=>e.trim()?t.jsx(a,{to:`/search?tag=${e}`,children:e},e):null))})}const fe="se",we="te",_e="ve",ye="we";function $e({content:e}){const[n,a]=s.useState(!1);return t.jsxs("div",{className:`${fe} main-content-container`,children:[t.jsxs("div",{className:`${we} flex-row-center-space-between-medium`,onClick:()=>{a((e=>!e))},children:[t.jsxs("p",{children:["Zitate von ",e.author?.name]}),n?t.jsx(m,{}):t.jsx(d,{})]}),t.jsx("div",{className:n?`${ye} ${_e}`:_e,children:t.jsx(b,{content:e.content})})]})}function Ce({setToQuote:s,post:r,type:i,isQuoted:o}){const{id:l}=x(),{pathname:m}=n(),d=e(),v=q(),w=g(),_=C(),y=L(),$=m.search("/post")>-1,I="/"===m,P=r.likedBy.includes(v.user?._id||""),A=_.role(["Creator"]).equal("_id",r?.author?._id).permited(),k=_.role(["Admin"]).permited(),D=r.isHidden,F="preview"===i||"post"===i?r._id:l,R="comment"===i?parseInt(w.get("page")||"0"):0,M=D&&k||A&&D?se:"",U="post"===i?`post-${r._id}`:`post-${F}-comments-${R}`,{mutate:H}=T(U);D&&$&&!k&&!A&&"post"===i&&d("/");const z=e=>{w.set({[N["STATISTIC-TO-PREVIEW"]]:e,[N["STATISTIC-PREVIEW-POST-ID"]]:r._id,[N["LIST-PAGE"]]:0})},B=S.getDifference(r.createdAt).getSortDate({year:"[year] years [month] months ago!",month:"[month] months [day] days ago!",day:"[day] days [hour] hours ago!",hour:"[hour] hours [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsx(t.Fragment,{children:I&&!A&&!k&&D?null:t.jsxs(ve,{className:M,children:[("comment"===i||"preview"===i)&&t.jsx(he,{tags:r.tags||[],title:r.title||"",content:r.content,isHidden:r.isHidden,postID:F,contentID:r._id,type:i,createdAt:r.createdAt,user:r?.author}),"post"===i&&t.jsxs("div",{className:J,children:[t.jsx("h4",{style:{fontFamily:y.setting.postFont},className:X,children:r.title}),t.jsx("p",{className:Y,children:B}),t.jsx(b,{content:r.content})]}),"preview"===i&&t.jsxs("div",{className:J,children:[t.jsx(a,{style:{fontFamily:y.setting.postFont},to:`/post/${r._id}`,children:r.title}),t.jsx(b,{content:`${r.content.slice(0,250)}...`})]}),"comment"===i&&t.jsxs("div",{className:ee,children:[t.jsx(b,{content:r.content}),0!==r.quotes?.length&&r.quotes&&r.quotes.map((e=>t.jsx($e,{content:e},e._id)))]}),t.jsxs("div",{className:`${Z} flex-row-center-space-between-medium`,children:[("post"===i||"preview"===i)&&r.tags&&t.jsx(Ne,{tags:r.tags}),t.jsxs("div",{className:"flex-row-center-normal-big",children:["preview"===i&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:`${te} flex-row-center-normal-small`,onClick:I?()=>z("views"):void 0,children:[t.jsx(c,{}),O.shortNum(r.viewedBy.length)]}),t.jsxs("p",{className:`${te} flex-row-center-normal-small`,onClick:I?()=>z("comments"):void 0,children:[t.jsx(u,{}),O.shortNum(r.comments.length)]}),t.jsxs("p",{className:`${te} flex-row-center-normal-small`,onClick:I?()=>z("likes"):void 0,children:[t.jsx(h,{}),O.shortNum(r.likedBy.length)]})]}),"comment"===i&&t.jsx("button",{onClick:()=>{s&&s((e=>o?e.filter((e=>e._id!==r._id)):[...e,r]))},className:`${ae} ${o&&re} flex-row-center-center-none`,children:o?t.jsx(p,{}):t.jsx(j,{})}),"comment"!==i&&"post"!==i||!v.user?null:t.jsxs("button",{onClick:async()=>{r.isHidden&&!v.user||H((async e=>{const s=await f.get(`/${i}/${r._id}/like`,E);if("post"===i)return s;const t=e.state,n=t.comments||[];return{...t,comments:n.map((e=>e._id===s._id?s:e))}}))},className:`${P?ne:""} ${te} flex-row-center-normal-small`,children:[t.jsx(h,{}),O.shortNum(r.likedBy.length)]})]})]})]})})}function Te({data:e,loaderComponent:s,useLocalErrorComponent:n,error:a,emptyLabel:r,isFetching:i,isPending:o,emptyOptions:c,dataComponent:l}){const m=i||o||!1,d=Array.isArray(e)&&0===e.length;return t.jsx(t.Fragment,{children:a?n?t.jsx(k,{error:a.message}):t.jsx(D,{error:a}):m&&!e?s:!d&&e||!r?l():t.jsx(F,{label:r,option:{flexCenterCenter:!0,...c}})})}const Se={preview_container:"_a",preview_body:"-a",preview_header:"aa",preview_item:"ba",preview_avatar:"ca",preview_item_count:"da"},Ie="qe";function Pe(){return t.jsxs("div",{style:{width:"100%"},className:"flex-row-normal-space-between-medium",children:[t.jsx("div",{className:Ie}),t.jsxs("div",{className:"flex-row-normal-normal-small",children:[t.jsx("div",{className:Ie}),t.jsx("div",{className:Ie}),t.jsx("div",{className:Ie})]}),t.jsx("div",{className:Ie})]})}const Ae="be";function Ee(){return t.jsxs("div",{style:{paddingTop:"1rem"},className:"flex-column-normal-normal-medium",children:[t.jsx("div",{className:Ae}),t.jsx("div",{className:Ae}),t.jsx("div",{className:Ae}),t.jsx("div",{className:Ae}),t.jsx("div",{className:Ae}),t.jsx("div",{className:Ae})]})}const be={views:{icon:t.jsx(c,{}),emptyText:"Nieman hat sich dieses Post angeschaut!"},likes:{icon:t.jsx(h,{}),emptyText:"Niemand hat dieses Post geliked!"},comments:{icon:t.jsx(u,{}),emptyText:"Niemand hat dieses Post kommentiert!"}};function Le({statisticToPreview:e}){const s=g(),n=s.get(N["STATISTIC-PREVIEW-POST-ID"]),r=parseInt(s.get(N["LIST-PAGE"])||"0"),{data:i,prev:o,isPending:c,error:l}=R({deps:[`post/preview/${e}/${n}/${r}`],prev:[`post/preview/${e}/${n}/${0===r?0:r-1}`],request:async()=>f.get(`/post/preview/${e}/${n}/${r}`)}),m=o?.pagesCount||i?.pagesCount||0;return t.jsx("section",{className:Se.preview_container,children:t.jsxs("div",{className:`${Se.preview_body} main-content-container`,children:[t.jsxs("div",{className:`${Se.preview_header} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[be[e].icon,t.jsx("h4",{className:Se.preview_type,children:A.firstLetterToUpperCase(e||"")})]}),t.jsx(y,{onClick:()=>{s.remove([N["STATISTIC-TO-PREVIEW"],N["STATISTIC-PREVIEW-POST-ID"],N["LIST-PAGE"]])}})]}),t.jsxs("div",{className:"flex-column-normal-normal-small",children:[c?t.jsx(Pe,{}):m>1?t.jsx(M,{pagesCount:m}):null,t.jsx(Te,{isFetching:c,data:i?.items,emptyOptions:{size:"SMALL"},emptyLabel:be[e].emptyText,error:l,loaderComponent:t.jsx(Ee,{}),dataComponent:()=>t.jsx(t.Fragment,{children:i.items.map((s=>t.jsxs(a,{to:`/user/${s._id}`,className:`${Se.preview_item} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(I,{classNames:{img:Se.preview_avatar,svg:Se.preview_avatar},src:s.avatar,alt:s.name}),t.jsx("p",{children:s?.name||s.author?.name})]}),"views"===e&&t.jsx("p",{className:`${Se.preview_item_count} flex-row-center-center-none`,children:O.shortNum(s.count)})]},200*Math.random())))})})]})]})})}const Oe=s.memo(Ce);const ke=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const[e,n]=s.useState(10),a=g().get(N["STATISTIC-TO-PREVIEW"]),{isFetching:r,isPending:i,data:o,error:c,request:l}=R({deps:[`/${e}`],request:async()=>await f.get(`/home/${e}`,E)}),m=async()=>{n((e=>e+10)),await l(),r||i||setTimeout((()=>window.scrollTo({behavior:"smooth",top:document.body.scrollHeight})),100)};return t.jsxs(s.Fragment,{children:[i&&o&&t.jsx(U,{}),t.jsxs("div",{className:`${K} flex-row-normal-normal-medium`,children:[t.jsx("div",{className:`${K} flex-column-normal-normal-small`,children:t.jsx(Te,{isFetching:r,loaderComponent:t.jsx(W,{}),error:c,data:o,emptyLabel:"Es wurde nichts gefunden!",dataComponent:()=>t.jsxs(s.Fragment,{children:[o.map((e=>t.jsx(Oe,{post:e,type:"preview"},e._id))),!(o.length%10)&&t.jsx($,{className:Q,onClick:m,children:"Mehr Laden"})]})})}),a&&t.jsx(Le,{statisticToPreview:a})]})]})}},Symbol.toStringTag,{value:"Module"}));export{W as L,Ce as P,V as a,ke as p,q as u};
