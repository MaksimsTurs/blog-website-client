import{c as e,r as s,j as t,b as a,L as n,y as o,h as r,P as i,E as l,z as c,g as d,D as m,G as _}from"../react.js";import{u as p}from"./about.js";import{k as u,u as h,U as x,f as j,i as g,X as f,B as v,e as N,d as w,D as y,l as $,C,_ as A,A as S,M as b,P as O,E,L as I}from"./admin.js";import{u as T,I as P,C as L}from"./database.js";function k(){const t=e(),a=s.useContext(u),n=h(),o=n.get(x["IS-LOGIN-MODAL-OPEN"]),r=n.get(x["IS-REGISTRATE-MODAL-OPEN"]);return{...a?.userState,create:async function(e){try{if(e.setSession)return a?.updateUserState({user:e.setSession,isAuthPending:!1,isLoading:!1});a?.updateUserState({isAuthPending:!1,isLoading:!0});const s=await j.post(e.apiURL,e.body);a?.updateUserState({isAuthPending:!1,isLoading:!1,error:void 0,user:s}),e?.setToken&&g.set("PR_TOKEN",s.token),e?.redirectURL&&t(e.redirectURL)}catch(s){a.updateUserState((e=>({...e,isAuthPending:!1,isLoading:!1,error:s instanceof Error?{code:503,message:"Service Unavailable!"}:JSON.parse(s)})))}},out:function(){a?.updateUserState({isAuthPending:!1,isLoading:!1}),g.set("PR_TOKEN","undefined")},clearError:function(){s.useEffect((()=>{a?.updateUserState((e=>({...e,error:void 0})))}),[o,r])}}}const R={post_loader_container:"A_",post_loader_text:"B_",loader:"C_",post_loader_tag:"D_",post_loader_avatar:"E_"};function D(){return t.jsxs("div",{className:`${R.post_loader_container} main-content-container flex-column-normal-normal-medium`,children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:R.post_loader_avatar}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"4rem"},className:R.post_loader_text}),t.jsx("div",{style:{width:"7rem"},className:R.post_loader_text})]})]}),t.jsx("div",{style:{width:"11rem"},className:R.post_loader_text}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"50%"},className:R.post_loader_text}),t.jsx("div",{style:{width:"20%"},className:R.post_loader_text})]}),t.jsxs("div",{className:"flex-row-normal-space-between-none",children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:R.post_loader_tag}),t.jsx("div",{className:R.post_loader_tag}),t.jsx("div",{className:R.post_loader_tag})]}),t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:R.post_loader_tag}),t.jsx("div",{className:R.post_loader_tag}),t.jsx("div",{className:R.post_loader_tag})]})]})]})}function M({containersCount:e}){return p({title:"Home",description:"Hier kannst du alle letzt geschriebene posts ansehen."}),t.jsx("div",{className:"flex-column-normal-normal-small",children:[...Array(e||3)].map(((e,s)=>t.jsx(D,{},s)))})}const U={post_content_container:"F_",post_title:"G_",post_short_view:"H_",post_content_date:"I_",post_tags_statistic_container:"J_",post_data:"K_",post_hidden:"L_",post_statistic_data:"M_",post_liked:"N_",like:"O_"},H={post_header:"Rc",post_header_author_not_defined:"Sc",post_action_button:"Tc",post_action_container:"Uc",post_create_date:"Vc"},B={confirm_modal_container:"Je",confirm_modal_body:"Ke",confirm_modal_header:"Le",confirm_modal_button:"Me",confirm_modal_text_body:"Ne",confirm_modal_open:"Oe"};function F({text:e,onConfirm:a}){const n=h(),o=s.useRef(null),r=T(x["IS-CONFIRM-MODAL-OPEN"],o);return t.jsx("div",{ref:o,className:`${r?B.confirm_modal_open:""} ${B.confirm_modal_container} flex-row-center-center-none`,children:t.jsxs("div",{className:`${B.confirm_modal_body} main-content-container`,children:[t.jsxs("section",{className:`${B.confirm_modal_header} flex-row-center-space-between-medium`,children:[t.jsx("p",{children:"Confirm"}),t.jsx(f,{onClick:()=>{n.remove([x["IS-CONFIRM-MODAL-OPEN"]])}})]}),t.jsxs("div",{className:B.confirm_modal_text_body,children:[t.jsx("p",{children:e}),t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx(v,{label:"Confirm",className:B.confirm_modal_button,onClick:a})})]})]})})}function z({user:s,createdAt:d,type:m,contentID:_,postID:p,content:u,tags:f,title:v,isHidden:A}){const S=N(),b=h(),O=e(),{pathname:E}=a(),I=S.roleAndEqual(["Admin","Creator"],"_id",s?._id).permited(),T=E.search("/post/")>-1,L=E.search("/")>-1,k=E.search("/search")>-1,R="preview"===m?"post":m,D=parseInt(b.get("page")||"0"),M=T&&"comment"===m?`post-${p}-comments-${b.get("page")||0}`:L?"all-posts":"",{mutate:U,changeError:B}=w(M),z=e=>{if(!S.role(["Creator","Admin"]).permited())return B({code:403,message:"You have no edit and remove permission!"});if("edit"===e){if(S.role(["Creator"]).permited())return $.set(_,{content:u,tags:f,title:v,isHidden:A,isEdit:!0,contentType:R,onPage:D,onPost:p}),O(`/write-post?content-id=${_}`);if(S.role(["Admin"]).permited())return O(`/admin/${R}?id=${_}&${R}-edit-modal=true`)}U((async s=>{if("remove"===e){const e=await j.get(`/admin/remove/${C.firstLetterToUpperCase(R)}/${_}`,{Authorization:`Bearer ${g.getOne("PR_TOKEN")}`});if(T&&"comment"===m){const t=s.state||{comments:[],pagesCount:0};if(1===t.comments.length&&t.pagesCount>=1){for(let e=t.pagesCount-1;e>=0;e--)e!==D&&s.removeCache(`post-${p}-comments-${e}`);return O(`/post/${p}?page=${+D-1}`),{pagesCount:0,comments:[]}}return{...t,comments:t.comments.filter((s=>s._id!==e._id))}}if(L){return(s.state||[]).filter((s=>s._id!==e._id))}}const t=await j.post(`/admin/${R}/update`,{id:_,isHidden:"hidde"===e},{Authorization:`Bearer ${g.getOne("PR_TOKEN")}`});if(T){const e=s.state||{pagesCount:0,comments:[]};return{...e,comments:e.comments.map((e=>e._id===t._id?{...e,...t}:e))}}return(s.state||[]).map((e=>e._id===t._id?t:e))}))},K=y.getDifference(d).getSortDate({year:"[year] year [month] months ago!",month:"[month] month [day] days ago!",day:"[day] day [hour] hours ago!",hour:"[hour] hour [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsxs(t.Fragment,{children:[t.jsx(F,{text:"Do you will to remove this post?",onConfirm:()=>{z("remove")}}),t.jsxs("div",{className:`${H.post_header} flex-row-center-space-between-none`,children:[s?t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(P,{styles:{svg:{width:"2rem",height:"2rem"},img:{width:"2rem",height:"2rem"}},src:s?.avatar,alt:s?.name||"User avatar"}),t.jsxs("div",{className:H.post_author,children:[t.jsx(n,{to:`/user/${s?._id}`,children:s?.name}),t.jsx("p",{className:H.post_create_date,children:K})]})]}):t.jsxs("div",{className:`${H.post_header_author_not_defined} flex-row-center-normal-medium`,children:[t.jsx(o,{}),t.jsx("p",{children:"Author is possibly deleted!"})]}),I&&!k?t.jsxs("button",{className:H.post_action_button,children:[t.jsx("svg",{viewBox:"0 0 128 512",children:t.jsx("path",{d:"M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"})}),t.jsxs("ul",{className:`${H.post_action_container} flex-column-normal-normal-none`,children:[t.jsxs("li",{onClick:()=>{b.set({[x["IS-CONFIRM-MODAL-OPEN"]]:!0})},className:"flex-row-center-normal-medium",children:[t.jsx(r,{}),t.jsx("p",{children:"Remove"})]}),t.jsxs("li",{onClick:()=>z("edit"),className:"flex-row-center-normal-medium",children:[t.jsx(i,{}),t.jsx("p",{children:"Edit"})]}),t.jsxs("li",{onClick:()=>z(A?"show":"hidde"),className:"flex-row-center-normal-medium",children:[A?t.jsx(l,{}):t.jsx(c,{}),t.jsx("p",{children:A?"Show":"Hidden"})]})]})]}):null]})]})}const K={post_wrapper_container:"Lc",post_is_hidden:"Mc"};function G({children:e,className:s}){return t.jsxs("section",{className:`${K.post_wrapper_container} ${s} main-content-container`,children:[s?t.jsxs("div",{className:`${K.post_is_hidden} flex-row-center-center-medium`,children:[t.jsx(c,{}),t.jsx("p",{children:"Hidden"})]}):null,t.jsx("div",{style:{padding:"1rem"},children:e})]})}const V={post_tags:"Nc"};function q({tags:e}){return t.jsx("div",{className:`${V.post_tags} flex-row-normal-normal-medium`,children:e.map((e=>e.trim()?t.jsx(n,{to:`/search?tag=${e}`,children:e},e):null))})}function J({post:s,type:o}){const{id:r}=d(),{pathname:i}=a(),c=e(),p=k(),u=h(),f=N(),v=i.search("/post")>-1,$="/"===i,C=s.likedBy.includes(p.user?._id||""),A=f.role(["Creator"]).equal("_id",s?.author?._id).permited(),S=f.role(["Admin"]).permited(),b=s.isHidden,O="preview"===o||"post"===o?s._id:r,E="comment"===o?parseInt(u.get("page")||"0"):0,I=b&&S||A&&b?U.post_hidden:"",T="post"===o?`post-${s._id}`:`post-${O}-comments-${E}`,{mutate:P}=w(T);b&&v&&!S&&!A&&"post"===o&&c("/");const R=e=>{u.set({[x["STATISTIC-TO-PREVIEW"]]:e,[x["STATISTIC-PREVIEW-POST-ID"]]:s._id,[x["LIST-PAGE"]]:0})},D=y.getDifference(s.createdAt).getSortDate({year:"[year] years [month] months ago!",month:"[month] months [day] days ago!",day:"[day] days [hour] hours ago!",hour:"[hour] hours [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsx(t.Fragment,{children:$&&!A&&!S&&b?null:t.jsxs(G,{className:I,children:["comment"===o||"preview"===o?t.jsx(z,{tags:s.tags||[],title:s.title||"",content:s.content,isHidden:s.isHidden,postID:O,contentID:s._id,type:o,createdAt:s.createdAt,user:s?.author}):null,"post"===o?t.jsxs("div",{className:U.post_content_container,children:[t.jsx("h4",{className:U.post_title,children:s.title}),t.jsx("p",{className:U.post_content_date,children:D}),t.jsx(L,{content:s.content})]}):null,"preview"===o?t.jsxs("div",{className:U.post_content_container,children:[t.jsx(n,{to:`/post/${s._id}`,children:s.title}),t.jsx(L,{className:U.post_short_view,content:s.content.slice(0,200)})]}):null,"comment"===o?t.jsx("div",{className:U.post_data,children:t.jsx(L,{content:s.content})}):null,t.jsxs("div",{className:`${U.post_tags_statistic_container} flex-row-center-space-between-medium`,children:["post"!==o&&"preview"!==o||!s.tags?null:t.jsx(q,{tags:s.tags}),t.jsxs("div",{className:"flex-row-center-normal-big",children:["preview"===o?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:`${U.post_statistic_data} flex-row-center-normal-small`,onClick:$?()=>R("views"):void 0,children:[t.jsx(l,{}),s.viewedBy?.length]}),t.jsxs("p",{className:`${U.post_statistic_data} flex-row-center-normal-small`,onClick:$?()=>R("comments"):void 0,children:[t.jsx(m,{}),s.comments?.length]}),t.jsxs("p",{className:`${U.post_statistic_data} flex-row-center-normal-small`,onClick:$?()=>R("likes"):void 0,children:[t.jsx(_,{}),s.likedBy?.length]})]}):null,"comment"!==o&&"post"!==o||!p.user?null:t.jsxs("button",{onClick:async()=>{s.isHidden&&!p.user||P((async e=>{const t=await j.get(`/${o}/${s._id}/like`,{Authorization:`Bearer ${g.getOne("PR_TOKEN")}`});if("post"===o)return t;const a=e.state,n=a.comments||[];return{...a,comments:n.map((e=>e._id===t._id?t:e))}}))},className:`${C?U.post_liked:""} ${U.post_statistic_data} flex-row-center-normal-small`,children:[t.jsx(_,{}),s.likedBy.length]})]})]})]})})}const W=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const[e,a]=s.useState(10);h().get(x["STATISTIC-TO-PREVIEW"]);const{mutate:n,...o}=w("all-posts"),{isFetching:r,isMutating:i,data:l,error:c}=A({deps:["all-posts"],request:async()=>await j.get(`/home/${e}`,S)});return t.jsxs(s.Fragment,{children:[i&&t.jsx(b,{}),t.jsx("div",{style:{height:"100%"},className:"flex-row-normal-normal-medium",children:t.jsx("div",{style:{flexGrow:1},className:"flex-column-normal-normal-small",children:r?t.jsx(M,{}):c?t.jsx(O,{error:c}):l&&0===l.length?t.jsx(E,{option:{flexCenterCenter:!0},label:"Nothing found!"}):l&&t.jsxs(s.Fragment,{children:[l.map((e=>t.jsx(J,{post:e,type:"preview"},e._id))),o.error&&t.jsx(I,{error:o.error.message}),l.length%10==0?t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx(v,{onClick:async()=>{const s=e+10;a((e=>e+10)),await n((async()=>await j.get(`/home/${s}`))),r||i||setTimeout((()=>window.scrollTo({behavior:"smooth",top:document.body.scrollHeight})),100)},label:"Load More"})}):null]})})})]})}},Symbol.toStringTag,{value:"Module"}));export{M as L,D as P,J as a,W as p,k as u};
