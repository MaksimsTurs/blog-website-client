import{c as e,r as s,j as t,b as a,L as n,x as o,h as r,P as i,E as l,y as d,g as c,z as m,D as p,X as _}from"../react.js";import{A as u,u as x,f as h,h as j,d as v,_ as g,D as w,l as f,C as N,c as y,U as $,j as C,L as T,E as b,k as S,M as A,P as I,B as P}from"./admin.js";import{a as k,I as E,C as L}from"./database.js";function O(){const t=e(),a=s.useContext(u),n=x(),o=n.get("login-modal"),r=n.get("registration-modal");return{...a?.userState,create:async function(e){try{if(e.setSession)return a?.updateUserState({user:e.setSession,isAuthPending:!1,isLoading:!1});a?.updateUserState({isAuthPending:!1,isLoading:!0});const s=await h.post(e.apiURL,e.body);a?.updateUserState({isAuthPending:!1,isLoading:!1,error:void 0,user:s}),e?.setToken&&j.set("PR_TOKEN",s.token),e?.redirectURL&&t(e.redirectURL)}catch(s){a.updateUserState((e=>({...e,isAuthPending:!1,isLoading:!1,error:s instanceof Error?{code:503,message:"Service Unavailable!"}:JSON.parse(s)})))}},out:function(){a?.updateUserState({isAuthPending:!1,isLoading:!1}),j.set("PR_TOKEN","undefined")},clearError:function(){s.useEffect((()=>{a?.updateUserState((e=>({...e,error:void 0})))}),[o,r])}}}const H={post_loader_container:"y_",post_loader_text:"z_",loader:"A_",post_loader_tag:"B_",post_loader_avatar:"C_"};function U(){return t.jsxs("div",{className:`${H.post_loader_container} main-content-container flex-column-normal-normal-medium`,children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:H.post_loader_avatar}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"4rem"},className:H.post_loader_text}),t.jsx("div",{style:{width:"7rem"},className:H.post_loader_text})]})]}),t.jsx("div",{style:{width:"11rem"},className:H.post_loader_text}),t.jsxs("div",{className:"flex-column-normal-normal-medium",children:[t.jsx("div",{style:{width:"50%"},className:H.post_loader_text}),t.jsx("div",{style:{width:"20%"},className:H.post_loader_text})]}),t.jsxs("div",{className:"flex-row-normal-space-between-none",children:[t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:H.post_loader_tag}),t.jsx("div",{className:H.post_loader_tag}),t.jsx("div",{className:H.post_loader_tag})]}),t.jsxs("div",{className:"flex-row-normal-normal-medium",children:[t.jsx("div",{className:H.post_loader_tag}),t.jsx("div",{className:H.post_loader_tag}),t.jsx("div",{className:H.post_loader_tag})]})]})]})}function D({containersCount:e}){return k({title:"Home",description:"Hier kannst du alle letzt geschriebene posts ansehen."}),t.jsx("div",{className:"flex-column-normal-normal-small",children:[...Array(e||3)].map(((e,s)=>t.jsx(U,{},s)))})}const R={post_content_container:"ic",post_title:"jc",post_short_view:"kc",post_content_date:"lc",post_tags_statistic_container:"mc",post_data:"nc",post_hidden:"oc",post_statistic_data:"pc",post_liked:"qc",like:"rc"},z={post_header:"ue",post_header_author_not_defined:"ve",post_action_button:"we",post_action_container:"xe",post_create_date:"ye"};function B({user:s,createdAt:c,type:m,contentID:p,postID:_,content:u,tags:y,title:$,isHidden:C}){const T=v(),b=x(),S=e(),{mutate:A,changeError:I}=g({deps:[]}),{pathname:P}=a(),k=T.roleAndEqual(["Admin","Creator"],"_id",s?._id).permited(),L=P.search("/post/")>-1,O=P.search("/")>-1,H=P.search("/search")>-1,U="preview"===m?"post":m,D=parseInt(b.get("page")||"0"),R=e=>{const s=L&&"comment"===m?[`post-${_}-comments-${b.get("page")||0}`]:O?["all-posts"]:[];if(!T.role(["Creator","Admin"]).permited())return I({code:403,message:"You have no edit and remove permission!"});if("edit"===e){if(T.role(["Creator"]).permited())return f.set(p,{content:u,tags:y,title:$,isHidden:C,isEdit:!0,contentType:U,onPage:D,onPost:_}),S(`/write-post?content-id=${p}`);if(T.role(["Admin"]).permited())return S(`/admin/${U}?id=${p}&${U}-edit-modal=true`)}A({key:s,request:async s=>{if("remove"===e){const e=await h.get(`/admin/remove/${N.firstLetterToUpperCase(U)}/${p}`,{Authorization:`Bearer ${j.getOne("PR_TOKEN")}`});if(L&&"comment"===m){const t=s.state||{comments:[],pagesCount:0};if(1===t.comments.length&&t.pagesCount>=1){for(let e=t.pagesCount-1;e>=0;e--)e!==D&&s.removeCache(`post-${_}-comments-${e}`);return S(`/post/${_}?page=${+D-1}`),{pagesCount:0,comments:[]}}return{...t,comments:t.comments.filter((s=>s._id!==e._id))}}if(O){return(s.state||[]).filter((s=>s._id!==e._id))}}const t=await h.post(`/admin/${U}/update`,{id:p,isHidden:"hidde"===e},{Authorization:`Bearer ${j.getOne("PR_TOKEN")}`});if(L){const e=s.state||{pagesCount:0,comments:[]};return{...e,comments:e.comments.map((e=>e._id===t._id?{...e,...t}:e))}}return(s.state||[]).map((e=>e._id===t._id?t:e))}})},B=w.getDifference(c).getSortDate({year:"[year] year [month] months ago!",month:"[month] month [day] days ago!",day:"[day] day [hour] hours ago!",hour:"[hour] hour [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsxs("div",{className:`${z.post_header} flex-row-center-space-between-none`,children:[s?t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(E,{styles:{svg:{width:"2rem",height:"2rem"},img:{width:"2rem",height:"2rem"}},src:s?.avatar,alt:s?.name||"User avatar"}),t.jsxs("div",{className:z.post_author,children:[t.jsx(n,{to:`/user/${s?._id}`,children:s?.name}),t.jsx("p",{className:z.post_create_date,children:B})]})]}):t.jsxs("div",{className:`${z.post_header_author_not_defined} flex-row-center-normal-medium`,children:[t.jsx(o,{}),t.jsx("p",{children:"Author is possibly deleted!"})]}),k&&!H?t.jsxs("button",{className:z.post_action_button,children:[t.jsx("svg",{viewBox:"0 0 128 512",children:t.jsx("path",{d:"M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"})}),t.jsxs("ul",{className:`${z.post_action_container} flex-column-normal-normal-none`,children:[t.jsxs("li",{onClick:()=>R("remove"),className:"flex-row-center-normal-medium",children:[t.jsx(r,{}),t.jsx("p",{children:"Remove"})]}),t.jsxs("li",{onClick:()=>R("edit"),className:"flex-row-center-normal-medium",children:[t.jsx(i,{}),t.jsx("p",{children:"Edit"})]}),t.jsxs("li",{onClick:()=>R(C?"show":"hidde"),className:"flex-row-center-normal-medium",children:[C?t.jsx(l,{}):t.jsx(d,{}),t.jsx("p",{children:C?"Show":"Hidden"})]})]})]}):null]})}const K={post_wrapper_container:"ne",post_is_hidden:"oe"};function M({children:e,className:s}){return t.jsxs("section",{className:`${K.post_wrapper_container} ${s} main-content-container`,children:[s?t.jsxs("div",{className:`${K.post_is_hidden} flex-row-center-center-medium`,children:[t.jsx(d,{}),t.jsx("p",{children:"Hidden"})]}):null,t.jsx("div",{style:{padding:"1rem"},children:e})]})}const q={post_tags:"te"};function F({tags:e}){return t.jsx("div",{className:`${q.post_tags} flex-row-normal-normal-medium`,children:e.map((e=>e.trim()?t.jsx(n,{to:`/search?tag=${e}`,children:e},e):null))})}function G({post:s,type:o}){const{id:r}=c(),{pathname:i}=a(),d=e(),_=O(),u=x(),g=v(),f=i.search("/post")>-1,N="/"===i,C=s.likedBy.includes(_.user?._id||""),T=g.role(["Creator"]).equal("_id",s?.author?._id).permited(),b=g.role(["Admin"]).permited(),S=s.isHidden,A="preview"===o||"post"===o?s._id:r,I="comment"===o?parseInt(u.get("page")||"0"):0,P=S&&b||T&&S?R.post_hidden:"",k="post"===o?`post-${s._id}`:`post-${A}-comments-${I}`,{mutate:E}=y(k);S&&f&&!b&&!T&&"post"===o&&d("/");const H=e=>{u.set({[$["STATISTIC-TO-CHECK"]]:e,[$["STATISTIC-PREVIEW-POST-ID"]]:s._id,[$["LIST-PAGE"]]:0})},U=w.getDifference(s.createdAt).getSortDate({year:"[year] years [month] months ago!",month:"[month] months [day] days ago!",day:"[day] days [hour] hours ago!",hour:"[hour] hours [minute] minutes ago!",minute:"[minute] minutes [second] seconds ago!",second:"[second] seconds ago!"});return t.jsx(t.Fragment,{children:N&&!T&&!b&&S?null:t.jsxs(M,{className:P,children:["comment"===o||"preview"===o?t.jsx(B,{tags:s.tags||[],title:s.title||"",content:s.content,isHidden:s.isHidden,postID:A,contentID:s._id,type:o,createdAt:s.createdAt,user:s?.author}):null,"post"===o?t.jsxs("div",{className:R.post_content_container,children:[t.jsx("h4",{className:R.post_title,children:s.title}),t.jsx("p",{className:R.post_content_date,children:U}),t.jsx(L,{content:s.content})]}):null,"preview"===o?t.jsxs("div",{className:R.post_content_container,children:[t.jsx(n,{to:`/post/${s._id}`,children:s.title}),t.jsx(L,{className:R.post_short_view,content:s.content.slice(0,450)})]}):null,"comment"===o?t.jsx("div",{className:R.post_data,children:t.jsx(L,{content:s.content})}):null,t.jsxs("div",{className:`${R.post_tags_statistic_container} flex-row-center-space-between-medium`,children:["post"!==o&&"preview"!==o||!s.tags?null:t.jsx(F,{tags:s.tags}),t.jsxs("div",{className:"flex-row-center-normal-big",children:["preview"===o?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:`${R.post_statistic_data} flex-row-center-normal-small`,onClick:N?()=>H("views"):void 0,children:[t.jsx(l,{}),s.viewedBy?.length]}),t.jsxs("p",{className:`${R.post_statistic_data} flex-row-center-normal-small`,onClick:N?()=>H("comments"):void 0,children:[t.jsx(m,{}),s.comments?.length]}),t.jsxs("p",{className:`${R.post_statistic_data} flex-row-center-normal-small`,onClick:N?()=>H("likes"):void 0,children:[t.jsx(p,{}),s.likedBy?.length]})]}):null,"comment"!==o&&"post"!==o||!_.user?null:t.jsxs("button",{onClick:async()=>{s.isHidden&&!_.user||E((async e=>{const t=await h.get(`/${o}/${s._id}/like`,{Authorization:`Bearer ${j.getOne("PR_TOKEN")}`});if("post"===o)return t;const a=e.state,n=a.comments||[];return{...a,comments:n.map((e=>e._id===t._id?t:e))}}))},className:`${C?R.post_liked:""} ${R.post_statistic_data} flex-row-center-normal-small`,children:[t.jsx(p,{}),s.likedBy.length]})]})]})]})})}const V={preview_container:"f_",preview_body:"g_",preview_header:"h_",preview_item:"i_",preview_item_count:"j_"},W={pagintion_list_button:"de",loader:"ee"};function J(){return t.jsxs("div",{style:{width:"100%"},className:"flex-row-normal-space-between-medium",children:[t.jsx("div",{className:W.pagintion_list_button}),t.jsxs("div",{className:"flex-row-normal-normal-small",children:[t.jsx("div",{className:W.pagintion_list_button}),t.jsx("div",{className:W.pagintion_list_button}),t.jsx("div",{className:W.pagintion_list_button})]}),t.jsx("div",{className:W.pagintion_list_button})]})}const Y={preview_loader:"Zc",loader:"_e"};function Z(){return t.jsxs("div",{style:{paddingTop:"1rem"},className:"flex-column-normal-normal-medium",children:[t.jsx("div",{className:Y.preview_loader}),t.jsx("div",{className:Y.preview_loader}),t.jsx("div",{className:Y.preview_loader}),t.jsx("div",{className:Y.preview_loader}),t.jsx("div",{className:Y.preview_loader}),t.jsx("div",{className:Y.preview_loader})]})}const Q={formatNum:function(e){return e>9?e:`0${e}`}},X={views:t.jsx(l,{}),likes:t.jsx(p,{}),comments:t.jsx(m,{})},ee={views:"No body have viewed!",likes:"No body have liked!",comments:"No body have commented!"};function se({statisticToPreview:e}){const s=x(),a=s.get($["STATISTIC-PREVIEW-POST-ID"]),o=parseInt(s.get($["LIST-PAGE"])||"0"),{data:r,prev:i,isPending:l,error:d}=g({deps:[`preview-${e}-${a}-${o}`],prev:[`preview-${e}-${a}-${0===o?0:o-1}`],request:async()=>h.get(`/post/preview/${e}/${a}/${o}`)}),c=i?.pagesCount||r?.pagesCount||0;return t.jsx("section",{className:V.preview_container,children:t.jsxs("div",{className:`${V.preview_body} main-content-container`,children:[t.jsxs("div",{className:`${V.preview_header} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[X[e],t.jsx("h4",{className:V.preview_type,children:N.firstLetterToUpperCase(e||"")})]}),t.jsx(_,{onClick:()=>{s.remove([$["STATISTIC-TO-CHECK"],$["STATISTIC-PREVIEW-POST-ID"],$["LIST-PAGE"]])}})]}),l?t.jsx(J,{}):c>1?t.jsx(C,{pagesCount:c}):null,l?t.jsx(Z,{}):t.jsx("div",{style:{paddingTop:c>1?"0.5rem":"0rem"},className:V.preview_item_count_list,children:d?t.jsx(T,{error:d.message}):0!==r?.items?.length&&r?r.items.map((e=>t.jsxs(n,{to:`/user/${e._id}`,className:`${V.preview_item} flex-row-center-space-between-none`,children:[t.jsxs("div",{className:"flex-row-center-normal-medium",children:[t.jsx(E,{src:e.avatar,alt:e.name}),t.jsx("p",{children:e.name})]}),t.jsx("p",{className:V.preview_item_count,children:Q.formatNum(e.count)})]},200*Math.random()))):t.jsx(b,{option:{size:"SMALL"},label:ee[e]})})]})})}const te=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const[e,a]=s.useState(10),n=x().get($["STATISTIC-TO-CHECK"]),{mutate:o,...r}=y("all-posts"),{isFetching:i,isMutating:l,data:d,error:c}=g({deps:["all-posts"],request:async()=>await h.get(`/home/${e}`,S)});return t.jsxs(s.Fragment,{children:[l&&t.jsx(A,{}),t.jsxs("div",{style:{height:"100%"},className:"flex-row-normal-normal-medium",children:[t.jsx("div",{style:{flexGrow:1},className:"flex-column-normal-normal-small",children:i?t.jsx(D,{}):c?t.jsx(I,{error:c}):d&&0===d.length?t.jsx(b,{option:{flexCenterCenter:!0},label:"No post would founded!"}):d&&t.jsxs(s.Fragment,{children:[d.map((e=>t.jsx(G,{post:e,type:"preview"},e._id))),r.error&&t.jsx(T,{error:r.error.message}),d.length%10==0?t.jsx("div",{className:"flex-row-center-center-none",children:t.jsx(P,{onClick:async()=>{const s=e+10;a((e=>e+10)),await o((async()=>await h.get(`/home/${s}`))),i||l||setTimeout((()=>window.scrollTo({behavior:"smooth",top:document.body.scrollHeight})),100)},label:"Load More"})}):null]})}),n&&t.jsx(se,{statisticToPreview:n})]})]})}},Symbol.toStringTag,{value:"Module"}));export{D as L,U as P,G as a,te as p,O as u};
