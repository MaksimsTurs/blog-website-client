import{j as e,r as t,J as n,K as r,Q as s,R as o,F as a,E as i,X as c,V as l,G as u,c as d,I as h,N as p}from"../react.js";import{l as m,f,U as x,u as y,e as b,M as g,T as j,i as _,a as w,b as v,_ as $,F as C,c as N}from"./admin.js";import{c as D,C as E,b as k,u as K,B as L}from"./home.js";import{u as P}from"./galery.js";import{T as S}from"./search.js";import{c as H}from"./website-settings.js";const I=H({name:"creator",initialState:{contentDraft:m.get("content-draft","[]")},reducers:{editOrinsertContentDraft:(e,{payload:t})=>{if(0===e.contentDraft.length)return m.set("content-draft",e.contentDraft=[t]);e.contentDraft.find(((e,n)=>e._id===t._id?{_id:e._id,index:n}:void 0))?m.set("content-draft",e.contentDraft=e.contentDraft.map((e=>e._id===t._id?t:e))):m.set("content-draft",e.contentDraft=[...e.contentDraft,t])},removeContentDraft:(e,{payload:t})=>{0!==e.contentDraft.length&&m.set("content-draft",e.contentDraft=e.contentDraft.filter((e=>e._id!==t)))}}}),{editOrinsertContentDraft:O,removeContentDraft:A}=I.actions,T=I.reducer,R={write_new_loader_container:"w",write_new_loader_body:"x",loader:"y",write_new_loader_input:"z"};function U(){return e.jsx("div",{className:`${R.write_new_loader_container} flex-row-normal-center-medium`,children:e.jsxs("div",{className:`${R.write_new_loader_body} flex-column-normal-normal-small`,children:[e.jsx("div",{className:R.write_new_loader_input}),e.jsx("div",{className:R.write_new_loader_input}),e.jsxs("div",{className:"flex-row-normal-normal-small",children:[e.jsx("button",{}),e.jsx("button",{}),e.jsx("button",{})]}),e.jsx("div",{style:{height:"10rem"},className:R.write_new_loader_input})]})})}const F="O",V="P",M="Q",B="Da",z="Ea",Z="Fa",J="Ga",Y="Ha",q="Ia",G="Ja",Q="Ka";const W={shortCut:{lineEnd:0,lineStart:0,currentHistory:0,shortCutPressedKeys:[],history:[],pushIntoHistory:function(e){10===this.history.length?this.history=[...this.history.slice(1,10),e]:this.currentHistory=this.history.push(e)},KeyL:function(e,t){e.preventDefault();const n=t.current,r=function(e,t){let n=0;for(let r=0;r<e.length;r++)e[r]===t&&n++;return n}(this.shortCutPressedKeys,"KeyL")>1;this.lineStart=n.selectionStart,this.lineEnd=n.value.indexOf("\n",r?n.selectionEnd:n.selectionStart);for(let s=this.lineStart;s>=0;s--)if("\n"===n.value[s]||0===s){this.lineStart=s;break}if(r&&n.selectionEnd!==n.value.length)for(let s=this.lineEnd+1;s<=n.value.length;s++)if("\n"===n.value[s]||s===n.value.length){this.lineEnd=s;break}t.current.selectionStart=this.lineStart,t.current.selectionEnd=this.lineEnd},KeyZ:function(e){return e.preventDefault(),0===this.currentHistory?this.history[0]:(--this.currentHistory,this.history[this.currentHistory])},KeyY:function(e){return e.preventDefault(),10===this.currentHistory?this.history[10]:(++this.currentHistory,this.history[this.currentHistory])}},edit:{wrappKeys:{BOLD:"#",HEADER_1:"##",HEADER_2:"###",LINK:"[Text;Url]"},wrapp:function(e,t,n){const r=t.selectionStart,s=t.selectionEnd,o=e.substring(r,s);return 0===r?"LINK"===n?this.wrappKeys[n]+e.substring(s,e.length):`${this.wrappKeys[n]}${o}${this.wrappKeys[n]}`+e.substring(s,e.length):s===e.length?"LINK"===n?e.substring(s,e.length)+this.wrappKeys[n]:e.substring(0,r)+`${this.wrappKeys[n]}${o}${this.wrappKeys[n]}`:"LINK"===n?e.substring(0,r)+this.wrappKeys[n]+e.substring(s,e.length):e.substring(0,r)+`${this.wrappKeys[n]}${o}${this.wrappKeys[n]}`+e.substring(s,e.length)}}},X=t.memo((function({placeholder:l,defaultValue:u,getValue:d}){const[h,p]=t.useState(u),[m,w]=t.useState(),[v,$]=t.useState(!1),[C,N]=t.useState(),[k,K]=t.useState(),L=t.useRef(),S=t.useRef(null),H=t.useRef(null),I=t.useRef(!1),O=t.useRef(0),A=P(x["IS-UPLOAD-MODAL-OPEN"],H),T=y(),R=t.useCallback((async()=>{const e=function(e){let t={};return e.alt||(t={...t,alt:"Alt is required filed!"}),D.secure.URL(e.url||"")||e.url||e.asset||(t={...t,url:"URL is not valid!"}),(e.url||"")?.length>0&&e.asset&&(t={...t,url:"Url or Data url is defined!"}),t}({alt:/video/g.test(L.current?.type||"")?"placeholder":C,url:k,asset:L.current}),t=S.current.selectionEnd;if(O.current=t,w(e),!(Object.entries(e).filter((e=>e)).length>0)){if(L.current){I.current=!0;const e=new FormData;let r;e.append("file",L.current);try{r=await async function(e){try{return await f.post("/api/upload",e)}catch(t){throw new Error("Error by uploading img!")}}(e)}catch(n){w({"upload-error":m.message}),I.current=!1}if(/video/g.test(L.current?.type||"")){const e=`${h.substring(0,t)}[${r.assetURL}]${h.substring(t,h.length)}`;p(e),d&&d(e)}else{const e=`${h.substring(0,t)}(${C};${r.assetURL})${h.substring(t,h.length)}`;p(e),d&&d(e)}I.current=!1}else{const e=`${h.substring(0,t)}(${C};${k})${h.substring(t,h.length)}`;p(e),d&&d(e)}N(""),K(""),w({}),L.current=void 0,T.remove([x["IS-UPLOAD-MODAL-OPEN"]])}}),[C,k,L]);return t.useEffect((()=>{W.shortCut.pushIntoHistory(u||""),p(u||""),d&&d(u||"")}),[u]),t.useEffect((()=>{document.addEventListener("keydown",(e=>{const t=e.code;e.ctrlKey&&document.activeElement===S.current&&(W.shortCut.shortCutPressedKeys.push(t),"KeyL"===t?W.shortCut.KeyL(e,S):"KeyZ"===t?p(W.shortCut.KeyZ(e)):"KeyY"===t&&p(W.shortCut.KeyY(e)))})),document.addEventListener("keyup",(e=>{"ControlLeft"===e.code&&(W.shortCut.lineStart=0,W.shortCut.lineEnd=0,W.shortCut.shortCutPressedKeys=[])}))}),[]),e.jsxs(t.Fragment,{children:[I.current?e.jsx(b,{}):null,e.jsx(g,{error:m?.["upload-error"]}),e.jsxs("section",{className:G,children:[e.jsx("button",{disabled:v,onClick:()=>{const e=W.edit.wrapp(h,S.current,"BOLD");p(e),W.shortCut.pushIntoHistory(e),d&&d(e)},type:"button",className:`${Q} flex-row-center-center-none`,children:e.jsx(n,{})}),e.jsx("button",{disabled:v,onClick:()=>{const e=W.edit.wrapp(h,S.current,"HEADER_1");p(e),W.shortCut.pushIntoHistory(e),d&&d(e)},type:"button",className:`${Q} flex-row-center-center-none`,children:e.jsx(r,{})}),e.jsx("button",{disabled:v,onClick:()=>{const e=W.edit.wrapp(h,S.current,"HEADER_2");p(e),W.shortCut.pushIntoHistory(e),d&&d(e)},type:"button",className:`${Q} flex-row-center-center-none`,children:e.jsx(s,{})}),e.jsx("button",{disabled:v,onClick:()=>{const e=W.edit.wrapp(h,S.current,"LINK");p(e),W.shortCut.pushIntoHistory(e),d&&d(e)},type:"button",className:`${Q} flex-row-center-center-none`,children:e.jsx(o,{})}),e.jsx("button",{disabled:v,onClick:()=>{T.set({[x["IS-UPLOAD-MODAL-OPEN"]]:!0})},type:"button",className:`${Q} flex-row-center-center-none`,children:e.jsx(a,{})}),e.jsx("button",{onClick:()=>{$((e=>!e))},type:"button",className:`${Q} flex-row-center-center-none`,children:e.jsx(i,{})})]}),e.jsxs("div",{className:Y,children:[e.jsx("div",{ref:H,className:A?`${B} flex-row-center-center-none`:`${B} ${J} flex-row-center-center-none`,children:e.jsxs("div",{className:`${z} main-content-container flex-column-normal-normal-small`,children:[e.jsxs("div",{className:`${Z} flex-row-normal-space-between-medium`,children:[e.jsx("p",{children:"Upload File"}),e.jsx(c,{onClick:()=>{N(""),K(void 0),w({}),T.remove([x["IS-UPLOAD-MODAL-OPEN"]]),L.current=void 0,d&&d(h)}})]}),e.jsx(j,{errors:m,onInput:e=>{K(e.currentTarget.value)},defaultValue:k||"",name:"url",type:"text",placeholder:"Put you img URL here!"}),e.jsx(j,{errors:m,onInput:e=>{N(e.currentTarget.value)},defaultValue:C||"",name:"alt",type:"text",placeholder:"Put img Alt attributte here!"}),e.jsx(_,{label:"Upload img!",name:"uploadImg",asset:L,initValue:k}),e.jsx("button",{disabled:I.current,type:"button",onClick:R,children:"Add Link"})]})}),e.jsx("div",{children:v?e.jsx(E,{content:h}):e.jsx("textarea",{className:q,placeholder:l,spellCheck:!1,onChange:e=>{O.current=e.currentTarget.selectionEnd,p(e.currentTarget.value),W.shortCut.pushIntoHistory(e.currentTarget.value),d&&d(e.currentTarget.value)},ref:S,value:h,rows:(h?.split(/\n/)?.length||0)+1})})]})]})})),ee={checkbox_default_input:"Za",checkbox_body:"_c",checkbox_custom_checkbox_wrapper:"-c",checkbox_custom_checkbox_body:"ac"};function te({defaultValue:t,label:n,name:r}){return e.jsx("div",{style:{width:"100%"},className:"flex-row-center-normal-none",children:e.jsxs("label",{className:`${ee.checkbox_body} flex-row-center-normal-medium`,children:[e.jsx("input",{tabIndex:-1,name:r,className:ee.checkbox_default_input,type:"checkbox",defaultChecked:t}),e.jsxs("div",{className:ee.checkbox_custom_checkbox_wrapper,children:[e.jsx("p",{className:ee.checkbox_custom_checkbox_body}),e.jsx(l,{})]}),n]})})}const ne=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const n=u(),r=d(),s=h((e=>e.creator)),o=y(),a=k(),{submit:i}=w([]),c=v(),l=o.get("content-id"),x=o.get("draft-id"),_=JSON.parse(o.get("is-edit")||"false");if(!c.role(["Admin","Creator"]).permited())return e.jsx(p,{to:"/"});const D=_&&l?m.get(l,"null"):x?s.contentDraft.find((e=>e._id===x)):void 0,E="post"===D?.contentType;K({title:_&&D?`${E?D.title:"Comment"} ändern`:x&&D?`${E?D.title:"Entwurf"} ändern`:"Neue post schreiben",description:"Hier kannst neue post oder entwurfe schreiben oder ändern."});const P=D?.isFromAdmin?[]:"comment"===D?.contentType?[`post-${D.onPost}-comments-${D.onPage}`]:["all-posts"],{mutate:H,isMutating:I,error:T}=$({deps:P}),R=T||(_&&!D?{code:404,message:"Content not found!"}:void 0),B=t.useRef(D?.tags||[]),z=t.useRef("");return e.jsxs(t.Fragment,{children:[R?e.jsx(g,{error:R}):null,I?e.jsx(b,{}):null,a.isAuthPending?e.jsx(U,{}):e.jsx("div",{className:`${F} flex-row-normal-center-big`,children:e.jsxs(C,{className:V,onSubmit:i((async e=>{delete e.alt,delete e.uploadImg,delete e.url,H({key:P,request:async function(t){if(_){const n=await f.post(`/admin/${D?.contentType}/update`,{...e,content:z.current,tags:B.current,id:l},{Authorization:`Bearer ${N.getOne("PR_TOKEN")}`});if(m.remove(n._id),"post"===D?.contentType){const e=t.state||[];t.removeCache(`/post-${n._id}`);for(let n=(D?.onPage||0)+1;n>=0;n--)t.removeCache(`${D.contentType}-${n}`);return D.isFromAdmin?r(`/admin/${D.contentType}`):r(`/post/${n._id}`),e.map((e=>e._id===n._id?n:e))}if("comment"===D?.contentType){const e=t.state||{pagesCount:0,comments:[]};return D.isFromAdmin?void r("/admin"):(r(`/post/${D?.onPost}?page=${D?.onPage}`),{...e,comments:e.comments.map((e=>e._id===n._id?n:e))})}}const n=await f.post("/insert/post",{...e,content:z.current,tags:B.current},{Authorization:`Bearer ${a?.user?.token}`}),s=t.state||[];return r(`/post/${n._id}`),[...s||[],n]}})})),isPending:!1,children:["comment"!==D?.contentType?e.jsxs(t.Fragment,{children:[e.jsx(j,{name:"title",defaultValue:D?.title,placeholder:"Post title"}),e.jsx(te,{name:"isHidden",label:"Hidde post",defaultValue:D?.isHidden}),e.jsx(S,{getTags:e=>{B.current=e},placeholder:"Post tags",value:B.current})]}):null,e.jsx(X,{defaultValue:D?.content,placeholder:"Write content body here...",getValue:e=>{z.current=e}}),e.jsxs("div",{className:M,children:[e.jsx(L,{label:_?`Edit ${D?.contentType}`:"Create post",type:"submit"}),e.jsx(L,{label:D&&!l?"Save draft changes":"Save as draft",onClick:()=>{const e=x||l||window.crypto.randomUUID();n(O({...D,_id:e,content:z.current})),o.set({"draft-id":e}),o.remove(["content-id"]),m.remove(l)}}),e.jsx(L,{label:"Delete draft",onClick:()=>{n(A(x||l)),o.remove(["draft-id"])}})]})]})})]})}},Symbol.toStringTag,{value:"Module"}));export{U as W,T as c,ne as p};
