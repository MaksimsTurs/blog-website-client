import{j as e,r as t,I as n,J as r,K as s,F as o,E as a,Q as c,D as l,c as i,G as d,N as u}from"../react.js";import{l as m,f as p,u as f,d as x,M as h,T as b,i as g,h as j,a as _,_ as v,F as y,c as w}from"./admin.js";import{c as $,C as k,b as N,u as C,B as T}from"./home.js";import{T as D}from"./search.js";import{c as S}from"./website-settings.js";const E=S({name:"creator",initialState:{contentDraft:m.get("content-draft","[]")},reducers:{editOrinsertContentDraft:(e,{payload:t})=>{if(0===e.contentDraft.length)return m.set("content-draft",e.contentDraft=[t]);e.contentDraft.find(((e,n)=>e._id===t._id?{_id:e._id,index:n}:void 0))?m.set("content-draft",e.contentDraft=e.contentDraft.map((e=>e._id===t._id?t:e))):m.set("content-draft",e.contentDraft=[...e.contentDraft,t])},removeContentDraft:(e,{payload:t})=>{0!==e.contentDraft.length&&m.set("content-draft",e.contentDraft=e.contentDraft.filter((e=>e._id!==t)))}}}),{editOrinsertContentDraft:L,removeContentDraft:R}=E.actions,P=E.reducer,A={write_new_loader_container:"t",write_new_loader_body:"u",loader:"v",write_new_loader_input:"w"};function O(){return e.jsx("div",{className:`${A.write_new_loader_container} flex-row-normal-center-medium`,children:e.jsxs("div",{className:`${A.write_new_loader_body} flex-column-normal-normal-small`,children:[e.jsx("div",{className:A.write_new_loader_input}),e.jsx("div",{className:A.write_new_loader_input}),e.jsxs("div",{className:"flex-row-normal-normal-small",children:[e.jsx("button",{}),e.jsx("button",{}),e.jsx("button",{})]}),e.jsx("div",{style:{height:"10rem"},className:A.write_new_loader_input})]})})}const U="T",V="U",I="V",F="wc",K="xc",z="yc",B="zc",H="Ac",J="Bc",M="Cc";const q=t.memo((function({placeholder:c,defaultValue:l,getValue:i}){const[d,u]=t.useState(l),[j,_]=t.useState(),[v,y]=t.useState(),[w,N]=t.useState(),C=t.useRef(),T=t.useRef(null),D=t.useRef(!1),S=t.useRef(0),E=f(),L=JSON.parse(E.get("is-open")||"false"),R=JSON.parse(E.get("is-preview")||"false"),P=t.useCallback((async()=>{const e=function(e){let t={};return e.alt||(t={...t,alt:"Alt is required filed!"}),$.secure.URL(e.url||"")||e.url||e.asset||(t={...t,url:"URL is not valid!"}),(e.url||"")?.length>0&&e.asset&&(t={...t,url:"Url or Data url is defined!"}),t}({alt:/video/g.test(C.current?.type||"")?"placeholder":v,url:w,asset:C.current}),t=T.current.selectionEnd;if(S.current=t,_(e),!(Object.entries(e).filter((e=>e)).length>0)){if(C.current){D.current=!0;const e=new FormData;let r;e.append("file",C.current);try{r=await async function(e){try{return await p.post("/api/upload",e)}catch(t){throw new Error("Error by uploading img!")}}(e)}catch(n){_({"upload-error":j.message}),D.current=!1}if(/video/g.test(C.current?.type||"")){const e=`${d.substring(0,t)}[${r.assetURL}]${d.substring(t,d.length)}`;u(e),i&&i(e)}else{const e=`${d.substring(0,t)}(${v};${r.assetURL})${d.substring(t,d.length)}`;u(e),i&&i(e)}D.current=!1}else{const e=`${d.substring(0,t)}(${v};${w})${d.substring(t,d.length)}`;u(e),i&&i(e)}y(""),N(""),_({}),C.current=void 0,E.set({"is-open":!1})}}),[v,w,C]);return t.useEffect((()=>{u(l||""),i&&i(l||"")}),[l]),t.useEffect((()=>{let e=[],t=0,n=0;const r={KeyL:function(r){r.preventDefault();const s=function(e,t){let n=0;for(let r=0;r<e.length;r++)e[r]===t&&n++;return n}(e,"KeyL")>1;t=T.current.selectionStart,n=T.current.value.indexOf("\n",s?T.current.selectionEnd:T.current.selectionStart);for(let e=t;e>=0;e--)if("\n"===T.current.value[e]||0===e){t=e;break}if(s)for(let e=n+1;e<d.length;e++)if("\n"===T.current.value[e]||e===d.length){n=e;break}T.current.selectionStart=t,T.current.selectionEnd=n}};document.addEventListener("keydown",(t=>{t.ctrlKey&&document.activeElement===T.current&&r?.[t.code]&&(e.push(t.code),r[t.code](t))})),document.addEventListener("keyup",(r=>{"ControlLeft"===r.code&&(e=[],t=0,n=0)}))}),[]),e.jsxs(t.Fragment,{children:[D.current?e.jsx(x,{}):null,e.jsx(h,{error:j?.["upload-error"]}),e.jsxs("section",{className:J,children:[e.jsx("button",{disabled:R,onClick:()=>{const e=T.current.selectionStart,t=T.current.selectionEnd;S.current=t;const n=d.substring(e,t),r=d.replace(n,`#${n}#`);u(r),i&&i(r)},type:"button",className:`${M} flex-row-center-center-none`,children:e.jsx(n,{})}),e.jsx("button",{disabled:R,onClick:()=>{const e=T.current.selectionStart,t=T.current.selectionEnd;S.current=t;const n=d.substring(e,t),r=d.replace(n,`##${n}##`);u(r),i&&i(r)},type:"button",className:`${M} flex-row-center-center-none`,children:e.jsx(r,{})}),e.jsx("button",{disabled:R,onClick:()=>{const e=T.current.selectionEnd;S.current=e;const t=`${d.substring(0,e)}[LINK STRING;LINK URL]${d.substring(e,d.length)}`;u(t),i&&i(t)},type:"button",className:`${M} flex-row-center-center-none`,children:e.jsx(s,{})}),e.jsx("button",{disabled:R,onClick:()=>{E.set({"is-open":!0})},type:"button",className:`${M} flex-row-center-center-none`,children:e.jsx(o,{})}),e.jsx("button",{onClick:()=>R?(m.set("scroll-position",document.body.scrollTop),E.remove(["is-preview"])):(document.body.scrollTo({top:m.get("scroll-position","0")}),E.set({"is-preview":!0})),type:"button",className:`${M} flex-row-center-center-none`,children:e.jsx(a,{})})]}),e.jsxs("div",{className:B,children:[e.jsx("div",{className:L?`${F} flex-row-center-center-none`:`${F} ${z} flex-row-center-center-none`,children:e.jsxs("div",{className:`${K} main-content-container flex-column-normal-normal-small`,children:[e.jsx(b,{errors:j,onInput:e=>{N(e.currentTarget.value)},defaultValue:w||"",name:"url",type:"text",placeholder:"Put you img URL here!"}),e.jsx(b,{errors:j,onInput:e=>{y(e.currentTarget.value)},defaultValue:v||"",name:"alt",type:"text",placeholder:"Put img Alt attributte here!"}),e.jsx(g,{label:"Upload img!",name:"uploadImg",asset:C,initValue:w}),e.jsx("button",{disabled:D.current,type:"button",onClick:P,children:"Add Link"}),e.jsx("button",{type:"button",onClick:()=>{y(""),N(void 0),_({}),E.set({"is-open":!1}),C.current=void 0,i&&i(d)},children:"Stop"})]})}),e.jsx("div",{children:R?e.jsx(k,{content:d}):e.jsx("textarea",{className:H,placeholder:c,spellCheck:!1,onChange:e=>{S.current=e.currentTarget.selectionEnd,u(e.currentTarget.value),i&&i(e.currentTarget.value)},ref:T,value:d,rows:(d?.split(/\n/)?.length||0)+1})})]})]})})),G={checkbox_default_input:"rc",checkbox_body:"sc",checkbox_custom_checkbox_wrapper:"tc",checkbox_custom_checkbox_body:"uc"};function W({defaultValue:t,label:n,name:r}){return e.jsx("div",{style:{width:"100%"},className:"flex-row-center-normal-none",children:e.jsxs("label",{className:`${G.checkbox_body} flex-row-center-normal-medium`,children:[e.jsx("input",{tabIndex:-1,name:r,className:G.checkbox_default_input,type:"checkbox",defaultChecked:t}),e.jsxs("div",{className:G.checkbox_custom_checkbox_wrapper,children:[e.jsx("p",{className:G.checkbox_custom_checkbox_body}),e.jsx(c,{})]}),n]})})}const Q=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const n=l(),r=i(),s=d((e=>e.creator)),o=f(),a=N(),{submit:c}=j([]),g=_(),$=o.get("content-id"),k=o.get("draft-id"),S=JSON.parse(o.get("is-edit")||"false");if(!g.role(["Admin","Creator"]).permited())return e.jsx(u,{to:"/"});const E=S&&$?m.get($,"null"):k?s.contentDraft.find((e=>e._id===k)):void 0,P="post"===E?.contentType;C({title:S&&E?`${P?E.title:"Comment"} ändern`:k&&E?`${P?E.title:"Entwurf"} ändern`:"Neue post schreiben",description:"Hier kannst neue post oder entwurfe schreiben oder ändern."});const A=E?.isFromAdmin?[]:"comment"===E?.contentType?[`post-${E.onPost}-comments-${E.onPage}`]:["all-posts"],{mutate:F,isMutating:K,error:z}=v({deps:A}),B=z||(S&&!E?{code:404,message:"Content not found!"}:void 0),H=t.useRef(E?.tags||[]),J=t.useRef("");return e.jsxs(t.Fragment,{children:[B?e.jsx(h,{error:B}):null,K?e.jsx(x,{}):null,a.isAuthPending?e.jsx(O,{}):e.jsx("div",{className:`${U} flex-row-normal-center-big`,children:e.jsxs(y,{className:V,onSubmit:c((async e=>{delete e.alt,delete e.uploadImg,delete e.url,F({key:A,request:async function(t){if(S){const n=await p.post(`/admin/${E?.contentType}/update`,{...e,content:J.current,tags:H.current,id:$},{Authorization:`Bearer ${w.getOne("PR_TOKEN")}`});if(m.remove(n._id),"post"===E?.contentType){const e=t.state||[];t.removeCache(`/post-${n._id}`);for(let n=(E?.onPage||0)+1;n>=0;n--)t.removeCache(`${E.contentType}-${n}`);return E.isFromAdmin?r(`/admin/${E.contentType}`):r(`/post/${n._id}`),e.map((e=>e._id===n._id?n:e))}if("comment"===E?.contentType){const e=t.state||{pagesCount:0,comments:[]};return E.isFromAdmin?void r("/admin"):(r(`/post/${E?.onPost}?page=${E?.onPage}`),{...e,comments:e.comments.map((e=>e._id===n._id?n:e))})}}const n=await p.post("/insert/post",{...e,content:J.current,tags:H.current},{Authorization:`Bearer ${a?.user?.token}`}),s=t.state||[];return r(`/post/${n._id}`),[...s||[],n]}})})),isPending:!1,children:["comment"!==E?.contentType?e.jsxs(t.Fragment,{children:[e.jsx(b,{name:"title",defaultValue:E?.title,placeholder:"Post title"}),e.jsx(D,{getTags:e=>{H.current=e},placeholder:"Post tags",value:H.current}),e.jsx(W,{name:"isHidden",label:"Hidde post",defaultValue:E?.isHidden})]}):null,e.jsx(q,{defaultValue:E?.content,placeholder:"Write content body here...",getValue:e=>{J.current=e}}),e.jsxs("div",{className:I,children:[e.jsx(T,{label:S?`Edit ${E?.contentType}`:"Create post",type:"submit"}),e.jsx(T,{label:E&&!$?"Save draft changes":"Save as draft",onClick:()=>{const e=k||$||window.crypto.randomUUID();n(L({...E,_id:e,content:J.current})),o.set({"draft-id":e}),o.remove(["content-id"]),m.remove($)}}),e.jsx(T,{label:"Delete draft",onClick:()=>{n(R(k||$)),o.remove(["draft-id"])}})]})]})})]})}},Symbol.toStringTag,{value:"Module"}));export{O as W,P as c,Q as p};
