import{j as e,r as t,y as n,z as r,D as s,F as a,E as o,G as c,w as l,c as i,x as d,N as u}from"../react.js";import{l as m,j as p,f,u as x,M as b,k as h,T as g,h as j,C as _,g as w,a as y,_ as v,F as $,c as N}from"./admin.js";import{T as k}from"./search.js";import{b as C,u as T,B as D}from"./home.js";import{c as S}from"./website-settings.js";const R=S({name:"creator",initialState:{contentDraft:m.get("content-draft","[]")},reducers:{editOrinsertContentDraft:(e,{payload:t})=>{if(0===e.contentDraft.length)return m.set("content-draft",e.contentDraft=[t]);e.contentDraft.find(((e,n)=>e._id===t._id?{_id:e._id,index:n}:void 0))?m.set("content-draft",e.contentDraft=e.contentDraft.map((e=>e._id===t._id?t:e))):m.set("content-draft",e.contentDraft=[...e.contentDraft,t])},removeContentDraft:(e,{payload:t})=>{0!==e.contentDraft.length&&m.set("content-draft",e.contentDraft=e.contentDraft.filter((e=>e._id!==t)))}}}),{editOrinsertContentDraft:P,removeContentDraft:E}=R.actions,O=R.reducer,U={write_new_loader_container:"W",write_new_loader_body:"X",loader:"Y",write_new_loader_input:"Z"};function V(){return e.jsx("div",{className:`${U.write_new_loader_container} flex-row-normal-center-medium`,children:e.jsxs("div",{className:`${U.write_new_loader_body} flex-column-normal-normal-small`,children:[e.jsx("div",{className:U.write_new_loader_input}),e.jsx("div",{className:U.write_new_loader_input}),e.jsxs("div",{className:"flex-row-normal-normal-small",children:[e.jsx("button",{}),e.jsx("button",{}),e.jsx("button",{})]}),e.jsx("div",{style:{height:"10rem"},className:U.write_new_loader_input})]})})}const A="I",I="J",F="K",L="Ta",z="Ua",H="Va",J="Wa",K="Xa",W="Ya",B="Za";const M=t.memo((function({placeholder:c,defaultValue:l,getValue:i}){const[d,u]=t.useState(l),[w,y]=t.useState(),[v,$]=t.useState(),[N,k]=t.useState(),C=t.useRef(),T=t.useRef(null),D=t.useRef(!1),S=t.useRef(0),R=x(),P=JSON.parse(R.get("is-open")||"false"),E=JSON.parse(R.get("is-preview")||"false"),O=t.useCallback((async()=>{const e=function(e){let t={};return e.alt||(t={...t,alt:"Alt is required filed!"}),p.is.secureURL(e.url||"")||e.url||e.asset||(t={...t,url:"URL is not valid!"}),(e.url||"")?.length>0&&e.asset&&(t={...t,url:"Url or Data url is defined!"}),t}({alt:/video/g.test(C.current?.type||"")?"placeholder":v,url:N,asset:C.current}),t=T.current.selectionEnd;if(S.current=t,y(e),!(Object.entries(e).filter((e=>e)).length>0)){if(C.current){D.current=!0;const e=new FormData;let r;e.append("file",C.current);try{r=await async function(e){try{return await f.post("/api/upload",e)}catch(t){throw new Error("Error by uploading img!")}}(e)}catch(n){y({"upload-error":w.message}),D.current=!1}if(/video/g.test(C.current?.type||"")){const e=`${d.substring(0,t)}[${r.assetURL}]${d.substring(t,d.length)}`;u(e),i&&i(e)}else{const e=`${d.substring(0,t)}(${v};${r.assetURL})${d.substring(t,d.length)}`;u(e),i&&i(e)}D.current=!1}else{const e=`${d.substring(0,t)}(${v};${N})${d.substring(t,d.length)}`;u(e),i&&i(e)}$(""),k(""),y({}),C.current=void 0,R.set({"is-open":!1})}}),[v,N,C]);return t.useEffect((()=>{u(l||""),i&&i(l||"")}),[l]),e.jsxs(t.Fragment,{children:[D.current?e.jsx(b,{}):null,e.jsx(h,{error:w?.["upload-error"]}),e.jsxs("section",{className:W,children:[e.jsx("button",{disabled:E,onClick:()=>{const e=T.current.selectionStart,t=T.current.selectionEnd;S.current=t;const n=d.substring(e,t),r=d.replace(n,`#${n}#`);u(r),i&&i(r)},type:"button",className:`${B} flex-row-center-center-none`,children:e.jsx(n,{})}),e.jsx("button",{disabled:E,onClick:()=>{const e=T.current.selectionStart,t=T.current.selectionEnd;S.current=t;const n=d.substring(e,t),r=d.replace(n,`##${n}##`);u(r),i&&i(r)},type:"button",className:`${B} flex-row-center-center-none`,children:e.jsx(r,{})}),e.jsx("button",{disabled:E,onClick:()=>{const e=T.current.selectionEnd;S.current=e;const t=`${d.substring(0,e)}[LINK STRING;LINK URL]${d.substring(e,d.length)}`;u(t),i&&i(t)},type:"button",className:`${B} flex-row-center-center-none`,children:e.jsx(s,{})}),e.jsx("button",{disabled:E,onClick:()=>{R.set({"is-open":!0})},type:"button",className:`${B} flex-row-center-center-none`,children:e.jsx(a,{})}),e.jsx("button",{onClick:()=>E?(m.set("scroll-position",document.body.scrollTop),R.remove(["is-preview"])):(document.body.scrollTo({top:m.get("scroll-position","0")}),R.set({"is-preview":!0})),type:"button",className:`${B} flex-row-center-center-none`,children:e.jsx(o,{})})]}),e.jsxs("div",{className:J,children:[e.jsx("div",{className:P?`${L} flex-row-center-center-none`:`${L} ${H} flex-row-center-center-none`,children:e.jsxs("div",{className:`${z} main-content-container flex-column-normal-normal-small`,children:[e.jsx(g,{errors:w,onInput:e=>{k(e.currentTarget.value)},defaultValue:N||"",name:"url",type:"text",placeholder:"Put you img URL here!"}),e.jsx(g,{errors:w,onInput:e=>{$(e.currentTarget.value)},defaultValue:v||"",name:"alt",type:"text",placeholder:"Put img Alt attributte here!"}),e.jsx(j,{label:"Upload img!",name:"uploadImg",asset:C,initValue:N}),e.jsx("button",{disabled:D.current,type:"button",onClick:O,children:"Add Link"}),e.jsx("button",{type:"button",onClick:()=>{$(""),k(void 0),y({}),R.set({"is-open":!1}),C.current=void 0,i&&i(d)},children:"Stop"})]})}),e.jsx("div",{children:E?e.jsx(_,{content:d}):e.jsx("textarea",{className:K,placeholder:c,spellCheck:!1,onChange:e=>{S.current=e.currentTarget.selectionEnd,u(e.currentTarget.value),i&&i(e.currentTarget.value)},ref:T,value:d,rows:(d?.split(/\n/)?.length||0)+1})})]})]})})),q={checkbox_default_input:"Oa",checkbox_body:"Pa",checkbox_custom_checkbox_wrapper:"Qa",checkbox_custom_checkbox_body:"Ra"};function G({defaultValue:t,label:n,name:r}){return e.jsx("div",{style:{width:"100%"},className:"flex-row-center-normal-none",children:e.jsxs("label",{className:`${q.checkbox_body} flex-row-center-normal-medium`,children:[e.jsx("input",{tabIndex:-1,name:r,className:q.checkbox_default_input,type:"checkbox",defaultChecked:t}),e.jsxs("div",{className:q.checkbox_custom_checkbox_wrapper,children:[e.jsx("p",{className:q.checkbox_custom_checkbox_body}),e.jsx(c,{})]}),n]})})}const X=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const n=l(),r=i(),s=d((e=>e.creator)),a=x(),o=C(),{submit:c}=w([]),p=y(),j=a.get("content-id"),_=a.get("draft-id"),S=JSON.parse(a.get("is-edit")||"false");if(!p.role(["Admin","Creator"]).permited())return e.jsx(u,{to:"/"});const R=S&&j?m.get(j,"null"):_?s.contentDraft.find((e=>e._id===_)):void 0,O="post"===R?.contentType;T({title:S&&R?`${O?R.title:"Comment"} ändern`:_&&R?`${O?R.title:"Entwurf"} ändern`:"Neue post schreiben",description:"Hier kannst neue post oder entwurfe schreiben oder ändern."});const U=R?.isFromAdmin?[]:"comment"===R?.contentType?[`post-${R.onPost}-comments-${R.onPage}`]:["all-posts"],{mutate:L,isMutating:z,error:H}=v({deps:U}),J=H||(S&&!R?{code:404,message:"Content not found!"}:void 0),K=t.useRef(R?.tags||[]),W=t.useRef("");return e.jsxs(t.Fragment,{children:[J?e.jsx(h,{error:J}):null,z?e.jsx(b,{}):null,o.isAuthPending?e.jsx(V,{}):e.jsx("div",{className:`${A} flex-row-normal-center-big`,children:e.jsxs($,{className:I,onSubmit:c((async e=>{delete e.alt,delete e.uploadImg,delete e.url,L({key:U,request:async function(t){if(S){const n=await f.post(`/admin/${R?.contentType}/update`,{...e,content:W.current,tags:K.current,id:j},{Authorization:`Bearer ${N.getOne("PR_TOKEN")}`});if(m.remove(n._id),"post"===R?.contentType){const e=t.state||[];t.removeCache(`/post-${n._id}`);for(let n=(R?.onPage||0)+1;n>=0;n--)t.removeCache(`${R.contentType}-${n}`);return R.isFromAdmin?r(`/admin/${R.contentType}`):r(`/post/${n._id}`),e.map((e=>e._id===n._id?n:e))}if("comment"===R?.contentType){const e=t.state||{pagesCount:0,comments:[]};return R.isFromAdmin?void r("/admin"):(r(`/post/${R?.onPost}?page=${R?.onPage}`),{...e,comments:e.comments.map((e=>e._id===n._id?n:e))})}}const n=await f.post("/insert/post",{...e,content:W.current,tags:K.current},{Authorization:`Bearer ${o?.user?.token}`}),s=t.state||[];return r(`/post/${n._id}`),[...s||[],n]}})})),isPending:!1,children:["comment"!==R?.contentType?e.jsxs(t.Fragment,{children:[e.jsx(g,{name:"title",defaultValue:R?.title,placeholder:"Post title"}),e.jsx(k,{getTags:e=>{K.current=e},placeholder:"Post tags",value:K.current}),e.jsx(G,{name:"isHidden",label:"Hidde post",defaultValue:R?.isHidden})]}):null,e.jsx(M,{defaultValue:R?.content,placeholder:"Write content body here...",getValue:e=>{W.current=e}}),e.jsxs("div",{className:F,children:[e.jsx(D,{label:S?`Edit ${R?.contentType}`:"Create post",type:"submit"}),e.jsx(D,{label:R&&!j?"Save draft changes":"Save as draft",onClick:()=>{const e=_||j||window.crypto.randomUUID();n(P({...R,_id:e,content:W.current})),a.set({"draft-id":e}),a.remove(["content-id"]),m.remove(j)}}),e.jsx(D,{label:"Delete draft",onClick:()=>{n(E(_||j)),a.remove(["draft-id"])}})]})]})})]})}},Symbol.toStringTag,{value:"Module"}));export{V as W,O as c,X as p};
