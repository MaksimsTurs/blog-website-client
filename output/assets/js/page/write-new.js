import{j as e,m as t,d as n,n as r,r as s,N as o}from"../react.js";import{l as a,u as i,d,c,b as l,M as m,e as u,T as f,B as p,L as _,f as j,A as x}from"./admin.js";import{d as g,e as v,T as w}from"./database.js";import{T as h}from"./search.js";import{u as b}from"./about.js";import{u as y}from"./home.js";const D=g({name:"creator",initialState:{contentDraft:a.get("content-draft","[]")},reducers:{editOrinsertContentDraft:(e,{payload:t})=>{if(0===e.contentDraft.length)return a.set("content-draft",e.contentDraft=[t]);e.contentDraft.find(((e,n)=>e._id===t._id?{_id:e._id,index:n}:void 0))?a.set("content-draft",e.contentDraft=e.contentDraft.map((e=>e._id===t._id?t:e))):a.set("content-draft",e.contentDraft=[...e.contentDraft,t])},removeContentDraft:(e,{payload:t})=>{0!==e.contentDraft.length&&a.set("content-draft",e.contentDraft=e.contentDraft.filter((e=>e._id!==t)))}}}),{editOrinsertContentDraft:$,removeContentDraft:T}=D.actions,C=D.reducer,N={write_new_loader_container:"w",write_new_loader_body:"x",loader:"y",write_new_loader_input:"z"};function P(){return e.jsx("div",{className:`${N.write_new_loader_container} flex-row-normal-center-medium`,children:e.jsxs("div",{className:`${N.write_new_loader_body} flex-column-normal-normal-small`,children:[e.jsx("div",{className:N.write_new_loader_input}),e.jsx("div",{className:N.write_new_loader_input}),e.jsxs("div",{className:"flex-row-normal-normal-small",children:[e.jsx("button",{}),e.jsx("button",{}),e.jsx("button",{})]}),e.jsx("div",{style:{height:"10rem"},className:N.write_new_loader_input})]})})}const S="M",A="N",E="O",F={title:{isMin:{message:"Title is to short!",value:4}}};const H=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const g=t(),D=n(),C=r((e=>e.creator)),N=s.useRef(),H=s.useRef(),M=i(),O=y(),k=d(),z=M.get("content-id"),I=M.get("draft-id");if(!k.role(["Admin","Creator"]).permited())return e.jsx(o,{to:"/"});const R=z?a.get(z,"null"):I?C.contentDraft.find((e=>e._id===I)):void 0,U="post"===R?.contentType;b({title:R?.isEdit&&R?`${U?R.title:"Comment"} ändern`:I&&R?`${U?R.title:"Entwurf"} ändern`:"Neue post schreiben",description:"Hier kannst neue post oder entwurfe schreiben oder ändern."});const W=R?.isFromAdmin?"":"comment"===R?.contentType?`post-${R.onPost}-comments-${R.onPage}`:"all-posts",{mutate:B,isMutating:L,error:V}=c(W),{submit:q,reset:G,register:J,formState:{errors:K}}=l(F,{title:R?.title,isHidden:R?.isHidden},(()=>{N.current?.clear(),H.current?.clear()})),Q=V||(R?.isEdit&&!R?{code:404,message:"Content not found!"}:void 0);return e.jsxs(s.Fragment,{children:[L&&e.jsx(m,{}),O.isAuthPending?e.jsx(P,{}):e.jsx("div",{className:`${S} flex-row-normal-center-big`,children:e.jsxs(u,{className:A,onSubmit:q((async e=>{delete e.alt,delete e.uploadImg,delete e.url,B((async function(t){if(R?.isEdit){const n=await j.post(`/admin/${R?.contentType}/update`,{...e,content:H.current?.value,tags:N.current?.value,id:I||z},x);if(a.remove(n._id),"post"===R?.contentType){const e=t.state||[];return t.removeCache(`post-${n._id}`),R.isFromAdmin?D(`/admin/${R.contentType}`):D(`/post/${n._id}`),e.map((e=>e._id===n._id?n:e))}if("comment"===R?.contentType){const e=t.state||{pagesCount:0,comments:[]};return R.isFromAdmin?void D("/admin/comment"):(D(`/post/${R?.onPost}?page=${R?.onPage}`),{...e,comments:e.comments.map((e=>e._id===n._id?n:e))})}}const n=await j.post("/insert/post",{...e,content:H.current?.value,tags:N.current?.value},x),r=t.state||[];return D(`/post/${n._id}`),[...r||[],n]})),G()})),isPending:!1,children:["comment"!==R?.contentType?e.jsxs(s.Fragment,{children:[e.jsx(f,{register:J,name:"title",errors:K,placeholder:"Post title"}),e.jsx(v,{register:J,name:"isHidden",label:"Hidde post"}),e.jsx(h,{ref:N,placeholder:"Post tags",value:R?.tags})]}):null,e.jsx(w,{ref:H,defaultValue:R?.content,placeholder:"Write content body here..."}),e.jsxs("div",{className:E,children:[e.jsx(p,{label:R?.isEdit?`Edit ${R?.contentType}`:"Create post",type:"submit"}),e.jsx(p,{label:R&&!z?"Save draft changes":"Save as draft",onClick:()=>{const e=I||z||window.crypto.randomUUID();g($({...R,_id:e,content:H.current?.value||""})),M.set({"draft-id":e}),M.remove(["content-id"]),a.remove(z)}}),e.jsx(p,{label:"Delete draft",onClick:()=>{g(T(I||z)),M.remove(["draft-id"]),G()}})]}),Q&&e.jsx(_,{error:Q.message})]})})]})}},Symbol.toStringTag,{value:"Module"}));export{P as W,C as c,H as p};
