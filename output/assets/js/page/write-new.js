import{j as e,V as t,c as n,W as r,N as o,r as s}from"../react.js";import{l as a,u as i,b as d,d as c,c as l,M as m,e as u,T as f,B as p,L as _,f as j,h as g}from"./admin.js";import{a as x,d as h,T as w}from"./database.js";import{T as v}from"./search.js";import{c as b}from"./website-settings.js";import{u as y}from"./home.js";const $=b({name:"creator",initialState:{contentDraft:a.get("content-draft","[]")},reducers:{editOrinsertContentDraft:(e,{payload:t})=>{if(0===e.contentDraft.length)return a.set("content-draft",e.contentDraft=[t]);e.contentDraft.find(((e,n)=>e._id===t._id?{_id:e._id,index:n}:void 0))?a.set("content-draft",e.contentDraft=e.contentDraft.map((e=>e._id===t._id?t:e))):a.set("content-draft",e.contentDraft=[...e.contentDraft,t])},removeContentDraft:(e,{payload:t})=>{0!==e.contentDraft.length&&a.set("content-draft",e.contentDraft=e.contentDraft.filter((e=>e._id!==t)))}}}),{editOrinsertContentDraft:D,removeContentDraft:T}=$.actions,C=$.reducer,N={write_new_loader_container:"y",write_new_loader_body:"z",loader:"A",write_new_loader_input:"B"};function P(){return e.jsx("div",{className:`${N.write_new_loader_container} flex-row-normal-center-medium`,children:e.jsxs("div",{className:`${N.write_new_loader_body} flex-column-normal-normal-small`,children:[e.jsx("div",{className:N.write_new_loader_input}),e.jsx("div",{className:N.write_new_loader_input}),e.jsxs("div",{className:"flex-row-normal-normal-small",children:[e.jsx("button",{}),e.jsx("button",{}),e.jsx("button",{})]}),e.jsx("div",{style:{height:"10rem"},className:N.write_new_loader_input})]})})}const A="K",E="L",S="M";const O=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const b=t(),$=n(),C=r((e=>e.creator)),N=i(),O=y(),{submit:F,reset:M,formState:{errors:V}}=d([["title","isMin:4:Title is to short!"]]),k=c(),z=N.get("content-id"),B=N.get("draft-id");if(!k.role(["Admin","Creator"]).permited())return e.jsx(o,{to:"/"});const H=z?a.get(z,"null"):B?C.contentDraft.find((e=>e._id===B)):void 0,R="post"===H?.contentType;x({title:H?.isEdit&&H?`${R?H.title:"Comment"} ändern`:B&&H?`${R?H.title:"Entwurf"} ändern`:"Neue post schreiben",description:"Hier kannst neue post oder entwurfe schreiben oder ändern."});const W=H?.isFromAdmin?"":"comment"===H?.contentType?`post-${H.onPost}-comments-${H.onPage}`:"all-posts",{mutate:I,isMutating:K,error:L}=l(W),U=L||(H?.isEdit&&!H?{code:404,message:"Content not found!"}:void 0),q=s.useRef(H?.tags||[]),G=s.useRef("");return e.jsxs(s.Fragment,{children:[K&&e.jsx(m,{}),O.isAuthPending?e.jsx(P,{}):e.jsx("div",{className:`${A} flex-row-normal-center-big`,children:e.jsxs(u,{className:E,onSubmit:F((async e=>{delete e.alt,delete e.uploadImg,delete e.url,I((async function(t){if(H?.isEdit){const n=await j.post(`/admin/${H?.contentType}/update`,{...e,content:G.current,tags:q.current,id:B||z},{Authorization:`Bearer ${g.getOne("PR_TOKEN")}`});if(a.remove(n._id),"post"===H?.contentType){const e=t.state||[];t.removeCache(`/post-${n._id}`);for(let n=(H?.onPage||0)+1;n>=0;n--)t.removeCache(`${H.contentType}-${n}`);return H.isFromAdmin?$(`/admin/${H.contentType}`):$(`/post/${n._id}`),e.map((e=>e._id===n._id?n:e))}if("comment"===H?.contentType){const e=t.state||{pagesCount:0,comments:[]};return H.isFromAdmin?void $("/admin/comment"):($(`/post/${H?.onPost}?page=${H?.onPage}`),{...e,comments:e.comments.map((e=>e._id===n._id?n:e))})}}const n=await j.post("/insert/post",{...e,content:G.current,tags:q.current},{Authorization:`Bearer ${O?.user?.token}`}),r=t.state||[];return $(`/post/${n._id}`),[...r||[],n]}))})),isPending:!1,children:["comment"!==H?.contentType?e.jsxs(s.Fragment,{children:[e.jsx(f,{name:"title",errors:V,defaultValue:H?.title,placeholder:"Post title"}),e.jsx(h,{name:"isHidden",label:"Hidde post",defaultValue:H?.isHidden}),e.jsx(v,{getTags:e=>{q.current=e},placeholder:"Post tags",value:q.current})]}):null,e.jsx(w,{defaultValue:H?.content,placeholder:"Write content body here...",getValue:e=>{G.current=e}}),e.jsxs("div",{className:S,children:[e.jsx(p,{label:H?.isEdit?`Edit ${H?.contentType}`:"Create post",type:"submit"}),e.jsx(p,{label:H&&!z?"Save draft changes":"Save as draft",onClick:()=>{const e=B||z||window.crypto.randomUUID();b(D({...H,_id:e,content:G.current})),N.set({"draft-id":e}),N.remove(["content-id"]),a.remove(z)}}),e.jsx(p,{label:"Delete draft",onClick:()=>{b(T(B||z)),N.remove(["draft-id"]),M(),q.current=[],G.current=""}})]}),U&&e.jsx(_,{error:U.message})]})})]})}},Symbol.toStringTag,{value:"Module"}));export{P as W,C as c,O as p};
